{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\amis\\schema\\func.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\amis\\schema\\func.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCnZhciBfX3Jlc3QgPSB0aGlzICYmIHRoaXMuX19yZXN0IHx8IGZ1bmN0aW9uIChzLCBlKSB7CiAgdmFyIHQgPSB7fTsKCiAgZm9yICh2YXIgcCBpbiBzKSB7CiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApIHRbcF0gPSBzW3BdOwogIH0KCiAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gImZ1bmN0aW9uIikgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykgewogICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKSB0W3BbaV1dID0gc1twW2ldXTsKICB9CiAgcmV0dXJuIHQ7Cn07CgppbXBvcnQgeyByZXNvbHZlUmVuZGVyZXIgfSBmcm9tICdhbWlzJzsKaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvdHBsJzsKaW1wb3J0IHsgZ2V0LCBpc0FycmF5LCBpc0VtcHR5LCBpc09iamVjdCwgbWFwLCBpc0Z1bmN0aW9uIH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgY2hlY2tMaW1pdEJ5S2V5cyB9IGZyb20gIi4uLy4uLy4uL3JvdXRlcy9saW1pdC9leHBvcnRzIjsKaW1wb3J0IGxvZ2dlciBmcm9tICIuLi8uLi8uLi91dGlscy9sb2dnZXIiOwp2YXIgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignZGV2OmFtaXNTY2hlbWE6dXRpbHMnKTsgLy8g5qCh6aqMIHNjaGVtYSDmnYPpmZAKCnZhciBjaGVja1NjaGVtYUxpbWl0ID0gKHNjaGVtYSwgbm9kZVBhdGgpID0+IHsKICB2YXIgewogICAgbGltaXRzLAogICAgbGltaXRzTG9naWMgPSAnYW5kJwogIH0gPSBzY2hlbWEgfHwge307CgogIGlmICghbGltaXRzKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGlmIChsaW1pdHNMb2dpYyA9PT0gJ29yJyAmJiB0eXBlb2YgbGltaXRzICE9PSAnc3RyaW5nJykgewogICAgcmV0dXJuICEhbGltaXRzLnNvbWUobGltaXQgPT4gY2hlY2tMaW1pdEJ5S2V5cyhsaW1pdCwgewogICAgICBub2RlUGF0aAogICAgfSkpOwogIH0KCiAgdmFyIGlzQXV0aCA9IGNoZWNrTGltaXRCeUtleXMobGltaXRzLCB7CiAgICBub2RlUGF0aAogIH0pOwogIHJldHVybiBpc0F1dGg7Cn07IC8vIOi/h+a7pOaXoOadg+mZkOaTjeS9nAoKCmV4cG9ydCB2YXIgZmlsdGVyU2NoZW1hTGltaXQgPSAoc2NoZW1hLCBvcHRpb24pID0+IHsKICB2YXIgewogICAgbm9kZVBhdGgsCiAgICBpc0RlZmluaXRpb25zCiAgfSA9IG9wdGlvbiB8fCB7fTsKCiAgaWYgKCFpc09iamVjdChzY2hlbWEpKSB7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaXNBcnJheShzY2hlbWEpKSB7CiAgICB2YXIgbGltaXRlZElkeEFyID0gW107CiAgICBzY2hlbWEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgaWYgKCFjaGVja1NjaGVtYUxpbWl0KGl0ZW0sIG5vZGVQYXRoKSkgewogICAgICAgIGxpbWl0ZWRJZHhBci5wdXNoKGluZGV4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmaWx0ZXJTY2hlbWFMaW1pdChpdGVtLCB7CiAgICAgICAgICBub2RlUGF0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGxpbWl0ZWRJZHhBci5mb3JFYWNoKChpZHgsIGluZGV4KSA9PiB7CiAgICAgIHNjaGVtYS5zcGxpY2UoaWR4IC0gaW5kZXgsIDEpOwogICAgfSk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoIWNoZWNrU2NoZW1hTGltaXQoc2NoZW1hLCBub2RlUGF0aCkpIHsKICAgIDsKICAgIHNjaGVtYS50eXBlID0gJ2xpYi1vbWl0JzsKICAgIHJldHVybjsKICB9CgogIG1hcChzY2hlbWEsICh2YWwsIGtleSkgPT4gewogICAgaWYgKCFpc09iamVjdChzY2hlbWEpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWNoZWNrU2NoZW1hTGltaXQodmFsLCBub2RlUGF0aCkpIHsKICAgICAgaWYgKGlzRGVmaW5pdGlvbnMpIHsKICAgICAgICBzY2hlbWFba2V5XSA9IHsKICAgICAgICAgIHR5cGU6ICdsaWItb21pdCcKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIGRlbGV0ZSBzY2hlbWFba2V5XTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZpbHRlclNjaGVtYUxpbWl0KHZhbCwgewogICAgICBub2RlUGF0aCwKICAgICAgaXNEZWZpbml0aW9uczoga2V5ID09PSAnZGVmaW5pdGlvbnMnCiAgICB9KTsKICB9KTsKfTsgLy8g6Ieq5a6a5LmJ5qC85byPIOi9rOaNouS4uiBhbWlzIOagvOW8jwoKZXhwb3J0IHZhciBjb252ZXJ0VG9BbWlzU2NoZW1hID0gKHNjaGVtYSwgb3B0aW9uKSA9PiB7CiAgdmFyIHsKICAgIGRlZmluaXRpb25zLAogICAgcHJlc2V0LAogICAgY29uc3RhbnRzCiAgfSA9IG9wdGlvbjsKCiAgaWYgKCFwcmVzZXQgJiYgIWRlZmluaXRpb25zICYmICFjb25zdGFudHMpIHsKICAgIHJldHVybiBzY2hlbWE7CiAgfQoKICB2YXIgewogICAgbm9kZVBhdGgKICB9ID0gcHJlc2V0IHx8IHt9OwogIG1hcChzY2hlbWEsICh2YWx1ZSwga2V5KSA9PiB7CiAgICAvLyB0cmFucyBjb25zdGFudHMga2V5CiAgICBpZiAoY29uc3RhbnRzKSB7CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIC9cJFx7W0EtWl1bQS1aMC05X10qXH0vLnRlc3QodmFsdWUpKSB7CiAgICAgICAgdmFyIG5ld1ZhbCA9IGZpbHRlcih2YWx1ZSwgY29uc3RhbnRzKTsKICAgICAgICBzY2hlbWFba2V5XSA9IG5ld1ZhbDsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmIC9cJFx7W0EtWl1bQS1aMC05X10qXH0vLnRlc3Qoa2V5KSkgewogICAgICAgIHZhciBuZXdLZXkgPSBmaWx0ZXIoa2V5LCBjb25zdGFudHMpOwogICAgICAgIHNjaGVtYVtuZXdLZXldID0gdmFsdWU7CiAgICAgICAgZGVsZXRlIHNjaGVtYVtrZXldOwogICAgICB9CiAgICB9IC8vIE9taXQgIiBhcGlzIiBhbmQgImxpbWl0cyIKCgogICAgaWYgKGtleSA9PT0gJ2FwaXMnIHx8IGtleSA9PT0gJ2xpbWl0cycpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgc2NoZW1hW2tleV0gPSBjb252ZXJ0VG9BbWlzU2NoZW1hKHZhbHVlLCBvcHRpb24pOwogICAgICByZXR1cm47CiAgICB9IC8vIHJlc29sdmUgZGVmaW5pdGlvbnMgZnVuY3Rpb25zIGtleXMKCgogICAgaWYgKGtleSA9PT0gJyRyZWYnICYmIGlzRnVuY3Rpb24oZ2V0KGRlZmluaXRpb25zLCB2YWx1ZSkpKSB7CiAgICAgIGRlbGV0ZSBzY2hlbWEuJHJlZjsKICAgICAgc2NoZW1hID0gZ2V0KGRlZmluaXRpb25zLCB2YWx1ZSkoc2NoZW1hKSB8fCB7CiAgICAgICAgdHlwZTogJ2xpYi1vbWl0JwogICAgICB9OwogICAgICByZXR1cm47CiAgICB9IC8vIHJlc29sdmUgcHJlc2V0IGtleXMKCgogICAgdmFyIHByZXNldFJlZlR5cGUgPSBrZXkgPT09ICckcHJlc2V0JyA/ICdrZXknIDogdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS5pbmRleE9mKCckcHJlc2V0LicpID09PSAwID8gJ3ZhbHVlJyA6ICcnOwoKICAgIGlmICghcHJlc2V0UmVmVHlwZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGlzS2V5UmVmID0gcHJlc2V0UmVmVHlwZSA9PT0gJ2tleSc7CiAgICB2YXIgcHJlc2V0VmFsID0gZ2V0KHByZXNldCwgaXNLZXlSZWYgPyB2YWx1ZSA6IHZhbHVlLnJlcGxhY2UoJyRwcmVzZXQuJywgJycpKTsKICAgIHZhciBsb2dTdHIgPSAiIFsiLmNvbmNhdChrZXksICI6ICIpLmNvbmNhdCh2YWx1ZSwgIl0gXHU4QkY3XHU2OEMwXHU2N0U1ICIpLmNvbmNhdChub2RlUGF0aCwgIi9wcmVzZXQgXHU2MjE2XHU4MDA1IHNjaGVtYS5wcmVzZXQiKTsKCiAgICBpZiAoIXByZXNldFZhbCkgewogICAgICBsb2cud2FybignJHByZXNldCDkuI3lrZjlnKjjgIInLCBsb2dTdHIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFpc0tleVJlZikgewogICAgICBzY2hlbWFba2V5XSA9IHByZXNldFZhbDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICghaXNPYmplY3QocHJlc2V0VmFsKSkgewogICAgICBsb2cud2FybignJHByZXNldOS4umtleeaXtu+8jOWPquiDveW8leeUqG9iamVjdOWAvOOAgicsIGxvZ1N0cik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBkZWxldGUgc2NoZW1hLiRwcmVzZXQ7CiAgICBzY2hlbWEgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHByZXNldFZhbCksIHNjaGVtYSk7CiAgfSk7CiAgcmV0dXJuIHNjaGVtYTsKfTsgLy8g5aSE55CG6Ieq5a6a5LmJ5qC85byPCgpleHBvcnQgdmFyIHJlc29sdmVMaWJTY2hlbWEgPSBzY2hlbWEgPT4gewogIHZhciB7CiAgICBwcmVzZXQgPSB7fSwKICAgIGRlZmluaXRpb25zLAogICAgY29uc3RhbnRzCiAgfSA9IHNjaGVtYSwKICAgICAgcmVzdCA9IF9fcmVzdChzY2hlbWEsIFsicHJlc2V0IiwgImRlZmluaXRpb25zIiwgImNvbnN0YW50cyJdKTsKCiAgdmFyIHJlZm9ybVNjaGVtYSA9IE9iamVjdC5hc3NpZ24oewogICAgZGVmaW5pdGlvbnMsCiAgICBwcmVzZXQKICB9LCByZXN0KTsKCiAgaWYgKGlzRW1wdHkocHJlc2V0KSAmJiBpc0VtcHR5KGRlZmluaXRpb25zKSAmJiAhY29uc3RhbnRzKSB7CiAgICByZXR1cm4gcmVmb3JtU2NoZW1hOwogIH0KCiAgY29udmVydFRvQW1pc1NjaGVtYShyZWZvcm1TY2hlbWEsIHsKICAgIGRlZmluaXRpb25zLAogICAgcHJlc2V0LAogICAgY29uc3RhbnRzCiAgfSk7CiAgZmlsdGVyU2NoZW1hTGltaXQocmVzdCwgcHJlc2V0KTsKICByZXR1cm4gcmVmb3JtU2NoZW1hOwp9OyAvLyDoh6rlrprkuYnop6PmnpDlmagKCmV4cG9ydCB2YXIgbGliUmVzb2x2ZXIgPSAocGF0aCwgc2NoZW1hKSA9PiB7CiAgcmV0dXJuIHJlc29sdmVSZW5kZXJlcihwYXRoLCBzY2hlbWEpOwp9OyAvLyDpobblsYLmnIkgdHlwZSDkuI4gY3NzIOWxnuaAp++8jCDoh6rliqjms6jlhaUgbGliLWNzcwoKZXhwb3J0IHZhciB3cmFwQ3NzID0gc2NoZW1hID0+IHsKICB2YXIgewogICAgY3NzOiBnZXRDc3MsCiAgICB0YWcsCiAgICBodG1sQ2xhc3NOYW1lLAogICAgZGVmaW5pdGlvbnMsCiAgICBjb25zdGFudHMsCiAgICBwcmVzZXQKICB9ID0gc2NoZW1hLAogICAgICByZXN0ID0gX19yZXN0KHNjaGVtYSwgWyJjc3MiLCAidGFnIiwgImh0bWxDbGFzc05hbWUiLCAiZGVmaW5pdGlvbnMiLCAiY29uc3RhbnRzIiwgInByZXNldCJdKTsKCiAgaWYgKCFnZXRDc3MgJiYgIXRhZyAmJiAhaHRtbENsYXNzTmFtZSkgewogICAgcmV0dXJuIHNjaGVtYTsKICB9CgogIHJldHVybiB7CiAgICB0YWcsCiAgICBwcmVzZXQsCiAgICBkZWZpbml0aW9ucywKICAgIGNvbnN0YW50cywKICAgIGh0bWxDbGFzc05hbWUsCiAgICBib2R5OiByZXN0LAogICAgY3NzOiBnZXRDc3MsCiAgICB0eXBlOiAnbGliLWNzcycKICB9Owp9Owo7CgooZnVuY3Rpb24gKCkgewogIHZhciByZWFjdEhvdExvYWRlciA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5kZWZhdWx0IDogdW5kZWZpbmVkOwoKICBpZiAoIXJlYWN0SG90TG9hZGVyKSB7CiAgICByZXR1cm47CiAgfQoKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihfX3Jlc3QsICJfX3Jlc3QiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxjb21wb25lbnRzXFxhbWlzXFxzY2hlbWFcXGZ1bmMuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihsb2csICJsb2ciLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxjb21wb25lbnRzXFxhbWlzXFxzY2hlbWFcXGZ1bmMuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihjaGVja1NjaGVtYUxpbWl0LCAiY2hlY2tTY2hlbWFMaW1pdCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGNvbXBvbmVudHNcXGFtaXNcXHNjaGVtYVxcZnVuYy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGZpbHRlclNjaGVtYUxpbWl0LCAiZmlsdGVyU2NoZW1hTGltaXQiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxjb21wb25lbnRzXFxhbWlzXFxzY2hlbWFcXGZ1bmMuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihjb252ZXJ0VG9BbWlzU2NoZW1hLCAiY29udmVydFRvQW1pc1NjaGVtYSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGNvbXBvbmVudHNcXGFtaXNcXHNjaGVtYVxcZnVuYy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHJlc29sdmVMaWJTY2hlbWEsICJyZXNvbHZlTGliU2NoZW1hIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcY29tcG9uZW50c1xcYW1pc1xcc2NoZW1hXFxmdW5jLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIobGliUmVzb2x2ZXIsICJsaWJSZXNvbHZlciIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGNvbXBvbmVudHNcXGFtaXNcXHNjaGVtYVxcZnVuYy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHdyYXBDc3MsICJ3cmFwQ3NzIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcY29tcG9uZW50c1xcYW1pc1xcc2NoZW1hXFxmdW5jLmpzIik7Cn0pKCk7Cgo7CgooZnVuY3Rpb24gKCkgewogIHZhciBsZWF2ZU1vZHVsZSA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5sZWF2ZU1vZHVsZSA6IHVuZGVmaW5lZDsKICBsZWF2ZU1vZHVsZSAmJiBsZWF2ZU1vZHVsZShtb2R1bGUpOwp9KSgpOw=="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/components/amis/schema/func.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","resolveRenderer","filter","get","isArray","isEmpty","isObject","map","isFunction","checkLimitByKeys","logger","log","getLogger","checkSchemaLimit","schema","nodePath","limits","limitsLogic","some","limit","isAuth","filterSchemaLimit","option","isDefinitions","limitedIdxAr","forEach","item","index","push","idx","splice","type","val","key","convertToAmisSchema","definitions","preset","constants","value","test","newVal","newKey","$ref","presetRefType","isKeyRef","presetVal","replace","logStr","warn","$preset","assign","resolveLibSchema","rest","reformSchema","libResolver","path","wrapCss","css","getCss","tag","htmlClassName","body"],"mappings":"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","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { resolveRenderer } from 'amis';\nimport { filter } from 'amis/lib/utils/tpl';\nimport { get, isArray, isEmpty, isObject, map, isFunction } from 'lodash';\nimport { checkLimitByKeys } from \"../../../routes/limit/exports\";\nimport logger from \"../../../utils/logger\";\nconst log = logger.getLogger('dev:amisSchema:utils');\n// 校验 schema 权限\nconst checkSchemaLimit = (schema, nodePath) => {\n    const { limits, limitsLogic = 'and' } = schema || {};\n    if (!limits) {\n        return true;\n    }\n    if (limitsLogic === 'or' && typeof limits !== 'string') {\n        return !!limits.some((limit) => checkLimitByKeys(limit, { nodePath }));\n    }\n    const isAuth = checkLimitByKeys(limits, { nodePath });\n    return isAuth;\n};\n// 过滤无权限操作\nexport const filterSchemaLimit = (schema, option) => {\n    const { nodePath, isDefinitions } = option || {};\n    if (!isObject(schema)) {\n        return;\n    }\n    if (isArray(schema)) {\n        const limitedIdxAr = [];\n        schema.forEach((item, index) => {\n            if (!checkSchemaLimit(item, nodePath)) {\n                limitedIdxAr.push(index);\n            }\n            else {\n                filterSchemaLimit(item, { nodePath });\n            }\n        });\n        limitedIdxAr.forEach((idx, index) => {\n            schema.splice(idx - index, 1);\n        });\n        return;\n    }\n    if (!checkSchemaLimit(schema, nodePath)) {\n        ;\n        schema.type = 'lib-omit';\n        return;\n    }\n    map(schema, (val, key) => {\n        if (!isObject(schema)) {\n            return;\n        }\n        if (!checkSchemaLimit(val, nodePath)) {\n            if (isDefinitions) {\n                schema[key] = {\n                    type: 'lib-omit',\n                };\n            }\n            else {\n                delete schema[key];\n            }\n            return;\n        }\n        filterSchemaLimit(val, { nodePath, isDefinitions: key === 'definitions' });\n    });\n};\n// 自定义格式 转换为 amis 格式\nexport const convertToAmisSchema = (schema, option) => {\n    const { definitions, preset, constants } = option;\n    if (!preset && !definitions && !constants) {\n        return schema;\n    }\n    const { nodePath } = preset || {};\n    map(schema, (value, key) => {\n        // trans constants key\n        if (constants) {\n            if (typeof value === 'string' && /\\$\\{[A-Z][A-Z0-9_]*\\}/.test(value)) {\n                const newVal = filter(value, constants);\n                schema[key] = newVal;\n            }\n            if (typeof key === 'string' && /\\$\\{[A-Z][A-Z0-9_]*\\}/.test(key)) {\n                const newKey = filter(key, constants);\n                schema[newKey] = value;\n                delete schema[key];\n            }\n        }\n        // Omit \" apis\" and \"limits\"\n        if (key === 'apis' || key === 'limits') {\n            return;\n        }\n        if (isObject(value)) {\n            schema[key] = convertToAmisSchema(value, option);\n            return;\n        }\n        // resolve definitions functions keys\n        if (key === '$ref' && isFunction(get(definitions, value))) {\n            delete schema.$ref;\n            schema = get(definitions, value)(schema) || { type: 'lib-omit' };\n            return;\n        }\n        // resolve preset keys\n        const presetRefType = key === '$preset'\n            ? 'key'\n            : typeof value === 'string' && value.indexOf('$preset.') === 0\n                ? 'value'\n                : '';\n        if (!presetRefType) {\n            return;\n        }\n        const isKeyRef = presetRefType === 'key';\n        const presetVal = get(preset, isKeyRef ? value : value.replace('$preset.', ''));\n        const logStr = ` [${key}: ${value}] 请检查 ${nodePath}/preset 或者 schema.preset`;\n        if (!presetVal) {\n            log.warn('$preset 不存在。', logStr);\n            return;\n        }\n        if (!isKeyRef) {\n            schema[key] = presetVal;\n            return;\n        }\n        if (!isObject(presetVal)) {\n            log.warn('$preset为key时，只能引用object值。', logStr);\n            return;\n        }\n        delete schema.$preset;\n        schema = Object.assign(Object.assign({}, presetVal), schema);\n    });\n    return schema;\n};\n// 处理自定义格式\nexport const resolveLibSchema = (schema) => {\n    const { preset = {}, definitions, constants } = schema, rest = __rest(schema, [\"preset\", \"definitions\", \"constants\"]);\n    const reformSchema = Object.assign({ definitions, preset }, rest);\n    if (isEmpty(preset) && isEmpty(definitions) && !constants) {\n        return reformSchema;\n    }\n    convertToAmisSchema(reformSchema, { definitions, preset, constants });\n    filterSchemaLimit(rest, preset);\n    return reformSchema;\n};\n// 自定义解析器\nexport const libResolver = (path, schema) => {\n    return resolveRenderer(path, schema);\n};\n// 顶层有 type 与 css 属性， 自动注入 lib-css\nexport const wrapCss = (schema) => {\n    const { css: getCss, tag, htmlClassName, definitions, constants, preset } = schema, rest = __rest(schema, [\"css\", \"tag\", \"htmlClassName\", \"definitions\", \"constants\", \"preset\"]);\n    if (!getCss && !tag && !htmlClassName) {\n        return schema;\n    }\n    return {\n        tag,\n        preset,\n        definitions,\n        constants,\n        htmlClassName,\n        body: rest,\n        css: getCss,\n        type: 'lib-css',\n    };\n};\n"]}]}