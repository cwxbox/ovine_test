{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--5-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\message.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\message.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIOWunueOsOa2iOaBr+mAmuefpemAu+i+kQogKiDop6PogKbnu4Tku7bnirbmgIHkvp3otZYKICovCmltcG9ydCBpc0FycmF5IGZyb20gJ2xvZGFzaC9pc0FycmF5JzsKaW1wb3J0IGlzTm9uZSBmcm9tICdsb2Rhc2gvaXNVbmRlZmluZWQnOwppbXBvcnQgeyBtZXNzYWdlIH0gZnJvbSAiLi4vY29uc3RhbnRzIjsKdmFyIHsKICBzdG9yZVJvb3QKfSA9IG1lc3NhZ2U7CnZhciBvYnNlcnZlciA9IHt9Owp2YXIgc291cmNlID0ge307IC8vIOagvOW8j+WMluWtmOWCqCBrZXkg5qC85byPCgp2YXIgc3RvcmVLZXlDdHJsID0gZnVuY3Rpb24gc3RvcmVLZXlDdHJsKHR5cGUpIHsKICB2YXIgdmFsdWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnOwogIHZhciBpc1N0b3JlS2V5ID0gdmFsdWUuaW5kZXhPZihzdG9yZVJvb3QpID09PSAwOwoKICBpZiAodHlwZSA9PT0gJ3NldCcpIHsKICAgIHJldHVybiBpc1N0b3JlS2V5ID8gdmFsdWUgOiAiIi5jb25jYXQoc3RvcmVSb290KS5jb25jYXQodmFsdWUpOwogIH0KCiAgcmV0dXJuICFpc1N0b3JlS2V5ID8gdW5kZWZpbmVkIDogdmFsdWUuc3BsaXQoc3RvcmVSb290KVsxXTsKfTsgLy8g5pu05pS5IHN0b3JlIOWAvCzlsLHkvJroh6rliqggcHVibGlzaCDmtojmga8KCgpleHBvcnQgdmFyIG9ic2VydmVTdG9yZSA9IG5ldyBQcm94eSh7fSwgewogIGdldChfLCBrZXkpIHsKICAgIHJldHVybiBzb3VyY2Vba2V5XTsKICB9LAoKICAvLyDmlbTkuKrmqKHlnZfnmoTmoLjlv4PpgLvovpEKICAvLyDku6PnkIZvYmplY3TotYvlgLzmk43kvZzvvIzorr7nva7lgLznmoTml7blgJnvvIzop6blj5HorqLpmIXml7bnmoTlm57osIPlh73mlbAKICBzZXQob2JqLCBrZXksIHZhbHVlKSB7CiAgICAvLyDlj6rmnInlgLzlj5jljJYg5omN6Kem5Y+R5Zue6LCD44CCCiAgICBpZiAoIShzb3VyY2Vba2V5XSAmJiBzb3VyY2Vba2V5XSA9PT0gdmFsdWUpKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgICB2YXIgc3RvcmVLZXkgPSBzdG9yZUtleUN0cmwoJ3NldCcsIGtleSk7CgogICAgICBpZiAoc3RvcmVLZXkgJiYgIWlzTm9uZShvYnNlcnZlcltzdG9yZUtleV0pKSB7CiAgICAgICAgb2JzZXJ2ZXJbc3RvcmVLZXldLmZvckVhY2goaGFuZGxlciA9PiB7CiAgICAgICAgICBoYW5kbGVyKHZhbHVlLCBzdG9yZUtleSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9KTsgLy8g5Y+R6YCB5raI5oGvCgpleHBvcnQgZnVuY3Rpb24gcHVibGlzaChrZXksIHZhbHVlKSB7CiAgdmFyIG1zZ1ZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/IHt9IDogdmFsdWU7CgogIHZhciBrZXlUb09ic2VydmVyID0gb2JzS2V5ID0+IHsKICAgIHZhciBzb3VyY2VLZXkgPSBzdG9yZUtleUN0cmwoJ2dldCcsIG9ic0tleSk7CgogICAgaWYgKHNvdXJjZUtleSAmJiAhaXNOb25lKHNvdXJjZVtzb3VyY2VLZXldKSkgewogICAgICBzb3VyY2Vbc291cmNlS2V5XSA9IG1zZ1ZhbHVlOwogICAgfQoKICAgIGlmICghaXNOb25lKG9ic2VydmVyW29ic0tleV0pKSB7CiAgICAgIG9ic2VydmVyW29ic0tleV0uZm9yRWFjaChoYW5kbGVyID0+IHsKICAgICAgICBoYW5kbGVyKG1zZ1ZhbHVlLCBvYnNLZXkpOwogICAgICB9KTsKICAgIH0KICB9OwoKICBpZiAoaXNBcnJheShrZXkpKSB7CiAgICBrZXkuZm9yRWFjaChrZXlUb09ic2VydmVyKTsKICB9IGVsc2UgewogICAga2V5VG9PYnNlcnZlcihrZXkpOwogIH0KfSAvLyDlj5bmtojorqLpmIUKCmV4cG9ydCBmdW5jdGlvbiB1bnN1YnNjcmliZShrZXksIGhhbmRsZXIpIHsKICB2YXIgb2ZmT2JzZXJ2ZXIgPSBvZmZLZXkgPT4gewogICAgaWYgKCFpc05vbmUob2JzZXJ2ZXJbb2ZmS2V5XSkpIHsKICAgICAgaWYgKCFoYW5kbGVyKSB7CiAgICAgICAgb2JzZXJ2ZXJbb2ZmS2V5XSA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIG9ic2VydmVyW29mZktleV0uZm9yRWFjaCgob2JzSGFuZGxlciwgaW5kZXgpID0+IHsKICAgICAgICAgIGlmIChvYnNIYW5kbGVyID09PSBoYW5kbGVyKSB7CiAgICAgICAgICAgIG9ic2VydmVyW29mZktleV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH07CgogIGlmIChpc0FycmF5KGtleSkpIHsKICAgIGtleS5mb3JFYWNoKG9mZk9ic2VydmVyKTsKICB9IGVsc2UgewogICAgb2ZmT2JzZXJ2ZXIoa2V5KTsKICB9Cn0KZXhwb3J0IGZ1bmN0aW9uIHVuc3Vic2NyaWJlQWxsKCkgewogIG9ic2VydmVyID0ge307Cn0gLy8g5raI5oGv6K6i6ZiFCgpleHBvcnQgZnVuY3Rpb24gc3Vic2NyaWJlKGtleSwgaGFuZGxlcikgewogIHZhciBjYWNoZU9ic2VydmVySGFuZGxlcnMgPSBtYXBLZXkgPT4gewogICAgaWYgKGlzTm9uZShvYnNlcnZlclttYXBLZXldKSkgewogICAgICBvYnNlcnZlclttYXBLZXldID0gW107CiAgICB9CgogICAgb2JzZXJ2ZXJbbWFwS2V5XS5wdXNoKGhhbmRsZXIpOwogICAgdmFyIGhhbmRsZXJLZXkgPSBzdG9yZUtleUN0cmwoJ2dldCcsIG1hcEtleSk7CgogICAgaWYgKGhhbmRsZXJLZXkgJiYgIWlzTm9uZShzb3VyY2VbaGFuZGxlcktleV0pKSB7CiAgICAgIGhhbmRsZXIoc291cmNlW2hhbmRsZXJLZXldLCBoYW5kbGVyS2V5KTsKICAgIH0KICB9OwoKICB2YXIgbGlzdGVuZXIgPSB7CiAgICBrZXksCiAgICB1bnN1YnNjcmliZTogKCkgPT4gey8vCiAgICB9CiAgfTsKCiAgaWYgKGlzQXJyYXkoa2V5KSkgewogICAga2V5LmZvckVhY2goY2FjaGVPYnNlcnZlckhhbmRsZXJzKTsKCiAgICBsaXN0ZW5lci51bnN1YnNjcmliZSA9ICgpID0+IGtleS5mb3JFYWNoKGsgPT4gdW5zdWJzY3JpYmUoaywgaGFuZGxlcikpOyAvLwoKICB9IGVsc2UgewogICAgY2FjaGVPYnNlcnZlckhhbmRsZXJzKGtleSk7CgogICAgbGlzdGVuZXIudW5zdWJzY3JpYmUgPSAoKSA9PiB1bnN1YnNjcmliZShrZXksIGhhbmRsZXIpOwogIH0KCiAgcmV0dXJuIGxpc3RlbmVyOwp9IC8vIOiuoumYheS4gOasoe+8jOWwsemUgOavgQoKZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZU9uY2Uoa2V5LCBoYW5kbGVyKSB7CiAgdmFyIGxpc3RlbmVyID0gc3Vic2NyaWJlKGtleSwgZGF0YSA9PiB7CiAgICBoYW5kbGVyKGRhdGEsIGtleSk7CiAgICBsaXN0ZW5lci51bnN1YnNjcmliZSgpOwogIH0pOwp9"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/utils/message.js"],"names":["isArray","isNone","message","storeRoot","observer","source","storeKeyCtrl","type","value","isStoreKey","indexOf","undefined","split","observeStore","Proxy","get","_","key","set","obj","storeKey","forEach","handler","publish","msgValue","keyToObserver","obsKey","sourceKey","unsubscribe","offObserver","offKey","obsHandler","index","splice","unsubscribeAll","subscribe","cacheObserverHandlers","mapKey","push","handlerKey","listener","k","subscribeOnce","data"],"mappings":"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","sourcesContent":["/**\n * 实现消息通知逻辑\n * 解耦组件状态依赖\n */\nimport isArray from 'lodash/isArray';\nimport isNone from 'lodash/isUndefined';\nimport { message } from \"../constants\";\nconst { storeRoot } = message;\nlet observer = {};\nconst source = {};\n// 格式化存储 key 格式\nconst storeKeyCtrl = (type, value = '') => {\n    const isStoreKey = value.indexOf(storeRoot) === 0;\n    if (type === 'set') {\n        return isStoreKey ? value : `${storeRoot}${value}`;\n    }\n    return !isStoreKey ? undefined : value.split(storeRoot)[1];\n};\n// 更改 store 值,就会自动 publish 消息\nexport const observeStore = new Proxy({}, {\n    get(_, key) {\n        return source[key];\n    },\n    // 整个模块的核心逻辑\n    // 代理object赋值操作，设置值的时候，触发订阅时的回调函数\n    set(obj, key, value) {\n        // 只有值变化 才触发回调。\n        if (!(source[key] && source[key] === value)) {\n            // eslint-disable-next-line\n            obj[key] = value;\n            const storeKey = storeKeyCtrl('set', key);\n            if (storeKey && !isNone(observer[storeKey])) {\n                observer[storeKey].forEach((handler) => {\n                    handler(value, storeKey);\n                });\n            }\n        }\n        return true;\n    },\n});\n// 发送消息\nexport function publish(key, value) {\n    const msgValue = typeof value === 'undefined' ? {} : value;\n    const keyToObserver = (obsKey) => {\n        const sourceKey = storeKeyCtrl('get', obsKey);\n        if (sourceKey && !isNone(source[sourceKey])) {\n            source[sourceKey] = msgValue;\n        }\n        if (!isNone(observer[obsKey])) {\n            observer[obsKey].forEach((handler) => {\n                handler(msgValue, obsKey);\n            });\n        }\n    };\n    if (isArray(key)) {\n        key.forEach(keyToObserver);\n    }\n    else {\n        keyToObserver(key);\n    }\n}\n// 取消订阅\nexport function unsubscribe(key, handler) {\n    const offObserver = (offKey) => {\n        if (!isNone(observer[offKey])) {\n            if (!handler) {\n                observer[offKey] = [];\n            }\n            else {\n                observer[offKey].forEach((obsHandler, index) => {\n                    if (obsHandler === handler) {\n                        observer[offKey].splice(index, 1);\n                    }\n                });\n            }\n        }\n    };\n    if (isArray(key)) {\n        key.forEach(offObserver);\n    }\n    else {\n        offObserver(key);\n    }\n}\nexport function unsubscribeAll() {\n    observer = {};\n}\n// 消息订阅\nexport function subscribe(key, handler) {\n    const cacheObserverHandlers = (mapKey) => {\n        if (isNone(observer[mapKey])) {\n            observer[mapKey] = [];\n        }\n        observer[mapKey].push(handler);\n        const handlerKey = storeKeyCtrl('get', mapKey);\n        if (handlerKey && !isNone(source[handlerKey])) {\n            handler(source[handlerKey], handlerKey);\n        }\n    };\n    const listener = {\n        key,\n        unsubscribe: () => {\n            //\n        },\n    };\n    if (isArray(key)) {\n        key.forEach(cacheObserverHandlers);\n        listener.unsubscribe = () => key.forEach((k) => unsubscribe(k, handler));\n        //\n    }\n    else {\n        cacheObserverHandlers(key);\n        listener.unsubscribe = () => unsubscribe(key, handler);\n    }\n    return listener;\n}\n// 订阅一次，就销毁\nexport function subscribeOnce(key, handler) {\n    const listener = subscribe(key, (data) => {\n        handler(data, key);\n        listener.unsubscribe();\n    });\n}\n"]}]}