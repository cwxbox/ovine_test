{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\amis\\schema\\api.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\amis\\schema\\api.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCmltcG9ydCB7IHJlc3BvbnNlQWRhcHRvciB9IGZyb20gJ2FtaXMvbGliL3V0aWxzL2FwaSc7CmltcG9ydCB7IHFzc3RyaW5naWZ5IH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvaGVscGVyJzsKaW1wb3J0IHsgZGF0YU1hcHBpbmcsIHRva2VuaXplIH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvdHBsLWJ1aWx0aW4nOwppbXBvcnQgeyBjbG9uZURlZXAsIGlzRW1wdHksIGlzUGxhaW5PYmplY3QgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBwYXJzZSB9IGZyb20gJ3FzJzsKaW1wb3J0IHsgYXBwIH0gZnJvbSAiLi4vLi4vLi4vYXBwIjsKaW1wb3J0IHsgbm9ybWFsaXplVXJsIH0gZnJvbSAiLi4vLi4vLi4vdXRpbHMvcmVxdWVzdCI7CmltcG9ydCB7IHN0cjJmdW5jdGlvbiB9IGZyb20gIi4uLy4uLy4uL3V0aWxzL3Rvb2wiOwpleHBvcnQgdmFyIGxpYkZldGNoZXIgPSBmdW5jdGlvbiBsaWJGZXRjaGVyKGFwaSwgZGF0YSkgewogIHZhciBvcHRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogIHZhciBhbWlzQXBpID0gdHlwZW9mIGFwaSA9PT0gJ3N0cmluZycgPyB7CiAgICB1cmw6IGFwaQogIH0gOiBpc1BsYWluT2JqZWN0KGFwaSkgPyBPYmplY3QuYXNzaWduKHt9LCBhcGkpIDoge307IC8vIOaPkOekuuS4jiBhbWlzIOS4jeWFvOWuueeahOWcsOaWuQoKICBpZiAoIWFtaXNBcGkudXJsIHx8IHR5cGVvZiBhbWlzQXBpLnVybCAhPT0gJ3N0cmluZycpIHsKICAgIHRocm93IG5ldyBFcnJvcign6K+35rGC5qih5Z2X5LiA5a6a6KaB5LygIHVybCDlrZfnrKbkuLLmoLzlvI/lj4LmlbAnKTsKICB9IC8vIOWOu+mZpOacq+WwvuWkmuS9meeahCA/IOWPtwoKCiAgYW1pc0FwaS51cmwgPSBhbWlzQXBpLnVybC5yZXBsYWNlKC9cP3sxLH0kLywgJycpOyAvLyDmt7vliqDlj4LmlbAKCiAgYW1pc0FwaS5hcGkgPSBhbWlzQXBpLmFwaSB8fCBhbWlzQXBpLnVybDsKICBhbWlzQXBpLmNvbmZpZyA9IG9wdGlvbjsKICBhbWlzQXBpLmlzRW52RmV0Y2hlciA9IHRydWU7CiAgdmFyIHsKICAgIHJlcXVlc3RBZGFwdG9yLAogICAgYWRhcHRvciwKICAgIG9uUmVxdWVzdCwKICAgIG9uRmFrZVJlcXVlc3QsCiAgICBvbkVycm9yCiAgfSA9IGFtaXNBcGk7CiAgdmFyIHsKICAgIG9uUHJlUmVxdWVzdCwKICAgIG9uU3VjY2VzcwogIH0gPSBhbWlzQXBpOwoKICBpZiAocmVxdWVzdEFkYXB0b3IgJiYgIW9uUHJlUmVxdWVzdCkgewogICAgb25QcmVSZXF1ZXN0ID0gcmVxdWVzdEFkYXB0b3I7CiAgfQoKICBpZiAoYWRhcHRvciAmJiAhb25TdWNjZXNzKSB7CiAgICBvblN1Y2Nlc3MgPSBhZGFwdG9yOwogIH0gLy8g5qOA5rWL5piv5Zue6LCD5a2X56ym5LiyIOi9rCBGdW5jdGlvbgoKCiAgaWYgKG9uRmFrZVJlcXVlc3QgJiYgdHlwZW9mIG9uRmFrZVJlcXVlc3QgPT09ICdzdHJpbmcnKSB7CiAgICBhbWlzQXBpLm9uRmFrZVJlcXVlc3QgPSBzdHIyZnVuY3Rpb24oJ29uRmFrZVJlcXVlc3QnLCBvbkZha2VSZXF1ZXN0LCAnb3B0aW9uJyk7CiAgfQoKICBpZiAob25QcmVSZXF1ZXN0ICYmIHR5cGVvZiBvblByZVJlcXVlc3QgPT09ICdzdHJpbmcnKSB7CiAgICBhbWlzQXBpLm9uUHJlUmVxdWVzdCA9IHN0cjJmdW5jdGlvbignb25QcmVSZXF1ZXN0Jywgb25QcmVSZXF1ZXN0LCAnb3B0aW9uJyk7CiAgfQoKICBpZiAob25SZXF1ZXN0ICYmIHR5cGVvZiBvblJlcXVlc3QgPT09ICdzdHJpbmcnKSB7CiAgICBhbWlzQXBpLm9uUmVxdWVzdCA9IHN0cjJmdW5jdGlvbignb25SZXF1ZXN0Jywgb25SZXF1ZXN0LCAnb3B0aW9uJyk7CiAgfQoKICBpZiAob25TdWNjZXNzICYmIHR5cGVvZiBvblN1Y2Nlc3MgPT09ICdzdHJpbmcnKSB7CiAgICBhbWlzQXBpLm9uU3VjY2VzcyA9IHN0cjJmdW5jdGlvbignb25TdWNjZXNzJywgb25TdWNjZXNzLCAnc291cmNlJywgJ29wdGlvbicsICdyZXNwb25zZScpOwogIH0KCiAgaWYgKG9uRXJyb3IgJiYgdHlwZW9mIG9uRXJyb3IgPT09ICdzdHJpbmcnKSB7CiAgICBhbWlzQXBpLm9uRXJyb3IgPSBzdHIyZnVuY3Rpb24oJ29uRXJyb3InLCBvbkVycm9yLCAncmVzcG9uc2UnLCAnb3B0aW9uJywgJ2Vycm9yJyk7CiAgfQoKICB2YXIgewogICAgbWV0aG9kLAogICAgdXJsCiAgfSA9IG5vcm1hbGl6ZVVybChhbWlzQXBpLnVybCwgYW1pc0FwaS5tZXRob2QgfHwgYW1pc0FwaS5jb25maWcubWV0aG9kKTsKICBhbWlzQXBpLm1ldGhvZCA9IG1ldGhvZDsKICBhbWlzQXBpLm1hcHBpbmdEYXRhID0gY2xvbmVEZWVwKGFtaXNBcGkuZGF0YSB8fCB7fSk7IC8vIOeUqOS6juaYoOWwhOeahOWPguaVsAoKICBhbWlzQXBpLnJhd0RhdGEgPSB7fTsgLy8g54m55q6K5oOF5Ya1IOS4jeS9nOWkhOeQhgoKICBpZiAoIWRhdGEgfHwgZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhIHx8IGRhdGEgaW5zdGFuY2VvZiBCbG9iIHx8IGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgYW1pc0FwaS5kYXRhID0gZGF0YSB8fCB7fTsKICB9IGVsc2UgewogICAgdmFyIHsKICAgICAgYXV0b0FwcGVuZCwKICAgICAgaWdub3JlRGF0YQogICAgfSA9IG9wdGlvbjsKICAgIHZhciBpZHggPSB1cmwuaW5kZXhPZignPycpOwogICAgdmFyIGhhc2hJZHggPSB1cmwuaW5kZXhPZignIycpOwogICAgdmFyIGhhc1N0cmluZyA9IGhhc2hJZHggIT09IC0xID8gdXJsLnN1YnN0cmluZyhoYXNoSWR4KSA6ICcnOyAvLyDor7fmsYLljp/lp4vlj4LmlbAKCiAgICBhbWlzQXBpLnJhd0RhdGEgPSBjbG9uZURlZXAoaXNFbXB0eShkYXRhKSA/IGRhdGEuX19zdXBlciB8fCB7fSA6IGRhdGEpOyAvLyBCVUc6IOihqOWNleS8oOWFpSDpu5jorqQgdmFsdWU6eHh45bCG5b2x5ZON77yMIHJlcXVlc3Qg5pe255qEIOS8oOWFpSBkYXRhCgogICAgdmFyIHVybE1hcHBpbmdEYXRhID0gaXNFbXB0eShkYXRhKSAmJiAhZGF0YS5fX3N1cGVyID8gYW1pc0FwaS5kYXRhIHx8IHt9IDogZGF0YTsgLy8g5LiOIGFtaXMg6buY6K6k6YC76L6R5L+d5oyB5LiA6Ie0CgogICAgaWYgKGlkeCA9PT0gLTEpIHsKICAgICAgYW1pc0FwaS51cmwgPSB0b2tlbml6ZSh1cmwsIHVybE1hcHBpbmdEYXRhLCAnfCB1cmxfZW5jb2RlJyk7CiAgICB9IGVsc2UgewogICAgICB2YXIgdXJsUGFyYW1zID0gcGFyc2UodXJsLnN1YnN0cmluZyhpZHggKyAxLCBoYXNoSWR4ICE9PSAtMSA/IGhhc2hJZHggOiB1bmRlZmluZWQpKTsKICAgICAgYW1pc0FwaS51cmwgPSB0b2tlbml6ZSh1cmwuc3Vic3RyaW5nKDAsIGlkeCArIDEpLCB1cmxNYXBwaW5nRGF0YSwgJ3wgdXJsX2VuY29kZScpICsgcXNzdHJpbmdpZnkoZGF0YU1hcHBpbmcodXJsUGFyYW1zLCB1cmxNYXBwaW5nRGF0YSksIGFtaXNBcGkucXNPcHRpb25zKSArIGhhc1N0cmluZzsKICAgIH0KCiAgICBpZiAoIWlnbm9yZURhdGEpIHsKICAgICAgaWYgKGFtaXNBcGkuZGF0YSkgewogICAgICAgIGFtaXNBcGkuZGF0YSA9IGRhdGFNYXBwaW5nKGFtaXNBcGkuZGF0YSwgZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAoL1BPU1R8UFVULy50ZXN0KG1ldGhvZCkgfHwgL0dFVC8udGVzdChtZXRob2QpICYmIGF1dG9BcHBlbmQpIHsKICAgICAgICBhbWlzQXBpLmRhdGEgPSBjbG9uZURlZXAoZGF0YSk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBhcHAucmVxdWVzdChhbWlzQXBpKS50aGVuKHNvdXJjZSA9PiByZXNwb25zZUFkYXB0b3Ioc291cmNlLCBhbWlzQXBpKSk7Cn07CjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIHJlYWN0SG90TG9hZGVyID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQgOiB1bmRlZmluZWQ7CgogIGlmICghcmVhY3RIb3RMb2FkZXIpIHsKICAgIHJldHVybjsKICB9CgogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGxpYkZldGNoZXIsICJsaWJGZXRjaGVyIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcY29tcG9uZW50c1xcYW1pc1xcc2NoZW1hXFxhcGkuanMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmxlYXZlTW9kdWxlIDogdW5kZWZpbmVkOwogIGxlYXZlTW9kdWxlICYmIGxlYXZlTW9kdWxlKG1vZHVsZSk7Cn0pKCk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/components/amis/schema/api.js"],"names":["responseAdaptor","qsstringify","dataMapping","tokenize","cloneDeep","isEmpty","isPlainObject","parse","app","normalizeUrl","str2function","libFetcher","api","data","option","amisApi","url","Object","assign","Error","replace","config","isEnvFetcher","requestAdaptor","adaptor","onRequest","onFakeRequest","onError","onPreRequest","onSuccess","method","mappingData","rawData","FormData","Blob","ArrayBuffer","autoAppend","ignoreData","idx","indexOf","hashIdx","hasString","substring","__super","urlMappingData","urlParams","undefined","qsOptions","test","request","then","source"],"mappings":"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","sourcesContent":["import { responseAdaptor } from 'amis/lib/utils/api';\nimport { qsstringify } from 'amis/lib/utils/helper';\nimport { dataMapping, tokenize } from 'amis/lib/utils/tpl-builtin';\nimport { cloneDeep, isEmpty, isPlainObject } from 'lodash';\nimport { parse } from 'qs';\nimport { app } from \"../../../app\";\nimport { normalizeUrl } from \"../../../utils/request\";\nimport { str2function } from \"../../../utils/tool\";\nexport const libFetcher = (api, data, // 数据\noption = {}) => {\n    const amisApi = typeof api === 'string'\n        ? {\n            url: api,\n        }\n        : isPlainObject(api)\n            ? Object.assign({}, api) : {};\n    // 提示与 amis 不兼容的地方\n    if (!amisApi.url || typeof amisApi.url !== 'string') {\n        throw new Error('请求模块一定要传 url 字符串格式参数');\n    }\n    // 去除末尾多余的 ? 号\n    amisApi.url = amisApi.url.replace(/\\?{1,}$/, '');\n    // 添加参数\n    amisApi.api = amisApi.api || amisApi.url;\n    amisApi.config = option;\n    amisApi.isEnvFetcher = true;\n    const { requestAdaptor, adaptor, onRequest, onFakeRequest, onError } = amisApi;\n    let { onPreRequest, onSuccess } = amisApi;\n    if (requestAdaptor && !onPreRequest) {\n        onPreRequest = requestAdaptor;\n    }\n    if (adaptor && !onSuccess) {\n        onSuccess = adaptor;\n    }\n    // 检测是回调字符串 转 Function\n    if (onFakeRequest && typeof onFakeRequest === 'string') {\n        amisApi.onFakeRequest = str2function('onFakeRequest', onFakeRequest, 'option');\n    }\n    if (onPreRequest && typeof onPreRequest === 'string') {\n        amisApi.onPreRequest = str2function('onPreRequest', onPreRequest, 'option');\n    }\n    if (onRequest && typeof onRequest === 'string') {\n        amisApi.onRequest = str2function('onRequest', onRequest, 'option');\n    }\n    if (onSuccess && typeof onSuccess === 'string') {\n        amisApi.onSuccess = str2function('onSuccess', onSuccess, 'source', 'option', 'response');\n    }\n    if (onError && typeof onError === 'string') {\n        amisApi.onError = str2function('onError', onError, 'response', 'option', 'error');\n    }\n    const { method, url } = normalizeUrl(amisApi.url, amisApi.method || amisApi.config.method);\n    amisApi.method = method;\n    amisApi.mappingData = cloneDeep(amisApi.data || {}); // 用于映射的参数\n    amisApi.rawData = {};\n    // 特殊情况 不作处理\n    if (!data || data instanceof FormData || data instanceof Blob || data instanceof ArrayBuffer) {\n        amisApi.data = data || {};\n    }\n    else {\n        const { autoAppend, ignoreData } = option;\n        const idx = url.indexOf('?');\n        const hashIdx = url.indexOf('#');\n        const hasString = hashIdx !== -1 ? url.substring(hashIdx) : '';\n        // 请求原始参数\n        amisApi.rawData = cloneDeep(isEmpty(data) ? data.__super || {} : data);\n        // BUG: 表单传入 默认 value:xxx将影响， request 时的 传入 data\n        const urlMappingData = isEmpty(data) && !data.__super ? amisApi.data || {} : data;\n        // 与 amis 默认逻辑保持一致\n        if (idx === -1) {\n            amisApi.url = tokenize(url, urlMappingData, '| url_encode');\n        }\n        else {\n            const urlParams = parse(url.substring(idx + 1, hashIdx !== -1 ? hashIdx : undefined));\n            amisApi.url =\n                tokenize(url.substring(0, idx + 1), urlMappingData, '| url_encode') +\n                    qsstringify(dataMapping(urlParams, urlMappingData), amisApi.qsOptions) +\n                    hasString;\n        }\n        if (!ignoreData) {\n            if (amisApi.data) {\n                amisApi.data = dataMapping(amisApi.data, data);\n            }\n            else if (/POST|PUT/.test(method) || (/GET/.test(method) && autoAppend)) {\n                amisApi.data = cloneDeep(data);\n            }\n        }\n    }\n    return app.request(amisApi).then((source) => responseAdaptor(source, amisApi));\n};\n"]}]}