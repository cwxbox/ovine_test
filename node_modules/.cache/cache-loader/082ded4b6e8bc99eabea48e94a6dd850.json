{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\request\\index.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\request\\index.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCi8qKgogKiDlsIHoo4UgZmV0Y2gg6K+35rGCCiAqLwp2YXIgX19hd2FpdGVyID0gdGhpcyAmJiB0aGlzLl9fYXdhaXRlciB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHJlc29sdmUodmFsdWUpOwogICAgfSk7CiAgfQoKICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgewogICAgICB0cnkgewogICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJlamVjdChlKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJlamVjdChlKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7CiAgICAgIHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOwogICAgfQoKICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsKICB9KTsKfTsKLyogZXNsaW50LWRpc2FibGUgY29uc2lzdGVudC1yZXR1cm4gKi8KCgppbXBvcnQgeyBnZXRBcGlDYWNoZSwgc2V0QXBpQ2FjaGUgfSBmcm9tICdhbWlzL2xpYi91dGlscy9hcGknOwppbXBvcnQgeyBvYmplY3QyZm9ybURhdGEsIHFzc3RyaW5naWZ5LCBoYXNGaWxlLCBpc0VtcHR5IH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvaGVscGVyJzsKaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvdHBsJzsKaW1wb3J0IHsgZ2V0LCBtYXAsIGlzUGxhaW5PYmplY3QsIGlzRnVuY3Rpb24sIHRvVXBwZXIsIHBpY2sgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBwYXJzZSB9IGZyb20gJ3FzJzsKaW1wb3J0IHsgZmV0Y2ggfSBmcm9tICd3aGF0d2ctZmV0Y2gnOwppbXBvcnQgbG9nZ2VyIGZyb20gIi4uL2xvZ2dlciI7CmltcG9ydCB7IGdldFNlc3Npb25TdG9yZSwgc2V0U2Vzc2lvblN0b3JlIH0gZnJvbSAiLi4vc3RvcmUiOwppbXBvcnQgeyBpc0V4cGlyZWQsIHByb21pc2VkVGltZW91dCwgcm1VcmxSZXBlYXRTbGFudCB9IGZyb20gIi4uL3Rvb2wiOwppbXBvcnQgeyBzYXZlRmlsZSB9IGZyb20gIi4uL2ZpbGUiOwp2YXIgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignbGliOnV0aWxzOnJlcXVlc3QnKTsgLy8g6K+35rGC6ZSZ6K+v6ZuG5Lit5aSE55CG77yMIOW/hemhuyB0aHJvdyDplJnor68KCmZ1bmN0aW9uIHJlcXVlc3RFcnJvckN0cmwoZXJyb3IsIG9wdGlvbiwgcmVzcG9uc2UpIHsKICAvLyBsb2cuaW5mbygncmVxdWVzdEVycm9yQ3RybCcsIHsgZXJyb3IsIG9wdGlvbiwgcmVzcG9uc2UgfSkKICB2YXIgZXJyb3JTb3VyY2UgPSB7CiAgICBvcHRpb24sCiAgICByZXNwb25zZSwKICAgIGVycm9yCiAgfTsKICB2YXIgd2l0aEluc0Vycm9ySG9vayA9IHRydWU7IC8vIOWmguaenOi/lOWbniBmYWxzZe+8jOWImeS4jeiwg+eUqCDlhajlsYDnmoTplJnor6/lpITnkIYKCiAgaWYgKG9wdGlvbi5vbkVycm9yKSB7CiAgICB3aXRoSW5zRXJyb3JIb29rID0gb3B0aW9uLm9uRXJyb3IocmVzcG9uc2UsIG9wdGlvbiwgZXJyb3IpOwogIH0KCiAgaWYgKHdpdGhJbnNFcnJvckhvb2sgIT09IGZhbHNlICYmIHRoaXMub25FcnJvcikgewogICAgdGhpcy5vbkVycm9yKHJlc3BvbnNlLCBvcHRpb24sIGVycm9yKTsKICB9CgogIGlmICh0aGlzLm9uRmluaXNoKSB7CiAgICB0aGlzLm9uRmluaXNoKHJlc3BvbnNlLCBvcHRpb24sIGVycm9yKTsKICB9CgogIHRocm93IGVycm9yU291cmNlOwp9IC8vIOivt+axguaIkOWKn+mbhuS4reWkhOeQhgoKCmZ1bmN0aW9uIHJlcXVlc3RTdWNjZXNzQ3RybChyZXNwb25zZSwgb3B0aW9uKSB7CiAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgIGlmICh0aGlzLm9uU3VjY2VzcykgewogICAgICB2YXIgcmVzID0gd3JhcFJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgcmVzcG9uc2UuZGF0YSA9IHRoaXMub25TdWNjZXNzKHJlcy5kYXRhLCBvcHRpb24sIHJlcyk7CiAgICB9CgogICAgaWYgKG9wdGlvbi5vblN1Y2Nlc3MpIHsKICAgICAgdmFyIF9yZXMgPSB3cmFwUmVzcG9uc2UocmVzcG9uc2UpOwoKICAgICAgcmVzcG9uc2UuZGF0YSA9IHlpZWxkIG9wdGlvbi5vblN1Y2Nlc3MoX3Jlcy5kYXRhLCBvcHRpb24sIF9yZXMpOwogICAgfQoKICAgIGlmICh0aGlzLm9uRmluaXNoKSB7CiAgICAgIHRoaXMub25GaW5pc2god3JhcFJlc3BvbnNlKHJlc3BvbnNlKSwgb3B0aW9uKTsKICAgIH0KICB9KTsKfSAvLyDmqKHmi5/mlbDmja4KCgpmdW5jdGlvbiBtb2NrU291cmNlQ3RybChvcHRpb24pIHsKICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgdmFyIHsKICAgICAgbW9ja1NvdXJjZSwKICAgICAgYXBpLAogICAgICBtZXRob2QsCiAgICAgIHVybCwKICAgICAgbW9jayA9IHRydWUsCiAgICAgIG1vY2tEZWxheSA9IDIwMAogICAgfSA9IG9wdGlvbjsKCiAgICBpZiAoIXRoaXMuaXNNb2NrIHx8ICFtb2NrIHx8ICFtb2NrU291cmNlKSB7CiAgICAgIHJldHVybiAnbm9uZSc7CiAgICB9CgogICAgdmFyIGFwaVN0ciA9IGFwaSB8fCAiIi5jb25jYXQobWV0aG9kLCAiICIpLmNvbmNhdCh1cmwgfHwgJycpOyAvLyBtb2Nr5pWw5o2u55Sf5oiQ5pa55byPCgogICAgdmFyIG1vY2tTb3VyY2VHZW4gPSBnZXQobW9ja1NvdXJjZSwgYXBpU3RyKSA/IG1vY2tTb3VyY2VbYXBpU3RyXSA6IG1vY2tTb3VyY2U7IC8vIG1vY2sg5Y6f5aeL5pWw5o2uCgogICAgdmFyIGZha2VSZXMgPSB7fTsKICAgIGZha2VSZXMuZGF0YSA9IGlzRnVuY3Rpb24obW9ja1NvdXJjZUdlbikgPyBtb2NrU291cmNlR2VuKG9wdGlvbikgOiBtb2NrU291cmNlR2VuOwogICAgeWllbGQgcmVxdWVzdFN1Y2Nlc3NDdHJsLmNhbGwodGhpcywgZmFrZVJlcywgb3B0aW9uKTsKCiAgICBpZiAobW9ja0RlbGF5KSB7CiAgICAgIHlpZWxkIHByb21pc2VkVGltZW91dChtb2NrRGVsYXkpOwogICAgfQoKICAgIGxvZy5sb2coJ21vY2tTb3VyY2UnLCBvcHRpb24udXJsLCBmYWtlUmVzLmRhdGEsIG9wdGlvbik7CiAgICByZXR1cm4gZmFrZVJlczsKICB9KTsKfSAvLyDnvJPlrZjor7fmsYIg5Y+q57yT5a2YIEdFVCDor7fmsYIKCgpmdW5jdGlvbiBjYWNoZVNvdXJjZUN0cmwodHlwZSwgb3B0aW9uLCByZXNvdXJjZSkgewogIHZhciB7CiAgICB1cmwgPSAnJywKICAgIGV4cGlyZWQgPSAwLAogICAgbWV0aG9kID0gJ0dFVCcKICB9ID0gb3B0aW9uIHx8IHt9OwoKICBpZiAoIWV4cGlyZWQgfHwgbWV0aG9kICE9PSAnR0VUJykgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIHRpbWVzdGFtcEtleSA9ICIiLmNvbmNhdCh1cmwsICI6dGltZXN0YW1wIik7CgogIGlmICh0eXBlID09PSAnc2V0JykgewogICAgLy8g5LiN5a2Y5ZyoIHJlc291cmNlIOebtOaOpei/lOWbngogICAgaWYgKCFyZXNvdXJjZSkgewogICAgICByZXR1cm47CiAgICB9IC8vIOaJgOacieaVsOaNruaMieeFpyDlrZfnrKbkuLLnvJPlrZgKCgogICAgc2V0U2Vzc2lvblN0b3JlKHVybCwgcmVzb3VyY2UpOwogICAgc2V0U2Vzc2lvblN0b3JlKHRpbWVzdGFtcEtleSwgKERhdGUubm93KCkgKyBleHBpcmVkKS50b1N0cmluZygpKTsKICAgIHJldHVybjsKICB9CgogIGlmICh0eXBlID09PSAnZ2V0JykgewogICAgdmFyIGNhY2hlZCA9IGdldFNlc3Npb25TdG9yZSh1cmwpOwogICAgdmFyIHdoZW5FeHBpcmVkID0gZ2V0U2Vzc2lvblN0b3JlKHRpbWVzdGFtcEtleSk7CgogICAgaWYgKGNhY2hlZCAmJiB3aGVuRXhwaXJlZCkgewogICAgICBpZiAoIWlzRXhwaXJlZCh3aGVuRXhwaXJlZCkpIHsKICAgICAgICBsb2cubG9nKCdleHBpcmVkU291cmNlJywgb3B0aW9uLnVybCwgY2FjaGVkLCBvcHRpb24pOwogICAgICAgIHJldHVybiBjYWNoZWQ7CiAgICAgIH0KICAgIH0KICB9Cn0gLy8g6K+75Y+WanNvbue7k+aenCzpnZ5KU09O57uT5p6cIOWcqCByZXF1ZXN0IOaooeWdl+WkhOeQhgoKCmZ1bmN0aW9uIHJlYWRKc29uUmVzcG9uc2UocmVzcG9uc2UpIHsKICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgdHJ5IHsKICAgICAgdmFyIHRleHQgPSB5aWVsZCByZXNwb25zZS50ZXh0KCk7CiAgICAgIHJlc3BvbnNlLnJlc3BvbnNlVGV4dCA9IHRleHQ7CiAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh0ZXh0KTsKICAgICAgZGVsZXRlIHJlc3BvbnNlLnJlc3BvbnNlVGV4dDsgLy8g5aaC5p6c6Kej5p6Q5oiQ5YqfIOWwhnJlc3BvbnNlVGV4dCDlj4LmlbDliKDpmaQKCiAgICAgIHJldHVybiBkYXRhOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4ge307CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHNhdmVGaWxlRnJvbVJlcyhvcHRpb25zKSB7CiAgdmFyIHsKICAgIGJsb2IsCiAgICBkaXNwb3NpdGlvbgogIH0gPSBvcHRpb25zOwogIHZhciBmaWxlTmFtZSA9IGdldCgvZmlsZW5hbWU9KC4qKSQvLmV4ZWMoZGlzcG9zaXRpb24pLCAnMScpIHx8IHVuZGVmaW5lZDsKICBzYXZlRmlsZShibG9iLCBmaWxlTmFtZSk7Cn0gLy8g5Y+R5Ye6IGZldGNoIOivt+axggoKCmZ1bmN0aW9uIGZldGNoU291cmNlQ3RybChvcHRpb24pIHsKICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgdmFyIHsKICAgICAgdXJsLAogICAgICBib2R5LAogICAgICBjb25maWcsCiAgICAgIHJlc3BvbnNlVHlwZQogICAgfSA9IG9wdGlvbjsKCiAgICBpZiAoY29uZmlnLm9uVXBsb2FkUHJvZ3Jlc3MgJiYgYm9keSAmJiB0eXBlb2YgWE1MSHR0cFJlcXVlc3QgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHZhciBfcmVzdWx0ID0geWllbGQgdXBsb2FkV2l0aFByb2dyZXNzLmNhbGwodGhpcywgb3B0aW9uKTsKCiAgICAgIHJldHVybiBfcmVzdWx0OwogICAgfQoKICAgIHZhciByZXN1bHQgPSB5aWVsZCBmZXRjaCh1cmwsIG9wdGlvbikuY2F0Y2goZXJyb3IgPT4gewogICAgICByZXF1ZXN0RXJyb3JDdHJsLmNhbGwodGhpcywgZXJyb3IsIG9wdGlvbiwgd3JhcFJlc3BvbnNlKCkpOwogICAgfSkudGhlbihyZXNwb25zZSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgIC8vIOW9kyBmZXRjaCDlj5HnlJ/plJnor6/ml7Yg5LiN5YGa5Lu75L2V5aSE55CGCiAgICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBzdGF0dXMgPSBOdW1iZXIocmVzcG9uc2Uuc3RhdHVzKTsKCiAgICAgIGlmIChzdGF0dXMgPD0gMTAwIHx8IHN0YXR1cyA+PSA0MDApIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmVzcG9uc2UuZGF0YSA9IHlpZWxkIHJlYWRKc29uUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsvLwogICAgICAgIH0KCiAgICAgICAgcmVxdWVzdEVycm9yQ3RybC5jYWxsKHRoaXMsIG5ldyBFcnJvcignc3RhdHVzIDw9IDEwMCB8fCBzdGF0dXMgPj0gNDAwJyksIG9wdGlvbiwgd3JhcFJlc3BvbnNlKHJlc3BvbnNlKSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICdibG9iJyB8fCBjb25maWcucmVzcG9uc2VUeXBlID09PSAnYmxvYicpIHsKICAgICAgICAgIHZhciBibG9iID0geWllbGQgcmVzcG9uc2UuYmxvYigpOwogICAgICAgICAgcmVzcG9uc2UuZGF0YSA9IHsKICAgICAgICAgICAgYmxvYgogICAgICAgICAgfTsKICAgICAgICAgIHNhdmVGaWxlRnJvbVJlcyh7CiAgICAgICAgICAgIGJsb2IsCiAgICAgICAgICAgIGRpc3Bvc2l0aW9uOiByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1EaXNwb3NpdGlvbicpIHx8ICcnCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzcG9uc2UuZGF0YSA9IHlpZWxkIHJlYWRKc29uUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgeWllbGQgcmVxdWVzdFN1Y2Nlc3NDdHJsLmNhbGwodGhpcywgcmVzcG9uc2UsIG9wdGlvbik7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHJlcXVlc3RFcnJvckN0cmwuY2FsbCh0aGlzLCBlcnJvciwgb3B0aW9uLCB3cmFwUmVzcG9uc2UocmVzcG9uc2UpKTsKICAgICAgfQogICAgfSkpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9KTsKfQoKZnVuY3Rpb24gZmFrZVNvdXJjZUN0cmwob3B0aW9uKSB7CiAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgIHZhciBmYWtlUmVxID0gb3B0aW9uLm9uRmFrZVJlcXVlc3Q7CiAgICB2YXIgZmFrZVJlcyA9IHlpZWxkIGZha2VSZXEob3B0aW9uKTsKICAgIHZhciBmYWtlUmVzcG9uc2UgPSB3cmFwUmVzcG9uc2UoZmFrZVJlcyk7CiAgICByZXR1cm4gewogICAgICBkYXRhOiBmYWtlUmVzcG9uc2UKICAgIH07CiAgfSk7Cn0gLy8gZmV0Y2gg5re75YqgIG9uVXBsb2FkUHJvZ3Jlc3Mg5pSv5oyBCgoKZnVuY3Rpb24gdXBsb2FkV2l0aFByb2dyZXNzKG9wdGlvbikgewogIHZhciBlcnJvckN0cmwgPSByZXF1ZXN0RXJyb3JDdHJsLmJpbmQodGhpcyk7CiAgdmFyIHN1Y2Nlc3NDdHJsID0gcmVxdWVzdFN1Y2Nlc3NDdHJsLmJpbmQodGhpcyk7CiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgdmFyIF9hOwoKICAgIHZhciB7CiAgICAgIGNvbmZpZywKICAgICAgbWV0aG9kID0gJycsCiAgICAgIHVybCA9ICcnLAogICAgICBoZWFkZXJzID0ge30sCiAgICAgIGJvZHkKICAgIH0gPSBvcHRpb247CiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICB4aHIub3BlbihtZXRob2QudG9Mb3dlckNhc2UoKSwgdXJsLCB0cnVlKTsgLy8g5YW85a65IHdpdGhDcmVkZW50aWFscyDkuI4gY3JlZGVudGlhbHMg5Y+C5pWwCgogICAgdmFyIGNyZWRlbnRpYWxzID0gKF9hID0gb3B0aW9uLmZldGNoT3B0aW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNyZWRlbnRpYWxzOwoKICAgIGlmIChjb25maWcud2l0aENyZWRlbnRpYWxzIHx8IGNyZWRlbnRpYWxzICYmIGNyZWRlbnRpYWxzICE9PSAnb21pdCcpIHsKICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7CiAgICB9CgogICAgbWFwKGhlYWRlcnMsIChoZWFkZXIsIGtleSkgPT4gewogICAgICBpZiAoeGhyKSB7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoa2V5LCBoZWFkZXIpOwogICAgICB9CiAgICB9KTsKCiAgICBmdW5jdGlvbiBvblhockVycm9yKHN0YXR1cywgdGV4dCkgewogICAgICBlcnJvckN0cmwobmV3IEVycm9yKHRleHQpLCBvcHRpb24sIHdyYXBSZXNwb25zZSh7CiAgICAgICAgc3RhdHVzLAogICAgICAgIGRhdGE6ICh4aHIgPT09IG51bGwgfHwgeGhyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4aHIucmVzcG9uc2UpIHx8ICh4aHIgPT09IG51bGwgfHwgeGhyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4aHIucmVzcG9uc2VUZXh0KSwKICAgICAgICBzdGF0dXNUZXh0OiB4aHIgPT09IG51bGwgfHwgeGhyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4aHIuc3RhdHVzVGV4dAogICAgICB9LCB0cnVlKSk7CiAgICAgIHhociA9IG51bGw7CiAgICB9CgogICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF4aHIgfHwgeGhyLnJlYWR5U3RhdGUgIT09IDQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh4aHIuc3RhdHVzID09PSAwICYmICEoeGhyLnJlc3BvbnNlVVJMICYmIHhoci5yZXNwb25zZVVSTC5pbmRleE9mKCdmaWxlOicpID09PSAwKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHJlc3BvbnNlSGVhZGVycyA9ICh4aHIgPT09IG51bGwgfHwgeGhyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkpIHx8IHt9OwogICAgICB2YXIgcmVzcG9uc2UgPSB7CiAgICAgICAgZGF0YTogeGhyLnJlc3BvbnNlIHx8IHhoci5yZXNwb25zZVRleHQsCiAgICAgICAgc3RhdHVzOiB4aHIuc3RhdHVzLAogICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0LAogICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlSGVhZGVycwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuc3RhdHVzIDw9IDEwMCB8fCB0aGlzLnN0YXR1cyA+PSA0MDApIHsKICAgICAgICBlcnJvckN0cmwobmV3IEVycm9yKCdzdGF0dXMgPD0gMTAwIHx8IHN0YXR1cyA+PSA0MDAnKSwgb3B0aW9uLCB3cmFwUmVzcG9uc2UocmVzcG9uc2UsIHRydWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdWNjZXNzQ3RybCh3cmFwUmVzcG9uc2UocmVzcG9uc2UsIHRydWUpLCBvcHRpb24pLnRoZW4oKCkgPT4gewogICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgeGhyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG9uWGhyRXJyb3IodGhpcy5zdGF0dXMsICdOZXR3b3JrIEVycm9yJyk7CiAgICB9OwoKICAgIHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG9uWGhyRXJyb3IodGhpcy5zdGF0dXMsICdUaW1lT3V0IEVycm9yJyk7CiAgICB9OwoKICAgIGlmICh4aHIudXBsb2FkICYmIGNvbmZpZy51cGxvYWRQcm9ncmVzcykgewogICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBjb25maWcudXBsb2FkUHJvZ3Jlc3M7CiAgICB9CgogICAgeGhyLnNlbmQoYm9keSk7CiAgfSk7Cn0gLy8g6I635Y+WIGZldGNoIOWPguaVsAoKCmZ1bmN0aW9uIGdldEZldGNoT3B0aW9uKG9wdGlvbikgewogIHZhciB7CiAgICBoZWFkZXJzLAogICAgZGF0YSwKICAgIGJvZHksCiAgICBmZXRjaE9wdGlvbnMsCiAgICBkYXRhVHlwZSA9ICdqc29uJywKICAgIHFzT3B0aW9ucwogIH0gPSBvcHRpb247CiAgdmFyIHsKICAgIHVybCwKICAgIG1ldGhvZAogIH0gPSBnZXRVcmxCeU9wdGlvbi5jYWxsKHRoaXMsIG9wdGlvbik7IC8vIOiHquihjOWunueOsOWPlua2iOivt+axgueahOWbnuiwgwoKICB2YXIgewogICAgY2FuY2VsRXhlY3V0b3IsCiAgICB3aXRoQ3JlZGVudGlhbHMKICB9ID0gb3B0aW9uLmNvbmZpZyB8fCB7fTsKICB2YXIgc2lnbmFsID0gbnVsbDsKCiAgaWYgKGNhbmNlbEV4ZWN1dG9yICYmIHR5cGVvZiBBYm9ydENvbnRyb2xsZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICB2YXIgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIHNpZ25hbCA9IGNvbnRyb2xsZXIuc2lnbmFsOwogICAgY2FuY2VsRXhlY3V0b3IoKCkgPT4gewogICAgICBjb250cm9sbGVyLmFib3J0KCk7CiAgICB9KTsKICB9CiAgLyoqCiAgICogYW1pcyBkYXRhVHlwZSDpgLvovpEKICAgKi8KICAvLyBmZXRjaCDor7fmsYLlj4LmlbDlsIHoo4UKCgogIHZhciBmZXRjaEJvZHkgPSBib2R5OwogIHZhciBmZXRjaEhlYWRlcnMgPSBoZWFkZXJzOwoKICBpZiAoaXNFbXB0eShmZXRjaEJvZHkpICYmIGRhdGEgJiYgIS9HRVR8SEVBRHxPUFRJT05TLy50ZXN0KG1ldGhvZCkpIHsKICAgIGlmIChkYXRhIGluc3RhbmNlb2YgRm9ybURhdGEgfHwgZGF0YSBpbnN0YW5jZW9mIEJsb2IgfHwgZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAgIGZldGNoQm9keSA9IGRhdGE7CiAgICB9IGVsc2UgaWYgKGhhc0ZpbGUoZGF0YSkgfHwgZGF0YVR5cGUgPT09ICdmb3JtLWRhdGEnKSB7CiAgICAgIGZldGNoQm9keSA9IG9iamVjdDJmb3JtRGF0YShkYXRhLCBxc09wdGlvbnMpOwogICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PT0gJ2Zvcm0nKSB7CiAgICAgIGZldGNoQm9keSA9IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyA/IGRhdGEgOiBxc3N0cmluZ2lmeShkYXRhLCBxc09wdGlvbnMpOwogICAgICBmZXRjaEhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7CiAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID09PSAnanNvbicpIHsKICAgICAgZmV0Y2hCb2R5ID0gdHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnID8gZGF0YSA6IEpTT04uc3RyaW5naWZ5KGRhdGEpOwogICAgICBmZXRjaEhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nOwogICAgfQogIH0KCiAgdmFyIGZldGNoT3B0aW9uID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBmZXRjaE9wdGlvbnMpLCB7CiAgICBzaWduYWwsCiAgICB1cmwsCiAgICBtZXRob2QsCiAgICBoZWFkZXJzOiBmZXRjaEhlYWRlcnMsCiAgICBib2R5OiBmZXRjaEJvZHkKICB9KTsgLy8g5YW85a65IHdpdGhDcmVkZW50aWFscyDlj4LmlbAKCiAgaWYgKHdpdGhDcmVkZW50aWFscyAmJiAhZmV0Y2hPcHRpb24uY3JlZGVudGlhbHMpIHsKICAgIGZldGNoT3B0aW9uLmNyZWRlbnRpYWxzID0gJ2luY2x1ZGUnOwogIH0KCiAgcmV0dXJuIGZldGNoT3B0aW9uOwp9IC8vIOehruS/nSBkYXRhIOS4gOWumuaYr+WvueixoQoKCmZ1bmN0aW9uIHdyYXBSZXNwb25zZShyZXNwb25zZSwgdHJhbnNKc29uKSB7CiAgaWYgKCFyZXNwb25zZSkgewogICAgdmFyIGZha2VSZXMgPSB7CiAgICAgIGRhdGE6IHt9CiAgICB9OwogICAgcmV0dXJuIGZha2VSZXM7CiAgfQoKICBpZiAodHlwZW9mIHJlc3BvbnNlLmRhdGEgPT09ICd1bmRlZmluZWQnKSB7CiAgICByZXNwb25zZS5kYXRhID0ge307CiAgfSBlbHNlIGlmICghaXNQbGFpbk9iamVjdChyZXNwb25zZS5kYXRhKSkgewogICAgaWYgKCF0cmFuc0pzb24pIHsKICAgICAgcmVzcG9uc2UuZGF0YSA9IHsKICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YQogICAgICB9OwogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9CgogICAgdHJ5IHsKICAgICAgcmVzcG9uc2UuZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UuZGF0YSk7CiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0gY2F0Y2ggKF8pIHsvLwogICAgfQogIH0KCiAgcmV0dXJuIHJlc3BvbnNlOwp9IC8vIOiOt+WPluivt+axguWPguaVsAoKCmZ1bmN0aW9uIGdldFJlcU9wdGlvbihvcHRpb24pIHsKICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgLy8g5a+56LGh5Y+C5pWwIOWFiOWhq+WFhem7mOiupOWAvAogICAgdmFyIG9wdCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7CiAgICAgIGZldGNoT3B0aW9uczoge30sCiAgICAgIGhlYWRlcnM6IHt9LAogICAgICBjb25maWc6IHt9CiAgICB9LCBvcHRpb24pLCBub3JtYWxpemVVcmwob3B0aW9uLnVybCB8fCBvcHRpb24uYXBpIHx8ICcnLCBvcHRpb24ubWV0aG9kKSk7CiAgICB2YXIgewogICAgICBhY3Rpb25BZGRyLAogICAgICBhcGksCiAgICAgIG9uUHJlUmVxdWVzdCwKICAgICAgb25SZXF1ZXN0CiAgICB9ID0gb3B0OwogICAgb3B0LmFwaSA9IGFwaSB8fCBvcHRpb24udXJsOwogICAgb3B0LmFjdGlvbkFkZHIgPSBhY3Rpb25BZGRyIHx8IG9wdC5hcGk7CgogICAgaWYgKCFvcHQudXJsKSB7CiAgICAgIGxvZy5lcnJvcign6K+35rGC5LiA5a6a6KaB5LygIHVybCDlj4LmlbAnLCBvcHRpb24pOwogICAgICByZXF1ZXN0RXJyb3JDdHJsLmNhbGwodGhpcywgbmV3IEVycm9yKCfor7fmsYLkuIDlrpropoHkvKAgdXJsIOWPguaVsCcpLCB3cmFwUmVzcG9uc2UoKSk7CiAgICB9CgogICAgaWYgKHRoaXMub25QcmVSZXF1ZXN0KSB7CiAgICAgIG9wdCA9IHRoaXMub25QcmVSZXF1ZXN0KG9wdCk7CiAgICB9CgogICAgaWYgKG9uUHJlUmVxdWVzdCkgewogICAgICBvcHQgPSB5aWVsZCBvblByZVJlcXVlc3Qob3B0KTsKICAgIH0KCiAgICB2YXIgcmVxT3B0aW9uID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHQpLCBnZXRGZXRjaE9wdGlvbi5jYWxsKHRoaXMsIG9wdCkpOwoKICAgIGlmICh0aGlzLm9uUmVxdWVzdCkgewogICAgICByZXFPcHRpb24gPSB0aGlzLm9uUmVxdWVzdChyZXFPcHRpb24pOwogICAgfQoKICAgIGlmIChvblJlcXVlc3QpIHsKICAgICAgcmVxT3B0aW9uID0gb25SZXF1ZXN0KHJlcU9wdGlvbik7CiAgICB9CgogICAgcmV0dXJuIHJlcU9wdGlvbjsKICB9KTsKfSAvLyDlpITnkIbmoLzlvI/ljJYgVVJMIOWtl+espuS4sgoKCmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVVcmwodXJsU3RyLCBkZWZNZXRob2QpIHsKICB2YXIgbWV0aG9kID0gdG9VcHBlcihkZWZNZXRob2QpOwogIHZhciB1cmwgPSB1cmxTdHI7CgogIGlmICgvXihHRVR8UE9TVHxQVVR8REVMRVRFfFBBVENIfEhFQUR8T1BUSU9OUykgL2kudGVzdCh1cmwpKSB7CiAgICB2YXIgW2FwaU1ldGhvZCwgYXBpU3RyXSA9IHVybFN0ci5zcGxpdCgnICcpOwogICAgbWV0aG9kID0gYXBpTWV0aG9kOwogICAgdXJsID0gYXBpU3RyOwogIH0KCiAgcmV0dXJuIHsKICAgIHVybCwKICAgIG1ldGhvZDogdG9VcHBlcihtZXRob2QpIHx8ICdHRVQnCiAgfTsKfSAvLyDojrflj5YgdXJsIOWPguaVsAoKZXhwb3J0IGZ1bmN0aW9uIGdldFVybEJ5T3B0aW9uKG9wdGlvbikgewogIHZhciB7CiAgICBxc09wdGlvbnMsCiAgICBkYXRhLAogICAgZG9tYWluID0gJ2FwaScsCiAgICBkb21haW5zLAogICAgdXJsOiBvcHRVcmwgPSAnJywKICAgIG1ldGhvZAogIH0gPSBvcHRpb247CiAgdmFyIHVybE9wdGlvbiA9IHsKICAgIHVybDogb3B0VXJsLAogICAgbWV0aG9kCiAgfTsKICB2YXIgYXBpRG9tYWlucyA9IGRvbWFpbnMgfHwgdGhpcy5kb21haW5zIHx8IHt9OwogIHZhciB1cmwgPSBvcHRVcmw7IC8vIHVybOS4reS4jeWtmOWcqCAnaHR0cCcg5Yy56YWNCgogIGlmICghL15odHRwcz86XC9cLy8udGVzdCh1cmwpKSB7CiAgICB2YXIgdXJsUHJlZml4ID0gYXBpRG9tYWluc1tkb21haW5dOwoKICAgIGlmICghdXJsUHJlZml4KSB7CiAgICAgIGxvZy5lcnJvcigncmVxdWVzdC5nZXRVcmxCeU9wdGlvbiDop6PmnpDlh7rplJknLCBvcHRpb24pOwogICAgfQoKICAgIHVybCA9ICIiLmNvbmNhdCh1cmxQcmVmaXgsICIvIikuY29uY2F0KHVybCk7CiAgfSAvLyDliKDpmaTlpJrkuo7nmoTmlpzmnaAKCgogIHVybCA9IHJtVXJsUmVwZWF0U2xhbnQodXJsKTsKICB2YXIgaWR4ID0gdXJsLmluZGV4T2YoJz8nKTsKICB2YXIgaGFzaElkeCA9IHVybC5pbmRleE9mKCcjJyk7CiAgdmFyIGhhc1N0cmluZyA9IGhhc2hJZHggIT09IC0xID8gdXJsLnN1YnN0cmluZyhoYXNoSWR4KSA6ICcnOwoKICBpZiAoL1wkLy50ZXN0KHVybCkpIHsKICAgIHVybCA9IGZpbHRlcih1cmwsIGRhdGEpOwogIH0gLy8g5re75YqgIGdldCDor7fmsYLlj4LmlbAKCgogIGlmICh1cmxPcHRpb24ubWV0aG9kID09PSAnR0VUJyAmJiBkYXRhKSB7CiAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICB2YXIgdXJsUGFyYW1zID0gcGFyc2UodXJsLnN1YnN0cmluZyhpZHggKyAxLCBoYXNoSWR4ICE9PSAtMSA/IGhhc2hJZHggOiB1bmRlZmluZWQpKTsKICAgICAgdmFyIHBhcmFtcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdXJsUGFyYW1zKSwgZGF0YSk7CiAgICAgIHVybCA9ICIiLmNvbmNhdCh1cmwuc3Vic3RyaW5nKDAsIGlkeCksICI/IikuY29uY2F0KHFzc3RyaW5naWZ5KHBhcmFtcywgcXNPcHRpb25zKSkuY29uY2F0KGhhc1N0cmluZyk7CiAgICB9IGVsc2UgewogICAgICB1cmwgKz0gIj8iLmNvbmNhdChxc3N0cmluZ2lmeShkYXRhLCBxc09wdGlvbnMpKS5jb25jYXQoaGFzU3RyaW5nKTsKICAgIH0KICB9CgogIHVybE9wdGlvbi51cmwgPSB1cmw7CiAgcmV0dXJuIHVybE9wdGlvbjsKfSAvLyDkvb/nlKggY2xhc3Mg6IO95aSf5pu05a655piT6YeN5YaZIHJlcXVlc3Qg55qE5LiA5Lqb5Zue6LCD5YC8CgpleHBvcnQgY2xhc3MgUmVxdWVzdCB7CiAgY29uc3RydWN0b3IoY29uZmlnKSB7CiAgICAvLyDphY3nva7nmoTln5/lkI0KICAgIHRoaXMuZG9tYWlucyA9IHt9OwogICAgdGhpcy5zZXRDb25maWcoY29uZmlnKTsKICB9IC8vIOiuvue9rumFjee9rgoKCiAgc2V0Q29uZmlnKGNvbmZpZykgewogICAgdmFyIHsKICAgICAgZG9tYWlucyA9IHt9LAogICAgICBpc01vY2sKICAgIH0gPSBjb25maWcgfHwge307CiAgICB0aGlzLmRvbWFpbnMgPSBkb21haW5zOwogICAgdGhpcy5pc01vY2sgPSBpc01vY2s7CiAgfSAvLyDop6PmnpDor7fmsYLlj4LmlbAKCgogIGdldFVybEJ5T3B0aW9uKG9wdGlvbikgewogICAgcmV0dXJuIGdldFVybEJ5T3B0aW9uLmNhbGwodGhpcywgb3B0aW9uKTsKICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1kdXBlLWNsYXNzLW1lbWJlcnMKCgogIHJlcXVlc3Qob3B0aW9uKSB7CiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICB2YXIgdGhhdCA9IHRoaXM7IC8vIOiOt+WPluivt+axguWPguaVsAoKICAgICAgdmFyIHJlcU9wdGlvbiA9IHlpZWxkIGdldFJlcU9wdGlvbi5jYWxsKHRoYXQsIG9wdGlvbik7CiAgICAgIHZhciB7CiAgICAgICAgb25GYWtlUmVxdWVzdAogICAgICB9ID0gb3B0aW9uOyAvLyDlkb3kuK3nvJPlrZgg55u05o6l6L+U5ZueCgogICAgICB2YXIgY2FjaGVkUmVzcG9uc2UgPSBjYWNoZVNvdXJjZUN0cmwoJ2dldCcsIHJlcU9wdGlvbik7CgogICAgICBpZiAoY2FjaGVkUmVzcG9uc2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZGF0YTogY2FjaGVkUmVzcG9uc2UKICAgICAgICB9OwogICAgICB9IC8vIG1vY2sg5pWw5o2u5oum5oiqCgoKICAgICAgdmFyIG1vY2tTb3VyY2UgPSB5aWVsZCBtb2NrU291cmNlQ3RybC5jYWxsKHRoYXQsIHJlcU9wdGlvbik7CgogICAgICBpZiAobW9ja1NvdXJjZSAhPT0gJ25vbmUnKSB7CiAgICAgICAgY2FjaGVTb3VyY2VDdHJsKCdzZXQnLCByZXFPcHRpb24sIG1vY2tTb3VyY2UuZGF0YSk7CiAgICAgICAgcmV0dXJuIG1vY2tTb3VyY2U7CiAgICAgIH0gLy8g5YW85a65IGNhY2hlIOWPguaVsCwg55So5LqO5aSa6K+35rGC5bm25Y+R5oOF5Ya1CgoKICAgICAgaWYgKHJlcU9wdGlvbi5tZXRob2QgPT09ICdHRVQnICYmIHJlcU9wdGlvbi5jYWNoZSAmJiByZXFPcHRpb24uY2FjaGUgPiAwKSB7CiAgICAgICAgdmFyIGFwaU9iaiA9IHBpY2socmVxT3B0aW9uLCBbJ3VybCcsICdjYWNoZScsICdtZXRob2QnLCAnZGF0YSddKTsKICAgICAgICB2YXIgYXBpQ2FjaGUgPSBnZXRBcGlDYWNoZShhcGlPYmopOwogICAgICAgIGxvZy5kZWJvdW5jZSgoKSA9PiBsb2cubG9nKG9uRmFrZVJlcXVlc3QgPyAnZmFrZUNhY2hlU291cmNlJyA6ICdjYWNoZVNvdXJjZScsIHJlcU9wdGlvbi51cmwsIHJlcU9wdGlvbikpOwoKICAgICAgICBpZiAoYXBpQ2FjaGUpIHsKICAgICAgICAgIHJldHVybiBhcGlDYWNoZS5jYWNoZWRQcm9taXNlOwogICAgICAgIH0gLy8g5Lyq6KOFIOivt+axgiDkuZ/mlK/mjIHnvJPlrZgKCgogICAgICAgIHZhciBjYWNoZWRQcm9taXNlID0gb25GYWtlUmVxdWVzdCA/IGZha2VTb3VyY2VDdHJsLmNhbGwodGhhdCwgcmVxT3B0aW9uKSA6IGZldGNoU291cmNlQ3RybC5jYWxsKHRoYXQsIHJlcU9wdGlvbik7CiAgICAgICAgc2V0QXBpQ2FjaGUoYXBpT2JqLCBjYWNoZWRQcm9taXNlKTsKICAgICAgICByZXR1cm4gY2FjaGVkUHJvbWlzZTsKICAgICAgfSAvLyDkvKroo4Ug6K+35rGCIOebtOaOpei/lOWbnuaVsOaNrgoKCiAgICAgIGlmIChvbkZha2VSZXF1ZXN0KSB7CiAgICAgICAgdmFyIGZha2VSZXNwb25zZSA9IHlpZWxkIGZha2VTb3VyY2VDdHJsLmNhbGwodGhhdCwgcmVxT3B0aW9uKTsKICAgICAgICBsb2cubG9nKCdbZmFrZVNvdXJjZV0nLCBvcHRpb24udXJsLCBmYWtlUmVzcG9uc2UuZGF0YSwgcmVxT3B0aW9uKTsKICAgICAgICByZXR1cm4gZmFrZVJlc3BvbnNlOwogICAgICB9CgogICAgICB2YXIgcmVzcG9uc2UgPSB5aWVsZCBmZXRjaFNvdXJjZUN0cmwuY2FsbCh0aGF0LCByZXFPcHRpb24pOwogICAgICBjYWNoZVNvdXJjZUN0cmwoJ3NldCcsIHJlcU9wdGlvbiwgcmVzcG9uc2UuZGF0YSk7CiAgICAgIGxvZy5sb2coJ1thcGlTb3VyY2VdJywgcmVxT3B0aW9uLnVybCwgcmVzcG9uc2UuZGF0YSwgcmVxT3B0aW9uKTsKICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgfSk7CiAgfQoKICAvLyBAdHMtaWdub3JlCiAgX19yZWFjdHN0YW5kaW5fX3JlZ2VuZXJhdGVCeUV2YWwoa2V5LCBjb2RlKSB7CiAgICAvLyBAdHMtaWdub3JlCiAgICB0aGlzW2tleV0gPSBldmFsKGNvZGUpOwogIH0KCn0KOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgcmVhY3RIb3RMb2FkZXIgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZGVmYXVsdCA6IHVuZGVmaW5lZDsKCiAgaWYgKCFyZWFjdEhvdExvYWRlcikgewogICAgcmV0dXJuOwogIH0KCiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoX19hd2FpdGVyLCAiX19hd2FpdGVyIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIobG9nLCAibG9nIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIocmVxdWVzdEVycm9yQ3RybCwgInJlcXVlc3RFcnJvckN0cmwiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihyZXF1ZXN0U3VjY2Vzc0N0cmwsICJyZXF1ZXN0U3VjY2Vzc0N0cmwiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihtb2NrU291cmNlQ3RybCwgIm1vY2tTb3VyY2VDdHJsIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoY2FjaGVTb3VyY2VDdHJsLCAiY2FjaGVTb3VyY2VDdHJsIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIocmVhZEpzb25SZXNwb25zZSwgInJlYWRKc29uUmVzcG9uc2UiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihzYXZlRmlsZUZyb21SZXMsICJzYXZlRmlsZUZyb21SZXMiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihmZXRjaFNvdXJjZUN0cmwsICJmZXRjaFNvdXJjZUN0cmwiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihmYWtlU291cmNlQ3RybCwgImZha2VTb3VyY2VDdHJsIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIodXBsb2FkV2l0aFByb2dyZXNzLCAidXBsb2FkV2l0aFByb2dyZXNzIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXHJlcXVlc3RcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoZ2V0RmV0Y2hPcHRpb24sICJnZXRGZXRjaE9wdGlvbiIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxyZXF1ZXN0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHdyYXBSZXNwb25zZSwgIndyYXBSZXNwb25zZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxyZXF1ZXN0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGdldFJlcU9wdGlvbiwgImdldFJlcU9wdGlvbiIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxyZXF1ZXN0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKG5vcm1hbGl6ZVVybCwgIm5vcm1hbGl6ZVVybCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxyZXF1ZXN0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGdldFVybEJ5T3B0aW9uLCAiZ2V0VXJsQnlPcHRpb24iLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xccmVxdWVzdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihSZXF1ZXN0LCAiUmVxdWVzdCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxyZXF1ZXN0XFxpbmRleC5qcyIpOwp9KSgpOwoKOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgbGVhdmVNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwubGVhdmVNb2R1bGUgOiB1bmRlZmluZWQ7CiAgbGVhdmVNb2R1bGUgJiYgbGVhdmVNb2R1bGUobW9kdWxlKTsKfSkoKTs="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/utils/request/index.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","getApiCache","setApiCache","object2formData","qsstringify","hasFile","isEmpty","filter","get","map","isPlainObject","isFunction","toUpper","pick","parse","fetch","logger","getSessionStore","setSessionStore","isExpired","promisedTimeout","rmUrlRepeatSlant","saveFile","log","getLogger","requestErrorCtrl","error","option","response","errorSource","withInsErrorHook","onError","onFinish","requestSuccessCtrl","onSuccess","res","wrapResponse","data","mockSourceCtrl","mockSource","api","method","url","mock","mockDelay","isMock","apiStr","mockSourceGen","fakeRes","call","cacheSourceCtrl","type","resource","expired","timestampKey","Date","now","toString","cached","whenExpired","readJsonResponse","text","responseText","JSON","saveFileFromRes","options","blob","disposition","fileName","exec","undefined","fetchSourceCtrl","body","config","responseType","onUploadProgress","XMLHttpRequest","uploadWithProgress","catch","status","Number","Error","headers","fakeSourceCtrl","fakeReq","onFakeRequest","fakeResponse","errorCtrl","bind","successCtrl","_a","xhr","open","toLowerCase","credentials","fetchOptions","withCredentials","header","key","setRequestHeader","onXhrError","statusText","onreadystatechange","readyState","responseURL","indexOf","responseHeaders","getAllResponseHeaders","onerror","ontimeout","upload","uploadProgress","onprogress","send","getFetchOption","dataType","qsOptions","getUrlByOption","cancelExecutor","signal","AbortController","controller","abort","fetchBody","fetchHeaders","test","FormData","Blob","ArrayBuffer","stringify","fetchOption","Object","assign","transJson","_","getReqOption","opt","normalizeUrl","actionAddr","onPreRequest","onRequest","reqOption","urlStr","defMethod","apiMethod","split","domain","domains","optUrl","urlOption","apiDomains","urlPrefix","idx","hashIdx","hasString","substring","urlParams","params","Request","constructor","setConfig","request","that","cachedResponse","cache","apiObj","apiCache","debounce","cachedPromise"],"mappings":"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","sourcesContent":["/**\n * 封装 fetch 请求\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/* eslint-disable consistent-return */\nimport { getApiCache, setApiCache } from 'amis/lib/utils/api';\nimport { object2formData, qsstringify, hasFile, isEmpty } from 'amis/lib/utils/helper';\nimport { filter } from 'amis/lib/utils/tpl';\nimport { get, map, isPlainObject, isFunction, toUpper, pick } from 'lodash';\nimport { parse } from 'qs';\nimport { fetch } from 'whatwg-fetch';\nimport logger from \"../logger\";\nimport { getSessionStore, setSessionStore } from \"../store\";\nimport { isExpired, promisedTimeout, rmUrlRepeatSlant } from \"../tool\";\nimport { saveFile } from \"../file\";\nconst log = logger.getLogger('lib:utils:request');\n// 请求错误集中处理， 必须 throw 错误\nfunction requestErrorCtrl(error, option, response) {\n    // log.info('requestErrorCtrl', { error, option, response })\n    const errorSource = { option, response, error };\n    let withInsErrorHook = true;\n    // 如果返回 false，则不调用 全局的错误处理\n    if (option.onError) {\n        withInsErrorHook = option.onError(response, option, error);\n    }\n    if (withInsErrorHook !== false && this.onError) {\n        this.onError(response, option, error);\n    }\n    if (this.onFinish) {\n        this.onFinish(response, option, error);\n    }\n    throw errorSource;\n}\n// 请求成功集中处理\nfunction requestSuccessCtrl(response, option) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (this.onSuccess) {\n            const res = wrapResponse(response);\n            response.data = this.onSuccess(res.data, option, res);\n        }\n        if (option.onSuccess) {\n            const res = wrapResponse(response);\n            response.data = yield option.onSuccess(res.data, option, res);\n        }\n        if (this.onFinish) {\n            this.onFinish(wrapResponse(response), option);\n        }\n    });\n}\n// 模拟数据\nfunction mockSourceCtrl(option) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const { mockSource, api, method, url, mock = true, mockDelay = 200 } = option;\n        if (!this.isMock || !mock || !mockSource) {\n            return 'none';\n        }\n        const apiStr = api || `${method} ${url || ''}`;\n        // mock数据生成方式\n        const mockSourceGen = get(mockSource, apiStr) ? mockSource[apiStr] : mockSource;\n        // mock 原始数据\n        const fakeRes = {};\n        fakeRes.data = isFunction(mockSourceGen) ? mockSourceGen(option) : mockSourceGen;\n        yield requestSuccessCtrl.call(this, fakeRes, option);\n        if (mockDelay) {\n            yield promisedTimeout(mockDelay);\n        }\n        log.log('mockSource', option.url, fakeRes.data, option);\n        return fakeRes;\n    });\n}\n// 缓存请求 只缓存 GET 请求\nfunction cacheSourceCtrl(type, option, resource) {\n    const { url = '', expired = 0, method = 'GET' } = option || {};\n    if (!expired || method !== 'GET') {\n        return;\n    }\n    const timestampKey = `${url}:timestamp`;\n    if (type === 'set') {\n        // 不存在 resource 直接返回\n        if (!resource) {\n            return;\n        }\n        // 所有数据按照 字符串缓存\n        setSessionStore(url, resource);\n        setSessionStore(timestampKey, (Date.now() + expired).toString());\n        return;\n    }\n    if (type === 'get') {\n        const cached = getSessionStore(url);\n        const whenExpired = getSessionStore(timestampKey);\n        if (cached && whenExpired) {\n            if (!isExpired(whenExpired)) {\n                log.log('expiredSource', option.url, cached, option);\n                return cached;\n            }\n        }\n    }\n}\n// 读取json结果,非JSON结果 在 request 模块处理\nfunction readJsonResponse(response) {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            const text = yield response.text();\n            response.responseText = text;\n            const data = JSON.parse(text);\n            delete response.responseText; // 如果解析成功 将responseText 参数删除\n            return data;\n        }\n        catch (e) {\n            return {};\n        }\n    });\n}\nfunction saveFileFromRes(options) {\n    const { blob, disposition } = options;\n    const fileName = get(/filename=(.*)$/.exec(disposition), '1') || undefined;\n    saveFile(blob, fileName);\n}\n// 发出 fetch 请求\nfunction fetchSourceCtrl(option) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const { url, body, config, responseType } = option;\n        if (config.onUploadProgress && body && typeof XMLHttpRequest !== 'undefined') {\n            const result = yield uploadWithProgress.call(this, option);\n            return result;\n        }\n        const result = yield fetch(url, option)\n            .catch((error) => {\n            requestErrorCtrl.call(this, error, option, wrapResponse());\n        })\n            .then((response) => __awaiter(this, void 0, void 0, function* () {\n            // 当 fetch 发生错误时 不做任何处理\n            if (!response) {\n                return;\n            }\n            const status = Number(response.status);\n            if (status <= 100 || status >= 400) {\n                try {\n                    response.data = yield readJsonResponse(response);\n                }\n                catch (e) {\n                    //\n                }\n                requestErrorCtrl.call(this, new Error('status <= 100 || status >= 400'), option, wrapResponse(response));\n                return;\n            }\n            try {\n                if (responseType === 'blob' || config.responseType === 'blob') {\n                    const blob = yield response.blob();\n                    response.data = { blob };\n                    saveFileFromRes({ blob, disposition: response.headers.get('Content-Disposition') || '' });\n                }\n                else {\n                    response.data = yield readJsonResponse(response);\n                }\n                yield requestSuccessCtrl.call(this, response, option);\n                return response;\n            }\n            catch (error) {\n                requestErrorCtrl.call(this, error, option, wrapResponse(response));\n            }\n        }));\n        return result;\n    });\n}\nfunction fakeSourceCtrl(option) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const fakeReq = option.onFakeRequest;\n        const fakeRes = yield fakeReq(option);\n        const fakeResponse = wrapResponse(fakeRes);\n        return {\n            data: fakeResponse,\n        };\n    });\n}\n// fetch 添加 onUploadProgress 支持\nfunction uploadWithProgress(option) {\n    const errorCtrl = requestErrorCtrl.bind(this);\n    const successCtrl = requestSuccessCtrl.bind(this);\n    return new Promise((resolve) => {\n        var _a;\n        const { config, method = '', url = '', headers = {}, body } = option;\n        let xhr = new XMLHttpRequest();\n        xhr.open(method.toLowerCase(), url, true);\n        // 兼容 withCredentials 与 credentials 参数\n        const credentials = (_a = option.fetchOptions) === null || _a === void 0 ? void 0 : _a.credentials;\n        if (config.withCredentials || (credentials && credentials !== 'omit')) {\n            xhr.withCredentials = true;\n        }\n        map(headers, (header, key) => {\n            if (xhr) {\n                xhr.setRequestHeader(key, header);\n            }\n        });\n        function onXhrError(status, text) {\n            errorCtrl(new Error(text), option, wrapResponse({\n                status,\n                data: (xhr === null || xhr === void 0 ? void 0 : xhr.response) || (xhr === null || xhr === void 0 ? void 0 : xhr.responseText),\n                statusText: xhr === null || xhr === void 0 ? void 0 : xhr.statusText,\n            }, true));\n            xhr = null;\n        }\n        xhr.onreadystatechange = function () {\n            if (!xhr || xhr.readyState !== 4) {\n                return;\n            }\n            if (xhr.status === 0 && !(xhr.responseURL && xhr.responseURL.indexOf('file:') === 0)) {\n                return;\n            }\n            const responseHeaders = (xhr === null || xhr === void 0 ? void 0 : xhr.getAllResponseHeaders()) || {};\n            const response = {\n                data: xhr.response || xhr.responseText,\n                status: xhr.status,\n                statusText: xhr.statusText,\n                headers: responseHeaders,\n            };\n            if (this.status <= 100 || this.status >= 400) {\n                errorCtrl(new Error('status <= 100 || status >= 400'), option, wrapResponse(response, true));\n            }\n            else {\n                successCtrl(wrapResponse(response, true), option).then(() => {\n                    resolve(response);\n                });\n            }\n        };\n        xhr.onerror = function () {\n            onXhrError(this.status, 'Network Error');\n        };\n        xhr.ontimeout = function () {\n            onXhrError(this.status, 'TimeOut Error');\n        };\n        if (xhr.upload && config.uploadProgress) {\n            xhr.upload.onprogress = config.uploadProgress;\n        }\n        xhr.send(body);\n    });\n}\n// 获取 fetch 参数\nfunction getFetchOption(option) {\n    const { headers, data, body, fetchOptions, dataType = 'json', qsOptions } = option;\n    const { url, method } = getUrlByOption.call(this, option);\n    // 自行实现取消请求的回调\n    const { cancelExecutor, withCredentials } = option.config || {};\n    let signal = null;\n    if (cancelExecutor && typeof AbortController !== 'undefined') {\n        const controller = new AbortController();\n        signal = controller.signal;\n        cancelExecutor(() => {\n            controller.abort();\n        });\n    }\n    /**\n     * amis dataType 逻辑\n     */\n    // fetch 请求参数封装\n    let fetchBody = body;\n    const fetchHeaders = headers;\n    if (isEmpty(fetchBody) && data && !/GET|HEAD|OPTIONS/.test(method)) {\n        if (data instanceof FormData || data instanceof Blob || data instanceof ArrayBuffer) {\n            fetchBody = data;\n        }\n        else if (hasFile(data) || dataType === 'form-data') {\n            fetchBody = object2formData(data, qsOptions);\n        }\n        else if (dataType === 'form') {\n            fetchBody = typeof data === 'string' ? data : qsstringify(data, qsOptions);\n            fetchHeaders['Content-Type'] = 'application/x-www-form-urlencoded';\n        }\n        else if (dataType === 'json') {\n            fetchBody = typeof data === 'string' ? data : JSON.stringify(data);\n            fetchHeaders['Content-Type'] = 'application/json';\n        }\n    }\n    const fetchOption = Object.assign(Object.assign({}, fetchOptions), { signal,\n        url,\n        method, headers: fetchHeaders, body: fetchBody });\n    // 兼容 withCredentials 参数\n    if (withCredentials && !fetchOption.credentials) {\n        fetchOption.credentials = 'include';\n    }\n    return fetchOption;\n}\n// 确保 data 一定是对象\nfunction wrapResponse(response, transJson) {\n    if (!response) {\n        const fakeRes = { data: {} };\n        return fakeRes;\n    }\n    if (typeof response.data === 'undefined') {\n        response.data = {};\n    }\n    else if (!isPlainObject(response.data)) {\n        if (!transJson) {\n            response.data = { value: response.data };\n            return response;\n        }\n        try {\n            response.data = JSON.parse(response.data);\n            return response;\n        }\n        catch (_) {\n            //\n        }\n    }\n    return response;\n}\n// 获取请求参数\nfunction getReqOption(option) {\n    return __awaiter(this, void 0, void 0, function* () {\n        // 对象参数 先填充默认值\n        let opt = Object.assign(Object.assign({ fetchOptions: {}, headers: {}, config: {} }, option), normalizeUrl(option.url || option.api || '', option.method));\n        const { actionAddr, api, onPreRequest, onRequest } = opt;\n        opt.api = api || option.url;\n        opt.actionAddr = actionAddr || opt.api;\n        if (!opt.url) {\n            log.error('请求一定要传 url 参数', option);\n            requestErrorCtrl.call(this, new Error('请求一定要传 url 参数'), wrapResponse());\n        }\n        if (this.onPreRequest) {\n            opt = this.onPreRequest(opt);\n        }\n        if (onPreRequest) {\n            opt = yield onPreRequest(opt);\n        }\n        let reqOption = Object.assign(Object.assign({}, opt), getFetchOption.call(this, opt));\n        if (this.onRequest) {\n            reqOption = this.onRequest(reqOption);\n        }\n        if (onRequest) {\n            reqOption = onRequest(reqOption);\n        }\n        return reqOption;\n    });\n}\n// 处理格式化 URL 字符串\nexport function normalizeUrl(urlStr, defMethod) {\n    let method = toUpper(defMethod);\n    let url = urlStr;\n    if (/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS) /i.test(url)) {\n        const [apiMethod, apiStr] = urlStr.split(' ');\n        method = apiMethod;\n        url = apiStr;\n    }\n    return {\n        url,\n        method: (toUpper(method) || 'GET'),\n    };\n}\n// 获取 url 参数\nexport function getUrlByOption(option) {\n    const { qsOptions, data, domain = 'api', domains, url: optUrl = '', method } = option;\n    const urlOption = { url: optUrl, method };\n    const apiDomains = domains || this.domains || {};\n    let url = optUrl;\n    // url中不存在 'http' 匹配\n    if (!/^https?:\\/\\//.test(url)) {\n        const urlPrefix = apiDomains[domain];\n        if (!urlPrefix) {\n            log.error('request.getUrlByOption 解析出错', option);\n        }\n        url = `${urlPrefix}/${url}`;\n    }\n    // 删除多于的斜杠\n    url = rmUrlRepeatSlant(url);\n    const idx = url.indexOf('?');\n    const hashIdx = url.indexOf('#');\n    const hasString = hashIdx !== -1 ? url.substring(hashIdx) : '';\n    if (/\\$/.test(url)) {\n        url = filter(url, data);\n    }\n    // 添加 get 请求参数\n    if (urlOption.method === 'GET' && data) {\n        if (idx !== -1) {\n            const urlParams = parse(url.substring(idx + 1, hashIdx !== -1 ? hashIdx : undefined));\n            const params = Object.assign(Object.assign({}, urlParams), data);\n            url = `${url.substring(0, idx)}?${qsstringify(params, qsOptions)}${hasString}`;\n        }\n        else {\n            url += `?${qsstringify(data, qsOptions)}${hasString}`;\n        }\n    }\n    urlOption.url = url;\n    return urlOption;\n}\n// 使用 class 能够更容易重写 request 的一些回调值\nexport class Request {\n    constructor(config) {\n        // 配置的域名\n        this.domains = {};\n        this.setConfig(config);\n    }\n    // 设置配置\n    setConfig(config) {\n        const { domains = {}, isMock } = config || {};\n        this.domains = domains;\n        this.isMock = isMock;\n    }\n    // 解析请求参数\n    getUrlByOption(option) {\n        return getUrlByOption.call(this, option);\n    }\n    // eslint-disable-next-line no-dupe-class-members\n    request(option) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const that = this;\n            // 获取请求参数\n            const reqOption = yield getReqOption.call(that, option);\n            const { onFakeRequest } = option;\n            // 命中缓存 直接返回\n            const cachedResponse = cacheSourceCtrl('get', reqOption);\n            if (cachedResponse) {\n                return {\n                    data: cachedResponse,\n                };\n            }\n            // mock 数据拦截\n            const mockSource = yield mockSourceCtrl.call(that, reqOption);\n            if (mockSource !== 'none') {\n                cacheSourceCtrl('set', reqOption, mockSource.data);\n                return mockSource;\n            }\n            // 兼容 cache 参数, 用于多请求并发情况\n            if (reqOption.method === 'GET' && reqOption.cache && reqOption.cache > 0) {\n                const apiObj = pick(reqOption, ['url', 'cache', 'method', 'data']);\n                const apiCache = getApiCache(apiObj);\n                log.debounce(() => log.log(onFakeRequest ? 'fakeCacheSource' : 'cacheSource', reqOption.url, reqOption));\n                if (apiCache) {\n                    return apiCache.cachedPromise;\n                }\n                // 伪装 请求 也支持缓存\n                const cachedPromise = onFakeRequest\n                    ? fakeSourceCtrl.call(that, reqOption)\n                    : fetchSourceCtrl.call(that, reqOption);\n                setApiCache(apiObj, cachedPromise);\n                return cachedPromise;\n            }\n            // 伪装 请求 直接返回数据\n            if (onFakeRequest) {\n                const fakeResponse = yield fakeSourceCtrl.call(that, reqOption);\n                log.log('[fakeSource]', option.url, fakeResponse.data, reqOption);\n                return fakeResponse;\n            }\n            const response = yield fetchSourceCtrl.call(that, reqOption);\n            cacheSourceCtrl('set', reqOption, response.data);\n            log.log('[apiSource]', reqOption.url, response.data, reqOption);\n            return response;\n        });\n    }\n}\n"]}]}