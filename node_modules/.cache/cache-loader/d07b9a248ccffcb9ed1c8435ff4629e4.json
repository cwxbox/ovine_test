{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\config.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\config.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCi8qKgogKiBBcHAgcm91dGUg6YWN572uCiAqIFRPRE86IOa3u+WKoCB1bml0IHRlc3QKICovCmltcG9ydCB7IG1hcFRyZWUsIGVhY2hUcmVlIH0gZnJvbSAnYW1pcy9saWIvdXRpbHMvaGVscGVyJzsKaW1wb3J0IHsgY2xvbmVEZWVwLCBsYXN0LCBwaWNrLCBtYXAsIGdldCB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IHN0ckRlbGltaXRlciwgcGFyZW50S2V5IH0gZnJvbSAiLi4vY29uc3RhbnRzIjsKaW1wb3J0IHsgZ2V0UGFnZVByZXNldCB9IGZyb20gIi4vZXhwb3J0cyI7CmltcG9ydCB7IGNoZWNrTGltaXRCeUtleXMsIGNoZWNrTGltaXRCeU5vZGVQYXRoIH0gZnJvbSAiLi9saW1pdC9leHBvcnRzIjsKdmFyIHN0b3JlID0gewogIHJvdXRlc0NvbmZpZzogW10sCiAgYWN0aW9uQWRkck1hcDoge30KfTsgLy8g6Kej5p6Q6YWN572u55qE6Lev55Sx5pWw5o2uCi8vIDEuIOagueaNriBub2RlUGF0aCDnlJ/miJDpu5jorqQgcGF0aCDot6/lvoTlgLwKCnZhciByZXNvbHZlQ29uZmlnID0gbm9kZXMgPT4gewogIHJldHVybiBtYXBUcmVlKG5vZGVzLCAoaXRlbSwgXywgX18sIGl0ZW1Ob2RlcykgPT4gewogICAgdmFyIHsKICAgICAgcGF0aCwKICAgICAgbGltaXRMYWJlbCwKICAgICAgbGFiZWwsCiAgICAgIG5vZGVQYXRoLAogICAgICBleGFjdCwKICAgICAgY2hpbGRyZW4sCiAgICAgIHBhdGhUb0NvbXBvbmVudAogICAgfSA9IGl0ZW07CiAgICB2YXIgbGFzdEl0ZW0gPSBsYXN0KGl0ZW1Ob2Rlcyk7CiAgICBpdGVtLm5vZGVQYXRoID0gIiIuY29uY2F0KChsYXN0SXRlbSA9PT0gbnVsbCB8fCBsYXN0SXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGFzdEl0ZW0ubm9kZVBhdGgpIHx8ICcnLCAiLyIpLmNvbmNhdChub2RlUGF0aCkucmVwbGFjZSgvKFwvXC8pL2csICcvJyk7CiAgICBpdGVtLm5vZGVMYWJlbCA9ICIiLmNvbmNhdCgobGFzdEl0ZW0gPT09IG51bGwgfHwgbGFzdEl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhc3RJdGVtLmxhYmVsKSB8fCAobGFzdEl0ZW0gPT09IG51bGwgfHwgbGFzdEl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhc3RJdGVtLmxpbWl0TGFiZWwpIHx8ICcnLCAiLyIpLmNvbmNhdChsYWJlbCB8fCBsaW1pdExhYmVsIHx8ICcnKTsKCiAgICBpZiAoZXhhY3QgJiYgY2hpbGRyZW4pIHsKICAgICAgLy8g5b2T54i26aG16Z2i5YWB6K646K6/6Zeu5pe277yM6buY6K6k5re75YqgIC9wYXJlbnQg5ZCO57yACiAgICAgIHZhciBsaW1pdEtleSA9ICIiLmNvbmNhdChpdGVtLm5vZGVQYXRoLCAiLyIpLmNvbmNhdChwYXJlbnRLZXkpOyAvLyDmnYPpmZDpgJrov4fvvIzmiY3orr7nva7lr7nlupTnmoQgcGF0aAoKICAgICAgaWYgKGNoZWNrTGltaXRCeU5vZGVQYXRoKGxpbWl0S2V5KSkgewogICAgICAgIGl0ZW0ucGF0aCA9IHBhdGggfHwgaXRlbS5ub2RlUGF0aDsKICAgICAgICBpdGVtLnBhdGhUb0NvbXBvbmVudCA9IHBhdGhUb0NvbXBvbmVudCB8fCBpdGVtLm5vZGVQYXRoIHx8IHBhdGggfHwgJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIGl0ZW0ucGF0aDsKICAgICAgfQogICAgfQoKICAgIGlmICghcGF0aCAmJiAocGF0aFRvQ29tcG9uZW50IHx8ICFjaGlsZHJlbiAmJiAhcGF0aFRvQ29tcG9uZW50KSkgewogICAgICBpdGVtLnBhdGggPSBpdGVtLm5vZGVQYXRoOwogICAgfQoKICAgIHJldHVybiBpdGVtOwogIH0pOwp9OyAvLyDlvZPmnKrorr7nva4gbGltaXRzIOWtl+auteaXtu+8jOS8muaciSB1bmRlZmluZWQg5pi+56S65oOF5Ya1CgoKdmFyIHJlc29sZVByZXNldCA9IGNvbmZpZyA9PiB7CiAgZWFjaFRyZWUoY29uZmlnLCBpdGVtID0+IHsKICAgIHZhciB7CiAgICAgIG5vZGVQYXRoLAogICAgICBub2RlTGFiZWwKICAgIH0gPSBpdGVtOwogICAgdmFyIHByZXNldCA9IGdldFBhZ2VQcmVzZXQoaXRlbSkgfHwgcGljayhpdGVtLCBbJ2FwaXMnLCAnbGltaXRzJ10pOwogICAgdmFyIHsKICAgICAgbGltaXRzLAogICAgICBhcGlzCiAgICB9ID0gcHJlc2V0OyAvLyDlsIYgcHJlc2V0IOmFjee9rueahCBhcGlz77yMIOa3u+WKoOWIsOadg+mZkOmFjee9ruihqOS4rQoKICAgIGlmICghYXBpcykgewogICAgICByZXR1cm47CiAgICB9CgogICAgbWFwKGFwaXMsIGFwaUl0ZW0gPT4gewogICAgICB2YXIgewogICAgICAgIGxpbWl0czogYXBpTmVlZHMsCiAgICAgICAgYWN0aW9uRGVzYywKICAgICAgICBhY3Rpb25BZGRyCiAgICAgIH0gPSBhcGlJdGVtOwogICAgICB2YXIgcHJlc2V0QXBpTmVlZHMgPSB0eXBlb2YgYXBpTmVlZHMgPT09ICdzdHJpbmcnID8gW2FwaU5lZWRzXSA6IGFwaU5lZWRzOyAvLyDorr7nva5BUEnpu5jorqTpgInpobkKCiAgICAgIGFwaUl0ZW0uYWN0aW9uQWRkciA9IGFjdGlvbkFkZHIgfHwgIiIuY29uY2F0KG5vZGVQYXRoKS5jb25jYXQoc3RyRGVsaW1pdGVyKS5jb25jYXQocHJlc2V0QXBpTmVlZHMgPT09IG51bGwgfHwgcHJlc2V0QXBpTmVlZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZXNldEFwaU5lZWRzLmpvaW4oJywnKSk7CiAgICAgIGFwaUl0ZW0uYXBpID0gYXBpSXRlbS51cmwgfHwgJyc7CiAgICAgIHN0b3JlLmFjdGlvbkFkZHJNYXBbYXBpSXRlbS5hY3Rpb25BZGRyXSA9IHsKICAgICAgICBhY3Rpb25EZXNjLAogICAgICAgIGFwaTogYXBpSXRlbS5hcGksCiAgICAgICAgbGFiZWw6ICIiLmNvbmNhdChub2RlTGFiZWwpLmNvbmNhdChzdHJEZWxpbWl0ZXIpLmNvbmNhdChwcmVzZXRBcGlOZWVkcyA9PT0gbnVsbCB8fCBwcmVzZXRBcGlOZWVkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJlc2V0QXBpTmVlZHMubWFwKGkgPT4gZ2V0KGxpbWl0cywgIiIuY29uY2F0KGksICIubGFiZWwiKSkgfHwgJy0tJykuam9pbignLCcpKQogICAgICB9OwogICAgfSk7CiAgfSk7CiAgcmV0dXJuIGNvbmZpZzsKfTsKCmV4cG9ydCBmdW5jdGlvbiBzZXRSb3V0ZXNDb25maWcocm91dGVzKSB7CiAgc3RvcmUucm91dGVzQ29uZmlnID0gcmVzb2xlUHJlc2V0KHJlc29sdmVDb25maWcoY2xvbmVEZWVwKHJvdXRlcykpKTsKfQpleHBvcnQgZnVuY3Rpb24gZ2V0Um91dGVDb25maWcocmVmcmVzaCkgewogIGlmIChyZWZyZXNoKSB7CiAgICAvLyDpmLLmraLkv67mlLnljp/lp4vmlbDmja4KICAgIHJldHVybiBjbG9uZURlZXAoc3RvcmUucm91dGVzQ29uZmlnKTsKICB9CgogIHJldHVybiBzdG9yZS5yb3V0ZXNDb25maWc7Cn0KZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGlvbkFkZHJNYXAoKSB7CiAgbWFwKHN0b3JlLmFjdGlvbkFkZHJNYXAsIChpdGVtLCBrZXkpID0+IHsKICAgIHZhciBbbm9kZVBhdGggPSAnJywgbGltaXRTdHIgPSAnJ10gPSBrZXkuc3BsaXQoc3RyRGVsaW1pdGVyKTsKICAgIHZhciBsaW1pdHMgPSBsaW1pdFN0ci5zcGxpdCgnLCcpIHx8IFtdOwogICAgdmFyIGF1dGggPSAhIWxpbWl0cy5zb21lKGxpbWl0ID0+IGNoZWNrTGltaXRCeUtleXMobGltaXQsIHsKICAgICAgbm9kZVBhdGgKICAgIH0pKTsKICAgIGl0ZW0uYXV0aCA9IGF1dGg7CiAgfSk7CiAgcmV0dXJuIHN0b3JlLmFjdGlvbkFkZHJNYXA7Cn0KOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgcmVhY3RIb3RMb2FkZXIgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZGVmYXVsdCA6IHVuZGVmaW5lZDsKCiAgaWYgKCFyZWFjdEhvdExvYWRlcikgewogICAgcmV0dXJuOwogIH0KCiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoc3RvcmUsICJzdG9yZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcY29uZmlnLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIocmVzb2x2ZUNvbmZpZywgInJlc29sdmVDb25maWciLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGNvbmZpZy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHJlc29sZVByZXNldCwgInJlc29sZVByZXNldCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcY29uZmlnLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoc2V0Um91dGVzQ29uZmlnLCAic2V0Um91dGVzQ29uZmlnIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxjb25maWcuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihnZXRSb3V0ZUNvbmZpZywgImdldFJvdXRlQ29uZmlnIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxjb25maWcuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihnZXRBY3Rpb25BZGRyTWFwLCAiZ2V0QWN0aW9uQWRkck1hcCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcY29uZmlnLmpzIik7Cn0pKCk7Cgo7CgooZnVuY3Rpb24gKCkgewogIHZhciBsZWF2ZU1vZHVsZSA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5sZWF2ZU1vZHVsZSA6IHVuZGVmaW5lZDsKICBsZWF2ZU1vZHVsZSAmJiBsZWF2ZU1vZHVsZShtb2R1bGUpOwp9KSgpOw=="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/routes/config.js"],"names":["mapTree","eachTree","cloneDeep","last","pick","map","get","strDelimiter","parentKey","getPagePreset","checkLimitByKeys","checkLimitByNodePath","store","routesConfig","actionAddrMap","resolveConfig","nodes","item","_","__","itemNodes","path","limitLabel","label","nodePath","exact","children","pathToComponent","lastItem","replace","nodeLabel","limitKey","resolePreset","config","preset","limits","apis","apiItem","apiNeeds","actionDesc","actionAddr","presetApiNeeds","join","api","url","i","setRoutesConfig","routes","getRouteConfig","refresh","getActionAddrMap","key","limitStr","split","auth","some","limit"],"mappings":"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","sourcesContent":["/**\n * App route 配置\n * TODO: 添加 unit test\n */\nimport { mapTree, eachTree } from 'amis/lib/utils/helper';\nimport { cloneDeep, last, pick, map, get } from 'lodash';\nimport { strDelimiter, parentKey } from \"../constants\";\nimport { getPagePreset } from \"./exports\";\nimport { checkLimitByKeys, checkLimitByNodePath } from \"./limit/exports\";\nconst store = {\n    routesConfig: [],\n    actionAddrMap: {},\n};\n// 解析配置的路由数据\n// 1. 根据 nodePath 生成默认 path 路径值\nconst resolveConfig = (nodes) => {\n    return mapTree(nodes, (item, _, __, itemNodes) => {\n        const { path, limitLabel, label, nodePath, exact, children, pathToComponent } = item;\n        const lastItem = last(itemNodes);\n        item.nodePath = `${(lastItem === null || lastItem === void 0 ? void 0 : lastItem.nodePath) || ''}/${nodePath}`.replace(/(\\/\\/)/g, '/');\n        item.nodeLabel = `${(lastItem === null || lastItem === void 0 ? void 0 : lastItem.label) || (lastItem === null || lastItem === void 0 ? void 0 : lastItem.limitLabel) || ''}/${label || limitLabel || ''}`;\n        if (exact && children) {\n            // 当父页面允许访问时，默认添加 /parent 后缀\n            const limitKey = `${item.nodePath}/${parentKey}`;\n            // 权限通过，才设置对应的 path\n            if (checkLimitByNodePath(limitKey)) {\n                item.path = path || item.nodePath;\n                item.pathToComponent = pathToComponent || item.nodePath || path || '';\n            }\n            else {\n                delete item.path;\n            }\n        }\n        if (!path && (pathToComponent || (!children && !pathToComponent))) {\n            item.path = item.nodePath;\n        }\n        return item;\n    });\n};\n// 当未设置 limits 字段时，会有 undefined 显示情况\nconst resolePreset = (config) => {\n    eachTree(config, (item) => {\n        const { nodePath, nodeLabel } = item;\n        const preset = getPagePreset(item) || pick(item, ['apis', 'limits']);\n        const { limits, apis } = preset;\n        // 将 preset 配置的 apis， 添加到权限配置表中\n        if (!apis) {\n            return;\n        }\n        map(apis, (apiItem) => {\n            const { limits: apiNeeds, actionDesc, actionAddr } = apiItem;\n            const presetApiNeeds = typeof apiNeeds === 'string' ? [apiNeeds] : apiNeeds;\n            // 设置API默认选项\n            apiItem.actionAddr = actionAddr || `${nodePath}${strDelimiter}${presetApiNeeds === null || presetApiNeeds === void 0 ? void 0 : presetApiNeeds.join(',')}`;\n            apiItem.api = apiItem.url || '';\n            store.actionAddrMap[apiItem.actionAddr] = {\n                actionDesc,\n                api: apiItem.api,\n                label: `${nodeLabel}${strDelimiter}${presetApiNeeds === null || presetApiNeeds === void 0 ? void 0 : presetApiNeeds.map((i) => get(limits, `${i}.label`) || '--').join(',')}`,\n            };\n        });\n    });\n    return config;\n};\nexport function setRoutesConfig(routes) {\n    store.routesConfig = resolePreset(resolveConfig(cloneDeep(routes)));\n}\nexport function getRouteConfig(refresh) {\n    if (refresh) {\n        // 防止修改原始数据\n        return cloneDeep(store.routesConfig);\n    }\n    return store.routesConfig;\n}\nexport function getActionAddrMap() {\n    map(store.actionAddrMap, (item, key) => {\n        const [nodePath = '', limitStr = ''] = key.split(strDelimiter);\n        const limits = limitStr.split(',') || [];\n        const auth = !!limits.some((limit) => checkLimitByKeys(limit, { nodePath }));\n        item.auth = auth;\n    });\n    return store.actionAddrMap;\n}\n"]}]}