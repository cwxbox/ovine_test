{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\editor\\lib\\stores\\root.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\editor\\lib\\stores\\root.js","mtime":1618319235155},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCmltcG9ydCB7IHRvYXN0IH0gZnJvbSAnYW1pcyc7CmltcG9ydCB7IGlzRW1wdHksIGlzRXF1YWwgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyB0eXBlcyB9IGZyb20gJ21vYngtc3RhdGUtdHJlZSc7CmltcG9ydCB7IGFwcCB9IGZyb20gIi4uLy4uLy4uL2NvcmUvbGliL2FwcCI7CmltcG9ydCB7IGVkaXRvclN0b3JlIH0gZnJvbSAiLi9lZGl0b3IiOwp2YXIgaW5pdFN0YXRlID0gewogIGlzUHJldmlldzogZmFsc2UsCiAgaXNNb2JpbGU6IGZhbHNlLAogIGVkaXRvckluc3RhbmNlOiB7CiAgICBjYW5VbmRvOiAoKSA9PiB7fSwKICAgIGNhblJlZG86ICgpID0+IHt9LAogICAgdW5kbzogKCkgPT4ge30sCiAgICByZWRvOiAoKSA9PiB7fQogIH0KfTsKdmFyIFJvb3RTdG9yZSA9IHR5cGVzLm1vZGVsKCdSb290U3RvcmUnLCB7CiAgaXNNb2JpbGU6IHR5cGVzLmJvb2xlYW4sCiAgaXNQcmV2aWV3OiB0eXBlcy5ib29sZWFuLAogIGxhc3RTYXZlZFNjaGVtYTogdHlwZXMuZnJvemVuKHt9KSwKICBlZGl0b3JJbnN0YW5jZTogdHlwZXMuZnJvemVuKHt9KSwKICBvcHRpb246IHR5cGVzLmZyb3plbih7fSkKfSkudmlld3Moc2VsZiA9PiB7CiAgcmV0dXJuIHsKICAgIC8vIOiEj+aVsOaNruajgOafpe+8jOWmguaenOacquS/neWtmOeahOaVsOaNru+8jOe7meWHuumAguW9k+aPkOekuiBodHRwczovL2Jsb2cuY3Nkbi5uZXQvYmlnMTk4OXdtZi9hcnRpY2xlL2RldGFpbHMvNzAxNDQwMDAKICAgIGdldCBpc0RpcnR5KCkgewogICAgICBpZiAoaXNFbXB0eShzZWxmLmxhc3RTYXZlZFNjaGVtYSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiAhaXNFcXVhbChlZGl0b3JTdG9yZS5zY2hlbWEsIHNlbGYubGFzdFNhdmVkU2NoZW1hKTsKICAgIH0KCiAgfTsKfSkuYWN0aW9ucyhzZWxmID0+IHsKICB2YXIgdG9nZ2xlUHJldmlldyA9IHRvZ2dsZSA9PiB7CiAgICBzZWxmLmlzUHJldmlldyA9IHR5cGVvZiB0b2dnbGUgPT09ICdib29sZWFuJyA/IHRvZ2dsZSA6ICFzZWxmLmlzUHJldmlldzsKICB9OwoKICB2YXIgdG9nZ2xlVmlld01vZGUgPSB0b2dnbGUgPT4gewogICAgc2VsZi5pc01vYmlsZSA9IHR5cGVvZiB0b2dnbGUgPT09ICdib29sZWFuJyA/IHRvZ2dsZSA6ICFzZWxmLmlzTW9iaWxlOwogIH07CgogIHZhciBzZXRMYXN0U2F2ZWRTY2hlbWEgPSBzY2hlbWEgPT4gewogICAgc2VsZi5sYXN0U2F2ZWRTY2hlbWEgPSBzY2hlbWE7CiAgfTsKCiAgdmFyIHNldE9wdGlvbiA9IG9wdGlvbiA9PiB7CiAgICB2YXIgewogICAgICBpbml0QXBpLAogICAgICBnZXRTY2hlbWEsCiAgICAgIHNjaGVtYQogICAgfSA9IG9wdGlvbjsKCiAgICBpZiAoc2NoZW1hKSB7CiAgICAgIGVkaXRvclN0b3JlLnVwZGF0ZVNjaGVtYShzY2hlbWEpOwogICAgfQoKICAgIGlmIChnZXRTY2hlbWEpIHsKICAgICAgZWRpdG9yU3RvcmUudXBkYXRlU2NoZW1hKGdldFNjaGVtYSgpKTsKICAgIH0KCiAgICBpZiAoaW5pdEFwaSkgewogICAgICBhcHAucmVxdWVzdChpbml0QXBpKS50aGVuKHNvdXJjZSA9PiB7CiAgICAgICAgdmFyIHsKICAgICAgICAgIHN0YXR1cywKICAgICAgICAgIGRhdGEsCiAgICAgICAgICBtc2cKICAgICAgICB9ID0gc291cmNlLmRhdGE7CgogICAgICAgIGlmIChzdGF0dXMgIT09IDApIHsKICAgICAgICAgIHRvYXN0LmVycm9yKG1zZyB8fCAn6I635Y+W5pWw5o2u5aSx6LSlJyk7CiAgICAgICAgfQoKICAgICAgICBlZGl0b3JTdG9yZS51cGRhdGVTY2hlbWEoZGF0YSB8fCB7CiAgICAgICAgICB0eXBlOiAncGFnZScsCiAgICAgICAgICBib2R5OiAn5pqC5peg5pWw5o2uJwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgdG9hc3QuZXJyb3IoJ+iOt+WPluaVsOaNruWksei0pScpOwogICAgICB9KTsKICAgIH0KCiAgICBzZWxmLm9wdGlvbiA9IG9wdGlvbjsKICB9OwoKICB2YXIgc2V0RWRpdG9ySW5zdGFuY2UgPSBpbnN0YW5jZSA9PiB7CiAgICBpZiAoIWluc3RhbmNlKSB7CiAgICAgIHNlbGYuZWRpdG9ySW5zdGFuY2UgPSBpbml0U3RhdGUuZWRpdG9ySW5zdGFuY2U7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaW5zID0ge307CiAgICBbJ2NhblVuZG8nLCAnY2FuUmVkbycsICd1bmRvJywgJ3JlZG8nXS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICBpbnNbaXRlbV0gPSBpbnN0YW5jZVtpdGVtXS5iaW5kKGluc3RhbmNlKTsKICAgIH0pOwogICAgc2VsZi5lZGl0b3JJbnN0YW5jZSA9IGluczsKICB9OwoKICByZXR1cm4gewogICAgc2V0T3B0aW9uLAogICAgLy8gc2V0SGlzdG9yeVN0YXR1cywKICAgIHRvZ2dsZVZpZXdNb2RlLAogICAgdG9nZ2xlUHJldmlldywKICAgIHNldExhc3RTYXZlZFNjaGVtYSwKICAgIHNldEVkaXRvckluc3RhbmNlCiAgfTsKfSk7CmV4cG9ydCB2YXIgcm9vdFN0b3JlID0gUm9vdFN0b3JlLmNyZWF0ZShpbml0U3RhdGUpOwo7CgooZnVuY3Rpb24gKCkgewogIHZhciByZWFjdEhvdExvYWRlciA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5kZWZhdWx0IDogdW5kZWZpbmVkOwoKICBpZiAoIXJlYWN0SG90TG9hZGVyKSB7CiAgICByZXR1cm47CiAgfQoKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihpbml0U3RhdGUsICJpbml0U3RhdGUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcZWRpdG9yXFxsaWJcXHN0b3Jlc1xccm9vdC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKFJvb3RTdG9yZSwgIlJvb3RTdG9yZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxlZGl0b3JcXGxpYlxcc3RvcmVzXFxyb290LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIocm9vdFN0b3JlLCAicm9vdFN0b3JlIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGVkaXRvclxcbGliXFxzdG9yZXNcXHJvb3QuanMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmxlYXZlTW9kdWxlIDogdW5kZWZpbmVkOwogIGxlYXZlTW9kdWxlICYmIGxlYXZlTW9kdWxlKG1vZHVsZSk7Cn0pKCk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/editor/lib/stores/root.js"],"names":["toast","isEmpty","isEqual","types","app","editorStore","initState","isPreview","isMobile","editorInstance","canUndo","canRedo","undo","redo","RootStore","model","boolean","lastSavedSchema","frozen","option","views","self","isDirty","schema","actions","togglePreview","toggle","toggleViewMode","setLastSavedSchema","setOption","initApi","getSchema","updateSchema","request","then","source","status","data","msg","error","type","body","catch","setEditorInstance","instance","ins","forEach","item","bind","rootStore","create"],"mappings":"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","sourcesContent":["import { toast } from 'amis';\nimport { isEmpty, isEqual } from 'lodash';\nimport { types } from 'mobx-state-tree';\nimport { app } from \"../../../core/lib/app\";\nimport { editorStore } from \"./editor\";\nconst initState = {\n    isPreview: false,\n    isMobile: false,\n    editorInstance: {\n        canUndo: () => { },\n        canRedo: () => { },\n        undo: () => { },\n        redo: () => { },\n    },\n};\nconst RootStore = types\n    .model('RootStore', {\n    isMobile: types.boolean,\n    isPreview: types.boolean,\n    lastSavedSchema: types.frozen({}),\n    editorInstance: types.frozen({}),\n    option: types.frozen({}),\n})\n    .views((self) => {\n    return {\n        // 脏数据检查，如果未保存的数据，给出适当提示 https://blog.csdn.net/big1989wmf/article/details/70144000\n        get isDirty() {\n            if (isEmpty(self.lastSavedSchema)) {\n                return false;\n            }\n            return !isEqual(editorStore.schema, self.lastSavedSchema);\n        },\n    };\n})\n    .actions((self) => {\n    const togglePreview = (toggle) => {\n        self.isPreview = typeof toggle === 'boolean' ? toggle : !self.isPreview;\n    };\n    const toggleViewMode = (toggle) => {\n        self.isMobile = typeof toggle === 'boolean' ? toggle : !self.isMobile;\n    };\n    const setLastSavedSchema = (schema) => {\n        self.lastSavedSchema = schema;\n    };\n    const setOption = (option) => {\n        const { initApi, getSchema, schema } = option;\n        if (schema) {\n            editorStore.updateSchema(schema);\n        }\n        if (getSchema) {\n            editorStore.updateSchema(getSchema());\n        }\n        if (initApi) {\n            app\n                .request(initApi)\n                .then((source) => {\n                const { status, data, msg } = source.data;\n                if (status !== 0) {\n                    toast.error(msg || '获取数据失败');\n                }\n                editorStore.updateSchema(data || { type: 'page', body: '暂无数据' });\n            })\n                .catch(() => {\n                toast.error('获取数据失败');\n            });\n        }\n        self.option = option;\n    };\n    const setEditorInstance = (instance) => {\n        if (!instance) {\n            self.editorInstance = initState.editorInstance;\n            return;\n        }\n        const ins = {};\n        ['canUndo', 'canRedo', 'undo', 'redo'].forEach((item) => {\n            ins[item] = instance[item].bind(instance);\n        });\n        self.editorInstance = ins;\n    };\n    return {\n        setOption,\n        // setHistoryStatus,\n        toggleViewMode,\n        togglePreview,\n        setLastSavedSchema,\n        setEditorInstance,\n    };\n});\nexport const rootStore = RootStore.create(initState);\n"]}]}