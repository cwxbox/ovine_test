{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--5-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\limit_setting\\index.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\components\\limit_setting\\index.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEFQUCDmnYPpmZDorr7nva7mqKHlnZcKICovCmltcG9ydCB7IFRhYiwgVGFicywgVHJlZSwgdG9hc3QgfSBmcm9tICdhbWlzJzsKaW1wb3J0IHsgZWFjaFRyZWUsIG1hcFRyZWUgfSBmcm9tICdhbWlzL2xpYi91dGlscy9oZWxwZXInOwppbXBvcnQgeyBtYXAgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7CmltcG9ydCB7IHJvdXRlTGltaXRLZXkgfSBmcm9tICIuLi8uLi9jb25zdGFudHMiOwppbXBvcnQgeyBnZXRMaW1pdE1lbnVzIH0gZnJvbSAiLi4vLi4vcm91dGVzL2xpbWl0IjsKaW1wb3J0IHsgY2hlY2tMaW1pdEJ5S2V5cywgY29udmVydExpbWl0U3RyIH0gZnJvbSAiLi4vLi4vcm91dGVzL2xpbWl0L2V4cG9ydHMiOwppbXBvcnQgeyB1c2VJbW1lciB9IGZyb20gIi4uLy4uL3V0aWxzL2hvb2tzIjsKaW1wb3J0IHsgY2xzLCBpc1N1YlN0ciB9IGZyb20gIi4uLy4uL3V0aWxzL3Rvb2wiOwppbXBvcnQgeyBBbWlzIH0gZnJvbSAiLi4vYW1pcy9zY2hlbWEiOwppbXBvcnQgeyBTdHlsZWRMaW1pdCB9IGZyb20gIi4vc3R5bGVkIjsKCnZhciBMaW1pdFNldHRpbmcgPSBwcm9wcyA9PiB7CiAgdmFyIHsKICAgIGxpbWl0OiBpbml0TGltaXQgPSAnJywKICAgIHVzZUFsbExpbWl0LAogICAgY2xhc3NOYW1lLAogICAgc2F2ZUNvbmZpcm1UZXh0LAogICAgb25DYW5jZWxDbGljaywKICAgIHJlbmRlcgogIH0gPSBwcm9wczsKICB2YXIgW3N0YXRlLCBzZXRTdGF0ZV0gPSB1c2VJbW1lcih7CiAgICBhY3RpdmVUYWI6IDAsCiAgICBpc1VuZm9sZGVkOiB0cnVlLAogICAgdmlzaXRlZFRhYnM6IFtdLAogICAgc2VsZWN0ZWRWYWw6ICcnCiAgfSk7CiAgdmFyIHN0b3JlUmVmID0gdXNlUmVmKHt9KTsKICB2YXIgewogICAgYWN0aXZlVGFiLAogICAgdmlzaXRlZFRhYnMsCiAgICBzZWxlY3RlZFZhbCwKICAgIGlzVW5mb2xkZWQKICB9ID0gc3RhdGU7CiAgdmFyIG1lbnVDb25maWcgPSB1c2VNZW1vKCgpID0+IGdldExpbWl0TWVudXMoewogICAgdXNlQWxsTGltaXQKICB9KSwgW10pOwogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpbml0RGF0YSgpOwogIH0sIFtpbml0TGltaXRdKTsKCiAgZnVuY3Rpb24gaW5pdERhdGEoKSB7CiAgICBzZXRTdGF0ZShkID0+IHsKICAgICAgLy8g5Yid5aeL5YyW5q+P5LiqdGFiCiAgICAgIG1lbnVDb25maWcuZm9yRWFjaCgoXywgaW5kZXgpID0+IHsKICAgICAgICBzdG9yZVJlZi5jdXJyZW50W2luZGV4XSA9IGluaXRMaW1pdDsKICAgICAgfSk7CiAgICAgIGQuc2VsZWN0ZWRWYWwgPSBpbml0TGltaXQ7CiAgICAgIGQudmlzaXRlZFRhYnMgPSBbXTsKICAgIH0pOwogIH0KCiAgdmFyIHRvZ2dsZUZvbGQgPSB0b2dnbGUgPT4gewogICAgc2V0U3RhdGUoZCA9PiB7CiAgICAgIGQuaXNVbmZvbGRlZCA9IHRvZ2dsZTsKICAgIH0pOwogIH07IC8vIFRPRE86IOW8lei1tyDkvZPpqozkuI3mtYHnlYUgIFRyZWUg5oqY5Y+gQlVHCgoKICB2YXIgb25UcmVlQ2hhbmdlID0gdmFsdWUgPT4gewogICAgdmFyIGxpbWl0VmFsdWUgPSByZXNvbHZlU2VsZWN0VmFsKG1lbnVDb25maWcsIHZhbHVlKTsKICAgIHN0b3JlUmVmLmN1cnJlbnRbYWN0aXZlVGFiXSA9IGxpbWl0VmFsdWU7CiAgICBzZXRTdGF0ZShkID0+IHsKICAgICAgZC5zZWxlY3RlZFZhbCA9IGxpbWl0VmFsdWU7CiAgICAgIGQuaXNVbmZvbGRlZCA9IHVuZGVmaW5lZDsKCiAgICAgIGlmICghZC52aXNpdGVkVGFicy5maWx0ZXIodGFiID0+IHRhYiA9PT0gYWN0aXZlVGFiKS5sZW5ndGgpIHsKICAgICAgICBkLnZpc2l0ZWRUYWJzLnB1c2goYWN0aXZlVGFiKTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgdmFyIG9uVGFiU2VsZWN0ID0gdGFiID0+IHsKICAgIHNldFN0YXRlKGQgPT4gewogICAgICBkLmFjdGl2ZVRhYiA9IE51bWJlcih0YWIpOwogICAgICBkLmlzVW5mb2xkZWQgPSB1bmRlZmluZWQ7CiAgICAgIGQuc2VsZWN0ZWRWYWwgPSBzdG9yZVJlZi5jdXJyZW50W3RhYl07CiAgICB9KTsKICB9OwoKICB2YXIgb25TYXZlQ2xpY2sgPSAoKSA9PiB7CiAgICB2YXIgYXV0aExpbWl0ID0gZ2V0QWxsQXV0aExpbWl0U3RyKG1lbnVDb25maWcsIHZpc2l0ZWRUYWJzLCBzdG9yZVJlZi5jdXJyZW50KTsKICAgIHZhciBhdXRoQXBpID0gZ2V0QWxsQXV0aEFwaVN0cihtZW51Q29uZmlnLCBhdXRoTGltaXQpOwoKICAgIGlmIChwcm9wcy5vblNhdmVDbGljaykgewogICAgICBwcm9wcy5vblNhdmVDbGljayh7CiAgICAgICAgYXV0aEFwaSwKICAgICAgICBhdXRoTGltaXQKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdmFyIGJ1dHRvbnNTY2hlbWEgPSB7CiAgICB0eXBlOiAnYnV0dG9uLXRvb2xiYXInLAogICAgYnV0dG9uczogW3sKICAgICAgdHlwZTogJ2J1dHRvbi1ncm91cCcsCiAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgdHlwZTogJ2J1dHRvbicsCiAgICAgICAgbGFiZWw6ICflsZXlvIAnLAogICAgICAgIGNsYXNzTmFtZTogY2xzKHsKICAgICAgICAgICdpcy1hY3RpdmUnOiBpc1VuZm9sZGVkID09PSB0cnVlCiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogKCkgPT4gdG9nZ2xlRm9sZCh0cnVlKQogICAgICB9LCB7CiAgICAgICAgdHlwZTogJ2J1dHRvbicsCiAgICAgICAgbGFiZWw6ICfmipjlj6AnLAogICAgICAgIGNsYXNzTmFtZTogY2xzKHsKICAgICAgICAgICdpcy1hY3RpdmUnOiBpc1VuZm9sZGVkID09PSBmYWxzZQogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6ICgpID0+IHRvZ2dsZUZvbGQoZmFsc2UpCiAgICAgIH0sIHsKICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICBsYWJlbDogJ+mHjee9ricsCiAgICAgICAgdG9vbHRpcDogJ+WPquiDvemHjee9ruacquaPkOS6pOeahOmDqOWIhicsCiAgICAgICAgdG9vbHRpcFBsYWNlbWVudDogJ3RvcCcsCiAgICAgICAgb25DbGljazogKCkgPT4gewogICAgICAgICAgaW5pdERhdGEoKTsKICAgICAgICAgIHRvYXN0LnN1Y2Nlc3MoJ+mHjee9ruaIkOWKnycsICfmj5DnpLonKTsKICAgICAgICB9CiAgICAgIH1dCiAgICB9LCB7CiAgICAgIHR5cGU6ICdhY3Rpb24nLAogICAgICBpY29uOiAnZmEgZmEtY2hlY2sgdGV4dC1zdWNjZXNzJywKICAgICAgYWN0aW9uVHlwZTogJ2Nsb3NlJywKICAgICAgY29uZmlybVRleHQ6IHNhdmVDb25maXJtVGV4dCwKICAgICAgdG9vbHRpcDogJ+aPkOS6pCcsCiAgICAgIHRvb2x0aXBQbGFjZW1lbnQ6ICd0b3AnLAogICAgICBvbkFjdGlvbjogb25TYXZlQ2xpY2sKICAgIH0sIHsKICAgICAgdHlwZTogJ2FjdGlvbicsCiAgICAgIGljb246ICdmYSBmYS10aW1lcyB0ZXh0LWRhbmdlcicsCiAgICAgIGFjdGlvblR5cGU6ICdjbG9zZScsCiAgICAgIGNvbmZpcm1UZXh0OiAhdmlzaXRlZFRhYnMubGVuZ3RoID8gJycgOiAn5YWz6Zet5bCG6KeG5Li65oKo5Li75Yqo5pS+5byD5pys5qyh5L+u5pS544CCJywKICAgICAgdG9vbHRpcDogJ+WPlua2iCcsCiAgICAgIHRvb2x0aXBQbGFjZW1lbnQ6ICd0b3AnLAogICAgICBvbkFjdGlvbjogb25DYW5jZWxDbGljawogICAgfV0KICB9OwogIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChTdHlsZWRMaW1pdCwgewogICAgY2xhc3NOYW1lOiBjbGFzc05hbWUKICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgY2xhc3NOYW1lOiAiYWN0aW9uLWJ0bnMiCiAgfSwgcmVuZGVyID8gcmVuZGVyKCdib2R5JywgYnV0dG9uc1NjaGVtYSkgOiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBbWlzLCB7CiAgICBzY2hlbWE6IGJ1dHRvbnNTY2hlbWEKICB9KSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRhYnMsIHsKICAgIGFjdGl2ZUtleTogYWN0aXZlVGFiLAogICAgbW9kZTogImxpbmUiLAogICAgb25TZWxlY3Q6IG9uVGFiU2VsZWN0CiAgfSwgcmVzb2x2ZUxpbWl0TWVudXMobWVudUNvbmZpZywgewogICAgbGltaXRWYWx1ZTogc2VsZWN0ZWRWYWwKICB9KS5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7CiAgICBpZiAoIWl0ZW0uY2hpbGRyZW4pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFRhYiwgewogICAgICBrZXk6IGluZGV4LAogICAgICB0aXRsZTogaXRlbS5saW1pdExhYmVsIHx8IGl0ZW0ubGFiZWwsCiAgICAgIGljb246IGl0ZW0uaWNvbiwKICAgICAgZXZlbnRLZXk6IGluZGV4CiAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChUcmVlLCB7CiAgICAgIGhpZGVSb290OiB0cnVlLAogICAgICBtdWx0aXBsZTogdHJ1ZSwKICAgICAgam9pblZhbHVlczogdHJ1ZSwKICAgICAgd2l0aENoaWxkcmVuOiB0cnVlLAogICAgICBpbml0aWFsbHlPcGVuOiBpc1VuZm9sZGVkLAogICAgICB2YWx1ZTogc2VsZWN0ZWRWYWwsCiAgICAgIHZhbHVlRmllbGQ6ICJub2RlUGF0aCIsCiAgICAgIG9wdGlvbnM6IGl0ZW0uY2hpbGRyZW4sCiAgICAgIG9uQ2hhbmdlOiBvblRyZWVDaGFuZ2UKICAgIH0pKTsKICB9KSkpOwp9OyAvLyDlpITnkIYg5p2D6ZmQ6K6+572u55qE5YC8CgoKZnVuY3Rpb24gcmVzb2x2ZVNlbGVjdFZhbChtZW51c0NvbmZpZywgbGltaXRWYWx1ZSkgewogIHZhciBsaW1pdHMgPSBjb252ZXJ0TGltaXRTdHIobGltaXRWYWx1ZSk7CiAgZWFjaFRyZWUobWVudXNDb25maWcsIGl0ZW0gPT4gewogICAgdmFyIHsKICAgICAgbmVlZHMsCiAgICAgIG5vZGVQYXRoCiAgICB9ID0gaXRlbTsKCiAgICBpZiAoIW5lZWRzIHx8IGlzU3ViU3RyKG5vZGVQYXRoLCByb3V0ZUxpbWl0S2V5KSkgewogICAgICByZXR1cm47CiAgICB9IC8vIOWJjee9ruadg+mZkOS4jea7oei2s+aXtu+8jOiHquWKqOaSpOmUgAoKCiAgICB2YXIgb21pdCA9ICFjaGVja0xpbWl0QnlLZXlzKG5lZWRzLCB7CiAgICAgIG5vZGVQYXRoLAogICAgICBsaW1pdHMKICAgIH0pOwoKICAgIGlmIChvbWl0KSB7CiAgICAgIGRlbGV0ZSBsaW1pdHNbbm9kZVBhdGhdOwogICAgfQogIH0pOwogIHZhciBuZXdMaW1pdFZhbHVlID0gT2JqZWN0LmtleXMobGltaXRzKS5qb2luKCcsJyk7CiAgcmV0dXJuIG5ld0xpbWl0VmFsdWU7Cn0gLy8g5aSE55CGIOadg+mZkOmFjee9ruihqAoKCmZ1bmN0aW9uIHJlc29sdmVMaW1pdE1lbnVzKG1lbnVzQ29uZmlnLCBvcHRpb24pIHsKICB2YXIgewogICAgbGltaXRWYWx1ZQogIH0gPSBvcHRpb247CiAgdmFyIGxpbWl0cyA9IGNvbnZlcnRMaW1pdFN0cihsaW1pdFZhbHVlKTsKICByZXR1cm4gbWFwVHJlZShtZW51c0NvbmZpZywgaXRlbSA9PiB7CiAgICB2YXIgewogICAgICBuZWVkcywKICAgICAgbm9kZVBhdGgKICAgIH0gPSBpdGVtOyAvLyBpdGVtLnVuZm9sZGVkID0gaXNVbmZvbGRlZAoKICAgIGlmICghbmVlZHMgfHwgaXNTdWJTdHIobm9kZVBhdGgsIHJvdXRlTGltaXRLZXkpKSB7CiAgICAgIHJldHVybiBpdGVtOwogICAgfSAvLyDliY3nva7mnYPpmZDkuI3mu6HotrPml7bvvIznpoHnlKgKCgogICAgaXRlbS5kaXNhYmxlZCA9ICFjaGVja0xpbWl0QnlLZXlzKG5lZWRzLCB7CiAgICAgIG5vZGVQYXRoLAogICAgICBsaW1pdHMKICAgIH0pOwogICAgcmV0dXJuIGl0ZW07CiAgfSk7Cn0gLy8g6I635Y+W5omA5pyJ6KKr5YWB6K6455qE5p2D6ZmQCgoKZnVuY3Rpb24gZ2V0QWxsQXV0aExpbWl0U3RyKG1lbnVzQ29uZmlnLCB2aXNpdGVkVGFicywgc3RvcmUpIHsKICB2YXIgbGltaXRWYWx1ZSA9IFtdOwogIG1hcChzdG9yZSwgKHZhbHVlLCBzdG9yZVRhYikgPT4gewogICAgdmFyIF9hOwoKICAgIHZhciBpbmRleCA9IE51bWJlcihzdG9yZVRhYik7CgogICAgaWYgKHZhbHVlICYmIHZpc2l0ZWRUYWJzLmZpbmRJbmRleCh0YWIgPT4gdGFiID09PSBpbmRleCkgPiAtMSkgewogICAgICBsaW1pdFZhbHVlLnB1c2godmFsdWUpOwogICAgICByZXR1cm47CiAgICB9CgogICAgZWFjaFRyZWUoKChfYSA9IG1lbnVzQ29uZmlnW2luZGV4XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNoaWxkcmVuKSB8fCBbXSwgaXRlbSA9PiB7CiAgICAgIHZhciBsaW1pdHMgPSBjb252ZXJ0TGltaXRTdHIodmFsdWUpOwoKICAgICAgaWYgKGl0ZW0ubm9kZVBhdGggJiYgbGltaXRzW2l0ZW0ubm9kZVBhdGhdKSB7CiAgICAgICAgbGltaXRWYWx1ZS5wdXNoKGl0ZW0ubm9kZVBhdGgpOwogICAgICB9CiAgICB9KTsKICB9KTsKICByZXR1cm4gbGltaXRWYWx1ZS5qb2luKCcsJyk7Cn0gLy8g6I635Y+W5omA5pyJIOiiq+WFgeiuuOeahCBhcGkKCgpmdW5jdGlvbiBnZXRBbGxBdXRoQXBpU3RyKG1lbnVzQ29uZmlnLCBsaW1pdFZhbHVlKSB7CiAgdmFyIGxpbWl0cyA9IGNvbnZlcnRMaW1pdFN0cihsaW1pdFZhbHVlKTsKICB2YXIgYXV0aEFwaXMgPSB7fTsKICBlYWNoVHJlZShtZW51c0NvbmZpZywgaXRlbSA9PiB7CiAgICB2YXIgewogICAgICBub2RlUGF0aCwKICAgICAgYXBpcwogICAgfSA9IGl0ZW07CgogICAgaWYgKCFhcGlzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBPYmplY3QudmFsdWVzKGFwaXMpLmZvckVhY2goYXBpSXRlbSA9PiB7CiAgICAgIHZhciB7CiAgICAgICAgdXJsID0gJycsCiAgICAgICAga2V5LAogICAgICAgIGxpbWl0czogYXBpTGltaXRzCiAgICAgIH0gPSBhcGlJdGVtOwogICAgICB2YXIgYXV0aCA9ICFhcGlMaW1pdHMgPyB0cnVlIDogY2hlY2tMaW1pdEJ5S2V5cyhhcGlMaW1pdHMsIHsKICAgICAgICBub2RlUGF0aCwKICAgICAgICBsaW1pdHMKICAgICAgfSk7CgogICAgICBpZiAoYXV0aCkgewogICAgICAgIGF1dGhBcGlzW2tleSB8fCB1cmxdID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgdmFyIGFwaVZhbHVlID0gT2JqZWN0LmtleXMoYXV0aEFwaXMpLmpvaW4oJywnKTsKICByZXR1cm4gYXBpVmFsdWU7Cn0KCmV4cG9ydCBkZWZhdWx0IExpbWl0U2V0dGluZzs="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/components/limit_setting/index.js"],"names":["Tab","Tabs","Tree","toast","eachTree","mapTree","map","React","useEffect","useRef","useMemo","routeLimitKey","getLimitMenus","checkLimitByKeys","convertLimitStr","useImmer","cls","isSubStr","Amis","StyledLimit","LimitSetting","props","limit","initLimit","useAllLimit","className","saveConfirmText","onCancelClick","render","state","setState","activeTab","isUnfolded","visitedTabs","selectedVal","storeRef","menuConfig","initData","d","forEach","_","index","current","toggleFold","toggle","onTreeChange","value","limitValue","resolveSelectVal","undefined","filter","tab","length","push","onTabSelect","Number","onSaveClick","authLimit","getAllAuthLimitStr","authApi","getAllAuthApiStr","buttonsSchema","type","buttons","label","onClick","tooltip","tooltipPlacement","success","icon","actionType","confirmText","onAction","createElement","schema","activeKey","mode","onSelect","resolveLimitMenus","item","children","key","title","limitLabel","eventKey","hideRoot","multiple","joinValues","withChildren","initiallyOpen","valueField","options","onChange","menusConfig","limits","needs","nodePath","omit","newLimitValue","Object","keys","join","option","disabled","store","storeTab","_a","findIndex","authApis","apis","values","apiItem","url","apiLimits","auth","apiValue"],"mappings":"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","sourcesContent":["/**\n * APP 权限设置模块\n */\nimport { Tab, Tabs, Tree, toast } from 'amis';\nimport { eachTree, mapTree } from 'amis/lib/utils/helper';\nimport { map } from 'lodash';\nimport React, { useEffect, useRef, useMemo } from 'react';\nimport { routeLimitKey } from \"../../constants\";\nimport { getLimitMenus } from \"../../routes/limit\";\nimport { checkLimitByKeys, convertLimitStr } from \"../../routes/limit/exports\";\nimport { useImmer } from \"../../utils/hooks\";\nimport { cls, isSubStr } from \"../../utils/tool\";\nimport { Amis } from \"../amis/schema\";\nimport { StyledLimit } from \"./styled\";\nconst LimitSetting = (props) => {\n    const { limit: initLimit = '', useAllLimit, className, saveConfirmText, onCancelClick, render, } = props;\n    const [state, setState] = useImmer({\n        activeTab: 0,\n        isUnfolded: true,\n        visitedTabs: [],\n        selectedVal: '',\n    });\n    const storeRef = useRef({});\n    const { activeTab, visitedTabs, selectedVal, isUnfolded } = state;\n    const menuConfig = useMemo(() => getLimitMenus({ useAllLimit }), []);\n    useEffect(() => {\n        initData();\n    }, [initLimit]);\n    function initData() {\n        setState((d) => {\n            // 初始化每个tab\n            menuConfig.forEach((_, index) => {\n                storeRef.current[index] = initLimit;\n            });\n            d.selectedVal = initLimit;\n            d.visitedTabs = [];\n        });\n    }\n    const toggleFold = (toggle) => {\n        setState((d) => {\n            d.isUnfolded = toggle;\n        });\n    };\n    // TODO: 引起 体验不流畅  Tree 折叠BUG\n    const onTreeChange = (value) => {\n        const limitValue = resolveSelectVal(menuConfig, value);\n        storeRef.current[activeTab] = limitValue;\n        setState((d) => {\n            d.selectedVal = limitValue;\n            d.isUnfolded = undefined;\n            if (!d.visitedTabs.filter((tab) => tab === activeTab).length) {\n                d.visitedTabs.push(activeTab);\n            }\n        });\n    };\n    const onTabSelect = (tab) => {\n        setState((d) => {\n            d.activeTab = Number(tab);\n            d.isUnfolded = undefined;\n            d.selectedVal = storeRef.current[tab];\n        });\n    };\n    const onSaveClick = () => {\n        const authLimit = getAllAuthLimitStr(menuConfig, visitedTabs, storeRef.current);\n        const authApi = getAllAuthApiStr(menuConfig, authLimit);\n        if (props.onSaveClick) {\n            props.onSaveClick({\n                authApi,\n                authLimit,\n            });\n        }\n    };\n    const buttonsSchema = {\n        type: 'button-toolbar',\n        buttons: [\n            {\n                type: 'button-group',\n                buttons: [\n                    {\n                        type: 'button',\n                        label: '展开',\n                        className: cls({ 'is-active': isUnfolded === true }),\n                        onClick: () => toggleFold(true),\n                    },\n                    {\n                        type: 'button',\n                        label: '折叠',\n                        className: cls({ 'is-active': isUnfolded === false }),\n                        onClick: () => toggleFold(false),\n                    },\n                    {\n                        type: 'button',\n                        label: '重置',\n                        tooltip: '只能重置未提交的部分',\n                        tooltipPlacement: 'top',\n                        onClick: () => {\n                            initData();\n                            toast.success('重置成功', '提示');\n                        },\n                    },\n                ],\n            },\n            {\n                type: 'action',\n                icon: 'fa fa-check text-success',\n                actionType: 'close',\n                confirmText: saveConfirmText,\n                tooltip: '提交',\n                tooltipPlacement: 'top',\n                onAction: onSaveClick,\n            },\n            {\n                type: 'action',\n                icon: 'fa fa-times text-danger',\n                actionType: 'close',\n                confirmText: !visitedTabs.length ? '' : '关闭将视为您主动放弃本次修改。',\n                tooltip: '取消',\n                tooltipPlacement: 'top',\n                onAction: onCancelClick,\n            },\n        ],\n    };\n    return (React.createElement(StyledLimit, { className: className },\n        React.createElement(\"div\", { className: \"action-btns\" }, render ? render('body', buttonsSchema) : React.createElement(Amis, { schema: buttonsSchema })),\n        React.createElement(Tabs, { activeKey: activeTab, mode: \"line\", onSelect: onTabSelect }, resolveLimitMenus(menuConfig, { limitValue: selectedVal }).map((item, index) => {\n            if (!item.children) {\n                return null;\n            }\n            return (React.createElement(Tab, { key: index, title: item.limitLabel || item.label, icon: item.icon, eventKey: index },\n                React.createElement(Tree, { hideRoot: true, multiple: true, joinValues: true, withChildren: true, initiallyOpen: isUnfolded, value: selectedVal, valueField: \"nodePath\", options: item.children, onChange: onTreeChange })));\n        }))));\n};\n// 处理 权限设置的值\nfunction resolveSelectVal(menusConfig, limitValue) {\n    const limits = convertLimitStr(limitValue);\n    eachTree(menusConfig, (item) => {\n        const { needs, nodePath } = item;\n        if (!needs || isSubStr(nodePath, routeLimitKey)) {\n            return;\n        }\n        // 前置权限不满足时，自动撤销\n        const omit = !checkLimitByKeys(needs, { nodePath, limits });\n        if (omit) {\n            delete limits[nodePath];\n        }\n    });\n    const newLimitValue = Object.keys(limits).join(',');\n    return newLimitValue;\n}\n// 处理 权限配置表\nfunction resolveLimitMenus(menusConfig, option) {\n    const { limitValue } = option;\n    const limits = convertLimitStr(limitValue);\n    return mapTree(menusConfig, (item) => {\n        const { needs, nodePath } = item;\n        // item.unfolded = isUnfolded\n        if (!needs || isSubStr(nodePath, routeLimitKey)) {\n            return item;\n        }\n        // 前置权限不满足时，禁用\n        item.disabled = !checkLimitByKeys(needs, { nodePath, limits });\n        return item;\n    });\n}\n// 获取所有被允许的权限\nfunction getAllAuthLimitStr(menusConfig, visitedTabs, store) {\n    const limitValue = [];\n    map(store, (value, storeTab) => {\n        var _a;\n        const index = Number(storeTab);\n        if (value && visitedTabs.findIndex((tab) => tab === index) > -1) {\n            limitValue.push(value);\n            return;\n        }\n        eachTree(((_a = menusConfig[index]) === null || _a === void 0 ? void 0 : _a.children) || [], (item) => {\n            const limits = convertLimitStr(value);\n            if (item.nodePath && limits[item.nodePath]) {\n                limitValue.push(item.nodePath);\n            }\n        });\n    });\n    return limitValue.join(',');\n}\n// 获取所有 被允许的 api\nfunction getAllAuthApiStr(menusConfig, limitValue) {\n    const limits = convertLimitStr(limitValue);\n    const authApis = {};\n    eachTree(menusConfig, (item) => {\n        const { nodePath, apis } = item;\n        if (!apis) {\n            return;\n        }\n        Object.values(apis).forEach((apiItem) => {\n            const { url = '', key, limits: apiLimits } = apiItem;\n            const auth = !apiLimits ? true : checkLimitByKeys(apiLimits, { nodePath, limits });\n            if (auth) {\n                authApis[key || url] = true;\n            }\n        });\n    });\n    const apiValue = Object.keys(authApis).join(',');\n    return apiValue;\n}\nexport default LimitSetting;\n"]}]}