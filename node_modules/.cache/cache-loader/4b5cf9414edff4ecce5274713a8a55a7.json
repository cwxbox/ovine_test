{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\exports.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\exports.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCi8qKgogKiBBUFAg5p2D6ZmQ55u45YWz5bel5YW35pa55rOVCiAqLwppbXBvcnQgaXNBcnJheSBmcm9tICdsb2Rhc2gvaXNBcnJheSc7CmltcG9ydCB7IGFwcCB9IGZyb20gIi4uLy4uL2FwcCI7CmltcG9ydCBsb2dnZXIgZnJvbSAiLi4vLi4vdXRpbHMvbG9nZ2VyIjsKaW1wb3J0IHsgaXNTdWJTdHIgfSBmcm9tICIuLi8uLi91dGlscy90b29sIjsKdmFyIHN0b3JlID0ge307CnZhciBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdsaWI6cm91dGVzOmxpbWl0OmV4cG9ydHMnKTsgLy8g5bCG5a2X56ym5Liy5qC85byP55qE5p2D6ZmQ5pWw5o2u77yM6L2s5Li65a+56LGh57G75Z6L77yM5Y+v5aSn5aSn5YeP5bCR5p2D6ZmQ5Yy56YWN55qE5pe26Ze0CgpleHBvcnQgdmFyIGNvbnZlcnRMaW1pdFN0ciA9IGZ1bmN0aW9uIGNvbnZlcnRMaW1pdFN0cigpIHsKICB2YXIgbGltaXRTdHIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwoKICBpZiAobGltaXRTdHIgPT09IGFwcC5jb25zdGFudHMucm9vdExpbWl0RmxhZykgewogICAgcmV0dXJuIHsKICAgICAgW2FwcC5jb25zdGFudHMucm9vdExpbWl0RmxhZ106IHRydWUKICAgIH07CiAgfQoKICB2YXIgdHBsID0ge307CiAgdmFyIGxpbWl0cyA9IGxpbWl0U3RyID09PSBudWxsIHx8IGxpbWl0U3RyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsaW1pdFN0ci5zcGxpdCgnLCcpOwogIGxpbWl0cyA9PT0gbnVsbCB8fCBsaW1pdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpbWl0cy5mb3JFYWNoKGtleSA9PiB7CiAgICB0cGxba2V5XSA9IHRydWU7CiAgfSk7CiAgcmV0dXJuIHRwbDsKfTsKZXhwb3J0IHZhciBzZXRBcHBMaW1pdHMgPSBsaW1pdFN0ciA9PiB7CiAgc3RvcmUgPSBjb252ZXJ0TGltaXRTdHIobGltaXRTdHIpOwp9OwpleHBvcnQgdmFyIGdldEFwcExpbWl0cyA9ICgpID0+IHN0b3JlOwovKioKICog5b6q546v6LCD55So5pe25LiA5a6a6KaBLCDkvKAgbGltaXRzIOWPguaVsAogKiBAcGFyYW0gbm9kZVBhdGgg5bim5qOA5p+l55qE6IqC54K5CiAqIEBwYXJhbSBsaW1pdHMg5p2D6ZmQ5qih54mI77yM55So5qOA5p+l6IqC54K5CiAqLwoKZXhwb3J0IHZhciBjaGVja0xpbWl0QnlOb2RlUGF0aCA9IGZ1bmN0aW9uIGNoZWNrTGltaXRCeU5vZGVQYXRoKG5vZGVQYXRoKSB7CiAgdmFyIGxpbWl0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZ2V0QXBwTGltaXRzKCk7CgogIC8vIOS4jemcgOimgeagoemqjOadg+mZkCDlhajpg6jov5Tlm54gdHJ1ZQogIGlmIChhcHAuZW52LmRpc2FibGVMaW1pdCB8fCBsaW1pdHNbYXBwLmNvbnN0YW50cy5yb290TGltaXRGbGFnXSkgewogICAgcmV0dXJuIHRydWU7CiAgfSAvLyDlrZDmnYPpmZDlrZjlnKjvvIzniLbmnYPpmZDkuIDlrprlrZjlnKgKCgogIHZhciB3aXRoQXV0aCA9IGxpbWl0c1tub2RlUGF0aF0gfHwgT2JqZWN0LmtleXMobGltaXRzKS5zb21lKGkgPT4gaXNTdWJTdHIoaSwgIiIuY29uY2F0KG5vZGVQYXRoLCAiLyIpLCAwKSk7CiAgcmV0dXJuIHdpdGhBdXRoOwp9OwovKioKICog5qCh6aqM5LiA57uE5p2D6ZmQCiAqIEBwYXJhbSBsaW1pdEtleXMg5Y+v5Lul5piv5p2D6ZmQIGtleSzmiJbogIUgbm9kZVBhdGjjgILlvZPkuLoga2V5IOaXtu+8jOS4gOWumuimgeS8oCBvcHRpb24ubm9kZVBhdGgKICogQHBhcmFtIG9wdGlvbiBub2RlUGF0aCDmoKHpqozoioLngrnjgIIgbGltaXRzIOadg+mZkOaooeeJiO+8jOeUqOajgOafpeiKgueCuQogKi8KCmV4cG9ydCB2YXIgY2hlY2tMaW1pdEJ5S2V5cyA9IChsaW1pdEtleXMsIG9wdGlvbikgPT4gewogIGlmICghbGltaXRLZXlzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB2YXIgewogICAgbm9kZVBhdGggPSAnJywKICAgIGxpbWl0cwogIH0gPSBvcHRpb24gfHwge307CiAgdmFyIHRoaXNMaW1pdHMgPSBsaW1pdHMgfHwgZ2V0QXBwTGltaXRzKCk7CiAgdmFyIGNoZWNrQXIgPSB0eXBlb2YgbGltaXRLZXlzID09PSAnc3RyaW5nJyA/IFtsaW1pdEtleXNdIDogbGltaXRLZXlzOwoKICBpZiAoIWlzQXJyYXkoY2hlY2tBcikpIHsKICAgIGxvZy53YXJuKCdsaW1pdEtleXMg5b+F6aG75piv5a2X56ym5Liy77yM5oiW6ICF5a2X56ym5Liy5pWw57uEJywgbGltaXRLZXlzKTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiAhKGNoZWNrQXIgPT09IG51bGwgfHwgY2hlY2tBciA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2hlY2tBci5zb21lKGtleSA9PiB7CiAgICB2YXIgY2hlY2tLZXkgPSBpc1N1YlN0cihrZXksICcvJykgPyBrZXkgOiAiIi5jb25jYXQobm9kZVBhdGgsICIvIikuY29uY2F0KGtleSk7CiAgICByZXR1cm4gIWNoZWNrTGltaXRCeU5vZGVQYXRoKGNoZWNrS2V5LCB0aGlzTGltaXRzKTsKICB9KSk7Cn07CjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIHJlYWN0SG90TG9hZGVyID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQgOiB1bmRlZmluZWQ7CgogIGlmICghcmVhY3RIb3RMb2FkZXIpIHsKICAgIHJldHVybjsKICB9CgogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHN0b3JlLCAic3RvcmUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxleHBvcnRzLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIobG9nLCAibG9nIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxsaW1pdFxcZXhwb3J0cy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGNvbnZlcnRMaW1pdFN0ciwgImNvbnZlcnRMaW1pdFN0ciIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcbGltaXRcXGV4cG9ydHMuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihzZXRBcHBMaW1pdHMsICJzZXRBcHBMaW1pdHMiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxleHBvcnRzLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoZ2V0QXBwTGltaXRzLCAiZ2V0QXBwTGltaXRzIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxsaW1pdFxcZXhwb3J0cy5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGNoZWNrTGltaXRCeU5vZGVQYXRoLCAiY2hlY2tMaW1pdEJ5Tm9kZVBhdGgiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxleHBvcnRzLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoY2hlY2tMaW1pdEJ5S2V5cywgImNoZWNrTGltaXRCeUtleXMiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxleHBvcnRzLmpzIik7Cn0pKCk7Cgo7CgooZnVuY3Rpb24gKCkgewogIHZhciBsZWF2ZU1vZHVsZSA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5sZWF2ZU1vZHVsZSA6IHVuZGVmaW5lZDsKICBsZWF2ZU1vZHVsZSAmJiBsZWF2ZU1vZHVsZShtb2R1bGUpOwp9KSgpOw=="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/routes/limit/exports.js"],"names":["isArray","app","logger","isSubStr","store","log","getLogger","convertLimitStr","limitStr","constants","rootLimitFlag","tpl","limits","split","forEach","key","setAppLimits","getAppLimits","checkLimitByNodePath","nodePath","env","disableLimit","withAuth","Object","keys","some","i","checkLimitByKeys","limitKeys","option","thisLimits","checkAr","warn","checkKey"],"mappings":"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","sourcesContent":["/**\n * APP 权限相关工具方法\n */\nimport isArray from 'lodash/isArray';\nimport { app } from \"../../app\";\nimport logger from \"../../utils/logger\";\nimport { isSubStr } from \"../../utils/tool\";\nlet store = {};\nconst log = logger.getLogger('lib:routes:limit:exports');\n// 将字符串格式的权限数据，转为对象类型，可大大减少权限匹配的时间\nexport const convertLimitStr = (limitStr = '') => {\n    if (limitStr === app.constants.rootLimitFlag) {\n        return { [app.constants.rootLimitFlag]: true };\n    }\n    const tpl = {};\n    const limits = limitStr === null || limitStr === void 0 ? void 0 : limitStr.split(',');\n    limits === null || limits === void 0 ? void 0 : limits.forEach((key) => {\n        tpl[key] = true;\n    });\n    return tpl;\n};\nexport const setAppLimits = (limitStr) => {\n    store = convertLimitStr(limitStr);\n};\nexport const getAppLimits = () => store;\n/**\n * 循环调用时一定要, 传 limits 参数\n * @param nodePath 带检查的节点\n * @param limits 权限模版，用检查节点\n */\nexport const checkLimitByNodePath = (nodePath, limits = getAppLimits()) => {\n    // 不需要校验权限 全部返回 true\n    if (app.env.disableLimit || limits[app.constants.rootLimitFlag]) {\n        return true;\n    }\n    // 子权限存在，父权限一定存在\n    const withAuth = limits[nodePath] || Object.keys(limits).some((i) => isSubStr(i, `${nodePath}/`, 0));\n    return withAuth;\n};\n/**\n * 校验一组权限\n * @param limitKeys 可以是权限 key,或者 nodePath。当为 key 时，一定要传 option.nodePath\n * @param option nodePath 校验节点。 limits 权限模版，用检查节点\n */\nexport const checkLimitByKeys = (limitKeys, option) => {\n    if (!limitKeys) {\n        return false;\n    }\n    const { nodePath = '', limits } = option || {};\n    const thisLimits = limits || getAppLimits();\n    const checkAr = typeof limitKeys === 'string' ? [limitKeys] : limitKeys;\n    if (!isArray(checkAr)) {\n        log.warn('limitKeys 必须是字符串，或者字符串数组', limitKeys);\n        return false;\n    }\n    return !(checkAr === null || checkAr === void 0 ? void 0 : checkAr.some((key) => {\n        const checkKey = isSubStr(key, '/') ? key : `${nodePath}/${key}`;\n        return !checkLimitByNodePath(checkKey, thisLimits);\n    }));\n};\n"]}]}