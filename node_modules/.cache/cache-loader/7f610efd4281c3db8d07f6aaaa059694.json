{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\app\\index.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\app\\index.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCnZhciBfX2F3YWl0ZXIgPSB0aGlzICYmIHRoaXMuX19hd2FpdGVyIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsKICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICB9KTsKICB9CgogIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsKICAgICAgdHJ5IHsKICAgICAgICBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsKICAgICAgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7CiAgICB9CgogICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogIH0pOwp9OwovKiBlc2xpbnQtZGlzYWJsZSBtYXgtY2xhc3Nlcy1wZXItZmlsZSAqLwoKCmltcG9ydCB7IGNyZWF0ZUJyb3dzZXJIaXN0b3J5IH0gZnJvbSAnaGlzdG9yeSc7CmltcG9ydCB7IGRlZmF1bHRzRGVlcCwgZ2V0LCBpc0Z1bmN0aW9uLCBtZXJnZSwgc2V0IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgZGVmYXVsdEVudk1vZGUsIHJvb3RSb3V0ZSwgc3RvcmFnZSB9IGZyb20gIi4uL2NvbnN0YW50cyI7CmltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICIuLi91dGlscy9yZXF1ZXN0IjsKaW1wb3J0IHsgc2V0R2xvYmFsIH0gZnJvbSAiLi4vdXRpbHMvc3RvcmUiOwppbXBvcnQgeyBBcHBUaGVtZSB9IGZyb20gIi4vdGhlbWUiOwp2YXIgc291cmNlID0ge307CnZhciBpbml0Q29uZmlnID0gewogIC8vIFRPRE86IOWkhOeQhuafkOS6m+ivt+WkuOS4i+eahOWkmuWunuS+i+WIh+aNou+8jOiAjOS4jeaYr+WFqOWxgOWUr+S4gOWunuS+iwogIHJlcXVlc3Q6IG5ldyBSZXF1ZXN0KCksCiAgdGhlbWU6IG5ldyBBcHBUaGVtZSgpLAogIHN0eWxlZDogewogICAgZ2xvYmFsU3R5bGU6ICcnCiAgfSwKICBlbnY6IHsKICAgIGRlZmF1bHQ6IHsKICAgICAgbW9kZTogZGVmYXVsdEVudk1vZGUsCiAgICAgIGRvbWFpbnM6IHsKICAgICAgICBhcGk6ICdodHRwOi8vc2l0ZS1hcGkuY29tJwogICAgICB9CiAgICB9CiAgfSwKICBjb25zdGFudHM6IHsKICAgIHJvdXRlUHJlZml4OiByb290Um91dGUsCiAgICB0b2FzdER1cmF0aW9uOiAxMjAwLAogICAgcm9vdExpbWl0RmxhZzogJyonLAogICAgZW5hYmxlQmFja1RvcDogZmFsc2UsCiAgICBub3RGb3VuZDogewogICAgICByb3V0ZTogJy80MDQnLAogICAgICBwYWdlUGF0aDogJycKICAgIH0KICB9LAogIGVudHJ5OiBbewogICAgdHlwZTogJ3JvdXRlJywKICAgIHBhdGg6IHJvb3RSb3V0ZQogIH1dLAogIGFtaXM6IHsKICAgIGFmZml4T2Zmc2V0VG9wOiA1MAogIH0sCiAgLy8g5byC5q2l5pWw5o2u5a655ZmoCiAgYXN5bmNQYWdlOiB7CiAgICBzY2hlbWE6IHt9LAogICAgcHJlc2V0OiB7fSwKICAgIG1vY2s6IHt9CiAgfSwKICBob29rOiB7fQp9OwoKZnVuY3Rpb24gY2hlY2tBcHBHZXR0ZXIoa2V5LCB2YWx1ZSkgewogIHN3aXRjaCAoa2V5KSB7CiAgICBjYXNlICd0aGVtZSc6CiAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgQXBwVGhlbWUpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3Ugc2hvdWxkIHJlZ2lzdGVyIHRoZW1lIHdpdGggQXBwVGhlbWUgaW5zdGFuY2UuJyk7CiAgICAgIH0KCiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3JlcXVlc3RGdW5jJzoKICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBSZXF1ZXN0KSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IHNob3VsZCByZWdpc3RlciByZXF1ZXN0IHdpdGggUmVxdWVzdCBpbnN0YW5jZS4nKTsKICAgICAgfQoKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICB9Cn0KCmNsYXNzIEFwcFByb3h5IHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHZhciB0aGF0ID0gdGhpczsKICAgIHZhciBwcm94eSA9IG5ldyBQcm94eSh0aGF0LCB7CiAgICAgIGdldChfLCBrZXkpIHsKICAgICAgICB2YXIgdmFsdWUgPSBrZXkgaW4gdGhhdCA/IHRoYXRba2V5XSA6IGdldChzb3VyY2UsIGtleSkgfHwgZ2V0KGluaXRDb25maWcsIGtleSk7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CgogICAgfSk7CiAgICByZXR1cm4gcHJveHk7CiAgfQoKICAvLyBAdHMtaWdub3JlCiAgX19yZWFjdHN0YW5kaW5fX3JlZ2VuZXJhdGVCeUV2YWwoa2V5LCBjb2RlKSB7CiAgICAvLyBAdHMtaWdub3JlCiAgICB0aGlzW2tleV0gPSBldmFsKGNvZGUpOwogIH0KCn0gLy8gVE9ETzog5YWB6K64IEFQUCDlpJrmrKHph43lpI3liJvlu7oKCgpjbGFzcyBBcHAgZXh0ZW5kcyBBcHBQcm94eSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlciguLi5hcmd1bWVudHMpOwogICAgdGhpcy5yb3V0ZVByZWZpeCA9IHJvb3RSb3V0ZTsKICB9CgogIGNyZWF0ZShhcHBDb25maWcpIHsKICAgIHZhciBfYSwgX2IsIF9jOwoKICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgIHRoaXMuaW5pdFN0YXRlKCk7CiAgICAgIHZhciBwcmV2QmFzZVVybCA9IGdldChzb3VyY2UsICdjb25zdGFudHMucm91dGVQcmVmaXgnKSB8fCByb290Um91dGU7IC8vIOetieW+hSBiZWZvcmVDcmVhdGUgaG9va+aJp+ihjOWujOaIkAoKICAgICAgaWYgKChfYSA9IGFwcENvbmZpZy5ob29rKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYmVmb3JlQ3JlYXRlKSB7CiAgICAgICAgeWllbGQgYXBwQ29uZmlnLmhvb2suYmVmb3JlQ3JlYXRlLmJpbmQodGhpcywgdGhpcywgYXBwQ29uZmlnKSgpOwogICAgICB9IC8vIOWQiOW5tuWPguaVsAoKCiAgICAgIHNvdXJjZSA9IG1lcmdlKGluaXRDb25maWcsIGFwcENvbmZpZyk7CiAgICAgIHRoaXMucm91dGVQcmVmaXggPSB0aGlzLmdldEJhc2VVcmwoKF9iID0gYXBwQ29uZmlnLmNvbnN0YW50cykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJvdXRlUHJlZml4KTsKICAgICAgc2V0KHNvdXJjZSwgJ2NvbnN0YW50cy5yb3V0ZVByZWZpeCcsIHRoaXMucm91dGVQcmVmaXgpOwoKICAgICAgaWYgKHRoaXMuY2hlY2tCYXNlVXJsKHByZXZCYXNlVXJsLCB0aGlzLnJvdXRlUHJlZml4KSkgewogICAgICAgIHRoaXMuY3JlYXRlUm91dGVySGlzdG9yeSgpOwogICAgICB9CgogICAgICBpZiAoc291cmNlLmVudikgewogICAgICAgIHRoaXMuc2V0RW52KHNvdXJjZS5lbnYpOwogICAgICB9CgogICAgICBpZiAoc291cmNlLnJlcXVlc3QpIHsKICAgICAgICB0aGlzLnNldFJlcXVlc3Qoc291cmNlLnJlcXVlc3QpOwogICAgICB9IC8vIOetieW+hSBhZnRlckNyZWF0ZWQgaG9va+aJp+ihjOWujOaIkAoKCiAgICAgIGlmICgoX2MgPSBzb3VyY2UuaG9vaykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmFmdGVyQ3JlYXRlZCkgewogICAgICAgIHlpZWxkIHNvdXJjZS5ob29rLmFmdGVyQ3JlYXRlZC5iaW5kKHRoaXMsIHRoaXMsIHNvdXJjZSkoKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBjcmVhdGVSb3V0ZXJIaXN0b3J5KCkgewogICAgdGhpcy5yb3V0ZXJIaXN0b3J5ID0gY3JlYXRlQnJvd3Nlckhpc3RvcnkodGhpcy5yb3V0ZVByZWZpeCA9PT0gcm9vdFJvdXRlID8gdW5kZWZpbmVkIDogewogICAgICBiYXNlbmFtZTogdGhpcy5yb3V0ZVByZWZpeC5zbGljZSgwLCAtMSkKICAgIH0pOwogIH0KCiAgaW5pdFN0YXRlKCkgewogICAgLy8g6Z2eIOeDreabtOaWsOaooeW8j+S4i++8jOavj+asoeWIm+W7uu+8jOWwhua4hemZpOWOn+acieaVsOaNrgogICAgaWYgKCFwcm9jZXNzLmVudi5IT1QpIHsKICAgICAgc291cmNlID0ge307CiAgICAgIHRoaXMucm91dGVQcmVmaXggPSByb290Um91dGU7CiAgICAgIHRoaXMucm91dGVySGlzdG9yeSA9IHVuZGVmaW5lZDsKICAgIH0KICB9CgogIGdldEJhc2VVcmwodXJsR2VuKSB7CiAgICBpZiAoaXNGdW5jdGlvbih1cmxHZW4pKSB7CiAgICAgIHJldHVybiB1cmxHZW4oKSB8fCByb290Um91dGU7CiAgICB9CgogICAgcmV0dXJuIHR5cGVvZiB1cmxHZW4gPT09ICdzdHJpbmcnID8gdXJsR2VuIDogcm9vdFJvdXRlOwogIH0KCiAgY2hlY2tCYXNlVXJsKHByZXZCYXNlVXJsLCByb3V0ZVByZWZpeCkgewogICAgaWYgKHR5cGVvZiByb3V0ZVByZWZpeCAhPT0gJ3N0cmluZycgfHwgcm91dGVQcmVmaXguc3Vic3RyKC0xKSAhPT0gcm9vdFJvdXRlIHx8IHJvdXRlUHJlZml4WzBdICE9PSByb290Um91dGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJyb3V0ZVByZWZpeDogXCIiLmNvbmNhdChyb3V0ZVByZWZpeCwgIlwiIGlzIG5vdCBhbGxvd2VkLiBUaGUgXCJyb3V0ZVByZWZpeFwiIG11c3QgYmUgc3RyaW5nIHN0YXJ0V2l0aCBcIi9cIiBhbmQgZW5kV2l0aCBcIi9cIi4gZWc6IFwiL3N1YlBhdGgvXCIiKSk7CiAgICB9CgogICAgaWYgKHRoaXMucm91dGVySGlzdG9yeSAmJiByb3V0ZVByZWZpeCAhPT0gcHJldkJhc2VVcmwpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByb3V0ZVByZWZpeDsKICAgIH0KCiAgICByZXR1cm4gIXRoaXMucm91dGVySGlzdG9yeTsKICB9CgogIHNldEVudih2YWx1ZSkgewogICAgdmFyIG1vZGUgPSBwcm9jZXNzLmVudi5FTlYgfHwgZGVmYXVsdEVudk1vZGU7CiAgICB2YXIgaXNNb2NrID0gcHJvY2Vzcy5lbnYuTU9DSzsKICAgIHZhciBpc1JlbGVhc2UgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nICYmIGdldCh2YWx1ZSwgIiIuY29uY2F0KG1vZGUsICIuaXNQcm9kIikpOwogICAgdmFyIGVudiA9IGRlZmF1bHRzRGVlcCh7CiAgICAgIGlzTW9jaywKICAgICAgbW9kZQogICAgfSwgdmFsdWVbbW9kZV0sIHsKICAgICAgaXNSZWxlYXNlCiAgICB9LCB2YWx1ZS5kZWZhdWx0LCBpbml0Q29uZmlnLmVudi5kZWZhdWx0KTsKICAgIHNldChzb3VyY2UsICdlbnYnLCBlbnYpOwogIH0KCiAgc2V0UmVxdWVzdChyZXF1ZXN0SW5zKSB7CiAgICB2YXIgaW5pdEVudiA9IGluaXRDb25maWcuZW52LmRlZmF1bHQ7CiAgICBjaGVja0FwcEdldHRlcigncmVxdWVzdEZ1bmMnLCByZXF1ZXN0SW5zKTsgLy8g6K6+572uIHJlcXVlc3Qg546v5aKD5Y+Y6YePCgogICAgdmFyIGVudiA9IHNvdXJjZS5lbnYgfHwgaW5pdEVudjsKICAgIHJlcXVlc3RJbnMuc2V0Q29uZmlnKHsKICAgICAgaXNNb2NrOiBlbnYuaXNNb2NrICYmICFlbnYuaXNSZWxlYXNlLAogICAgICBkb21haW5zOiBlbnYuZG9tYWlucwogICAgfSk7CiAgICB2YXIgcmVxdWVzdEhhbmRsZSA9IHJlcXVlc3RJbnMucmVxdWVzdC5iaW5kKHJlcXVlc3RJbnMpOwogICAgcmVxdWVzdEhhbmRsZS5nZXRVcmxCeU9wdGlvbiA9IHJlcXVlc3RJbnMuZ2V0VXJsQnlPcHRpb24uYmluZChyZXF1ZXN0SW5zKTsKICAgIHNldChzb3VyY2UsICdyZXF1ZXN0JywgcmVxdWVzdEhhbmRsZSk7CiAgfQoKICAvLyBAdHMtaWdub3JlCiAgX19yZWFjdHN0YW5kaW5fX3JlZ2VuZXJhdGVCeUV2YWwoa2V5LCBjb2RlKSB7CiAgICAvLyBAdHMtaWdub3JlCiAgICB0aGlzW2tleV0gPSBldmFsKGNvZGUpOwogIH0KCn0KCmV4cG9ydCB2YXIgYXBwID0gbmV3IEFwcCgpOwpzZXRHbG9iYWwoc3RvcmFnZS5hcHBJbnN0YW5jZSwgYXBwKTsKOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgcmVhY3RIb3RMb2FkZXIgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZGVmYXVsdCA6IHVuZGVmaW5lZDsKCiAgaWYgKCFyZWFjdEhvdExvYWRlcikgewogICAgcmV0dXJuOwogIH0KCiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoX19hd2FpdGVyLCAiX19hd2FpdGVyIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcYXBwXFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNvdXJjZSwgInNvdXJjZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGFwcFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihpbml0Q29uZmlnLCAiaW5pdENvbmZpZyIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGFwcFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihjaGVja0FwcEdldHRlciwgImNoZWNrQXBwR2V0dGVyIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcYXBwXFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKEFwcFByb3h5LCAiQXBwUHJveHkiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxhcHBcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoQXBwLCAiQXBwIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcYXBwXFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGFwcCwgImFwcCIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXGFwcFxcaW5kZXguanMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmxlYXZlTW9kdWxlIDogdW5kZWZpbmVkOwogIGxlYXZlTW9kdWxlICYmIGxlYXZlTW9kdWxlKG1vZHVsZSk7Cn0pKCk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/app/index.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","createBrowserHistory","defaultsDeep","get","isFunction","merge","set","defaultEnvMode","rootRoute","storage","Request","setGlobal","AppTheme","source","initConfig","request","theme","styled","globalStyle","env","default","mode","domains","api","constants","routePrefix","toastDuration","rootLimitFlag","enableBackTop","notFound","route","pagePath","entry","type","path","amis","affixOffsetTop","asyncPage","schema","preset","mock","hook","checkAppGetter","key","Error","AppProxy","constructor","that","proxy","Proxy","_","App","arguments","create","appConfig","_a","_b","_c","initState","prevBaseUrl","beforeCreate","bind","getBaseUrl","checkBaseUrl","createRouterHistory","setEnv","setRequest","afterCreated","routerHistory","undefined","basename","slice","process","HOT","urlGen","substr","window","location","href","ENV","isMock","MOCK","isRelease","NODE_ENV","requestIns","initEnv","setConfig","requestHandle","getUrlByOption","app","appInstance"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/* eslint-disable max-classes-per-file */\nimport { createBrowserHistory } from 'history';\nimport { defaultsDeep, get, isFunction, merge, set } from 'lodash';\nimport { defaultEnvMode, rootRoute, storage } from \"../constants\";\nimport { Request } from \"../utils/request\";\nimport { setGlobal } from \"../utils/store\";\nimport { AppTheme } from \"./theme\";\nlet source = {};\nconst initConfig = {\n    // TODO: 处理某些请夸下的多实例切换，而不是全局唯一实例\n    request: new Request(),\n    theme: new AppTheme(),\n    styled: {\n        globalStyle: '',\n    },\n    env: {\n        default: {\n            mode: defaultEnvMode,\n            domains: {\n                api: 'http://site-api.com',\n            },\n        },\n    },\n    constants: {\n        routePrefix: rootRoute,\n        toastDuration: 1200,\n        rootLimitFlag: '*',\n        enableBackTop: false,\n        notFound: {\n            route: '/404',\n            pagePath: '',\n        },\n    },\n    entry: [\n        {\n            type: 'route',\n            path: rootRoute,\n        },\n    ],\n    amis: {\n        affixOffsetTop: 50,\n    },\n    // 异步数据容器\n    asyncPage: {\n        schema: {},\n        preset: {},\n        mock: {},\n    },\n    hook: {},\n};\nfunction checkAppGetter(key, value) {\n    switch (key) {\n        case 'theme':\n            if (!(value instanceof AppTheme)) {\n                throw new Error('You should register theme with AppTheme instance.');\n            }\n            break;\n        case 'requestFunc':\n            if (!(value instanceof Request)) {\n                throw new Error('You should register request with Request instance.');\n            }\n            break;\n        default:\n    }\n}\nclass AppProxy {\n    constructor() {\n        const that = this;\n        const proxy = new Proxy(that, {\n            get(_, key) {\n                const value = key in that ? that[key] : get(source, key) || get(initConfig, key);\n                return value;\n            },\n        });\n        return proxy;\n    }\n}\n// TODO: 允许 APP 多次重复创建\nclass App extends AppProxy {\n    constructor() {\n        super(...arguments);\n        this.routePrefix = rootRoute;\n    }\n    create(appConfig) {\n        var _a, _b, _c;\n        return __awaiter(this, void 0, void 0, function* () {\n            this.initState();\n            const prevBaseUrl = get(source, 'constants.routePrefix') || rootRoute;\n            // 等待 beforeCreate hook执行完成\n            if ((_a = appConfig.hook) === null || _a === void 0 ? void 0 : _a.beforeCreate) {\n                yield appConfig.hook.beforeCreate.bind(this, this, appConfig)();\n            }\n            // 合并参数\n            source = merge(initConfig, appConfig);\n            this.routePrefix = this.getBaseUrl((_b = appConfig.constants) === null || _b === void 0 ? void 0 : _b.routePrefix);\n            set(source, 'constants.routePrefix', this.routePrefix);\n            if (this.checkBaseUrl(prevBaseUrl, this.routePrefix)) {\n                this.createRouterHistory();\n            }\n            if (source.env) {\n                this.setEnv(source.env);\n            }\n            if (source.request) {\n                this.setRequest(source.request);\n            }\n            // 等待 afterCreated hook执行完成\n            if ((_c = source.hook) === null || _c === void 0 ? void 0 : _c.afterCreated) {\n                yield source.hook.afterCreated.bind(this, this, source)();\n            }\n        });\n    }\n    createRouterHistory() {\n        this.routerHistory = createBrowserHistory(this.routePrefix === rootRoute\n            ? undefined\n            : {\n                basename: this.routePrefix.slice(0, -1),\n            });\n    }\n    initState() {\n        // 非 热更新模式下，每次创建，将清除原有数据\n        if (!process.env.HOT) {\n            source = {};\n            this.routePrefix = rootRoute;\n            this.routerHistory = undefined;\n        }\n    }\n    getBaseUrl(urlGen) {\n        if (isFunction(urlGen)) {\n            return urlGen() || rootRoute;\n        }\n        return typeof urlGen === 'string' ? urlGen : rootRoute;\n    }\n    checkBaseUrl(prevBaseUrl, routePrefix) {\n        if (typeof routePrefix !== 'string' ||\n            routePrefix.substr(-1) !== rootRoute ||\n            routePrefix[0] !== rootRoute) {\n            throw new Error(`routePrefix: \"${routePrefix}\" is not allowed. The \"routePrefix\" must be string startWith \"/\" and endWith \"/\". eg: \"/subPath/\"`);\n        }\n        if (this.routerHistory && routePrefix !== prevBaseUrl) {\n            window.location.href = routePrefix;\n        }\n        return !this.routerHistory;\n    }\n    setEnv(value) {\n        const mode = process.env.ENV || defaultEnvMode;\n        const isMock = process.env.MOCK;\n        const isRelease = process.env.NODE_ENV === 'production' && get(value, `${mode}.isProd`);\n        const env = defaultsDeep({\n            isMock,\n            mode,\n        }, value[mode], {\n            isRelease,\n        }, value.default, initConfig.env.default);\n        set(source, 'env', env);\n    }\n    setRequest(requestIns) {\n        const initEnv = initConfig.env.default;\n        checkAppGetter('requestFunc', requestIns);\n        // 设置 request 环境变量\n        const env = source.env || initEnv;\n        requestIns.setConfig({\n            isMock: env.isMock && !env.isRelease,\n            domains: env.domains,\n        });\n        const requestHandle = requestIns.request.bind(requestIns);\n        requestHandle.getUrlByOption = requestIns.getUrlByOption.bind(requestIns);\n        set(source, 'request', requestHandle);\n    }\n}\nexport const app = new App();\nsetGlobal(storage.appInstance, app);\n"]}]}