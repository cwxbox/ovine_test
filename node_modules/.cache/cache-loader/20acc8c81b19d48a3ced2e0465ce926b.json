{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--5-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\editor\\lib\\stores\\root.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\editor\\lib\\stores\\root.js","mtime":1618319235155},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgdG9hc3QgfSBmcm9tICdhbWlzJzsKaW1wb3J0IHsgaXNFbXB0eSwgaXNFcXVhbCB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IHR5cGVzIH0gZnJvbSAnbW9ieC1zdGF0ZS10cmVlJzsKaW1wb3J0IHsgYXBwIH0gZnJvbSAiLi4vLi4vLi4vY29yZS9saWIvYXBwIjsKaW1wb3J0IHsgZWRpdG9yU3RvcmUgfSBmcm9tICIuL2VkaXRvciI7CnZhciBpbml0U3RhdGUgPSB7CiAgaXNQcmV2aWV3OiBmYWxzZSwKICBpc01vYmlsZTogZmFsc2UsCiAgZWRpdG9ySW5zdGFuY2U6IHsKICAgIGNhblVuZG86ICgpID0+IHt9LAogICAgY2FuUmVkbzogKCkgPT4ge30sCiAgICB1bmRvOiAoKSA9PiB7fSwKICAgIHJlZG86ICgpID0+IHt9CiAgfQp9Owp2YXIgUm9vdFN0b3JlID0gdHlwZXMubW9kZWwoJ1Jvb3RTdG9yZScsIHsKICBpc01vYmlsZTogdHlwZXMuYm9vbGVhbiwKICBpc1ByZXZpZXc6IHR5cGVzLmJvb2xlYW4sCiAgbGFzdFNhdmVkU2NoZW1hOiB0eXBlcy5mcm96ZW4oe30pLAogIGVkaXRvckluc3RhbmNlOiB0eXBlcy5mcm96ZW4oe30pLAogIG9wdGlvbjogdHlwZXMuZnJvemVuKHt9KQp9KS52aWV3cyhzZWxmID0+IHsKICByZXR1cm4gewogICAgLy8g6ISP5pWw5o2u5qOA5p+l77yM5aaC5p6c5pyq5L+d5a2Y55qE5pWw5o2u77yM57uZ5Ye66YCC5b2T5o+Q56S6IGh0dHBzOi8vYmxvZy5jc2RuLm5ldC9iaWcxOTg5d21mL2FydGljbGUvZGV0YWlscy83MDE0NDAwMAogICAgZ2V0IGlzRGlydHkoKSB7CiAgICAgIGlmIChpc0VtcHR5KHNlbGYubGFzdFNhdmVkU2NoZW1hKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuICFpc0VxdWFsKGVkaXRvclN0b3JlLnNjaGVtYSwgc2VsZi5sYXN0U2F2ZWRTY2hlbWEpOwogICAgfQoKICB9Owp9KS5hY3Rpb25zKHNlbGYgPT4gewogIHZhciB0b2dnbGVQcmV2aWV3ID0gdG9nZ2xlID0+IHsKICAgIHNlbGYuaXNQcmV2aWV3ID0gdHlwZW9mIHRvZ2dsZSA9PT0gJ2Jvb2xlYW4nID8gdG9nZ2xlIDogIXNlbGYuaXNQcmV2aWV3OwogIH07CgogIHZhciB0b2dnbGVWaWV3TW9kZSA9IHRvZ2dsZSA9PiB7CiAgICBzZWxmLmlzTW9iaWxlID0gdHlwZW9mIHRvZ2dsZSA9PT0gJ2Jvb2xlYW4nID8gdG9nZ2xlIDogIXNlbGYuaXNNb2JpbGU7CiAgfTsKCiAgdmFyIHNldExhc3RTYXZlZFNjaGVtYSA9IHNjaGVtYSA9PiB7CiAgICBzZWxmLmxhc3RTYXZlZFNjaGVtYSA9IHNjaGVtYTsKICB9OwoKICB2YXIgc2V0T3B0aW9uID0gb3B0aW9uID0+IHsKICAgIHZhciB7CiAgICAgIGluaXRBcGksCiAgICAgIGdldFNjaGVtYSwKICAgICAgc2NoZW1hCiAgICB9ID0gb3B0aW9uOwoKICAgIGlmIChzY2hlbWEpIHsKICAgICAgZWRpdG9yU3RvcmUudXBkYXRlU2NoZW1hKHNjaGVtYSk7CiAgICB9CgogICAgaWYgKGdldFNjaGVtYSkgewogICAgICBlZGl0b3JTdG9yZS51cGRhdGVTY2hlbWEoZ2V0U2NoZW1hKCkpOwogICAgfQoKICAgIGlmIChpbml0QXBpKSB7CiAgICAgIGFwcC5yZXF1ZXN0KGluaXRBcGkpLnRoZW4oc291cmNlID0+IHsKICAgICAgICB2YXIgewogICAgICAgICAgc3RhdHVzLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIG1zZwogICAgICAgIH0gPSBzb3VyY2UuZGF0YTsKCiAgICAgICAgaWYgKHN0YXR1cyAhPT0gMCkgewogICAgICAgICAgdG9hc3QuZXJyb3IobXNnIHx8ICfojrflj5bmlbDmja7lpLHotKUnKTsKICAgICAgICB9CgogICAgICAgIGVkaXRvclN0b3JlLnVwZGF0ZVNjaGVtYShkYXRhIHx8IHsKICAgICAgICAgIHR5cGU6ICdwYWdlJywKICAgICAgICAgIGJvZHk6ICfmmoLml6DmlbDmja4nCiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICB0b2FzdC5lcnJvcign6I635Y+W5pWw5o2u5aSx6LSlJyk7CiAgICAgIH0pOwogICAgfQoKICAgIHNlbGYub3B0aW9uID0gb3B0aW9uOwogIH07CgogIHZhciBzZXRFZGl0b3JJbnN0YW5jZSA9IGluc3RhbmNlID0+IHsKICAgIGlmICghaW5zdGFuY2UpIHsKICAgICAgc2VsZi5lZGl0b3JJbnN0YW5jZSA9IGluaXRTdGF0ZS5lZGl0b3JJbnN0YW5jZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBpbnMgPSB7fTsKICAgIFsnY2FuVW5kbycsICdjYW5SZWRvJywgJ3VuZG8nLCAncmVkbyddLmZvckVhY2goaXRlbSA9PiB7CiAgICAgIGluc1tpdGVtXSA9IGluc3RhbmNlW2l0ZW1dLmJpbmQoaW5zdGFuY2UpOwogICAgfSk7CiAgICBzZWxmLmVkaXRvckluc3RhbmNlID0gaW5zOwogIH07CgogIHJldHVybiB7CiAgICBzZXRPcHRpb24sCiAgICAvLyBzZXRIaXN0b3J5U3RhdHVzLAogICAgdG9nZ2xlVmlld01vZGUsCiAgICB0b2dnbGVQcmV2aWV3LAogICAgc2V0TGFzdFNhdmVkU2NoZW1hLAogICAgc2V0RWRpdG9ySW5zdGFuY2UKICB9Owp9KTsKZXhwb3J0IHZhciByb290U3RvcmUgPSBSb290U3RvcmUuY3JlYXRlKGluaXRTdGF0ZSk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/editor/lib/stores/root.js"],"names":["toast","isEmpty","isEqual","types","app","editorStore","initState","isPreview","isMobile","editorInstance","canUndo","canRedo","undo","redo","RootStore","model","boolean","lastSavedSchema","frozen","option","views","self","isDirty","schema","actions","togglePreview","toggle","toggleViewMode","setLastSavedSchema","setOption","initApi","getSchema","updateSchema","request","then","source","status","data","msg","error","type","body","catch","setEditorInstance","instance","ins","forEach","item","bind","rootStore","create"],"mappings":"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","sourcesContent":["import { toast } from 'amis';\nimport { isEmpty, isEqual } from 'lodash';\nimport { types } from 'mobx-state-tree';\nimport { app } from \"../../../core/lib/app\";\nimport { editorStore } from \"./editor\";\nconst initState = {\n    isPreview: false,\n    isMobile: false,\n    editorInstance: {\n        canUndo: () => { },\n        canRedo: () => { },\n        undo: () => { },\n        redo: () => { },\n    },\n};\nconst RootStore = types\n    .model('RootStore', {\n    isMobile: types.boolean,\n    isPreview: types.boolean,\n    lastSavedSchema: types.frozen({}),\n    editorInstance: types.frozen({}),\n    option: types.frozen({}),\n})\n    .views((self) => {\n    return {\n        // 脏数据检查，如果未保存的数据，给出适当提示 https://blog.csdn.net/big1989wmf/article/details/70144000\n        get isDirty() {\n            if (isEmpty(self.lastSavedSchema)) {\n                return false;\n            }\n            return !isEqual(editorStore.schema, self.lastSavedSchema);\n        },\n    };\n})\n    .actions((self) => {\n    const togglePreview = (toggle) => {\n        self.isPreview = typeof toggle === 'boolean' ? toggle : !self.isPreview;\n    };\n    const toggleViewMode = (toggle) => {\n        self.isMobile = typeof toggle === 'boolean' ? toggle : !self.isMobile;\n    };\n    const setLastSavedSchema = (schema) => {\n        self.lastSavedSchema = schema;\n    };\n    const setOption = (option) => {\n        const { initApi, getSchema, schema } = option;\n        if (schema) {\n            editorStore.updateSchema(schema);\n        }\n        if (getSchema) {\n            editorStore.updateSchema(getSchema());\n        }\n        if (initApi) {\n            app\n                .request(initApi)\n                .then((source) => {\n                const { status, data, msg } = source.data;\n                if (status !== 0) {\n                    toast.error(msg || '获取数据失败');\n                }\n                editorStore.updateSchema(data || { type: 'page', body: '暂无数据' });\n            })\n                .catch(() => {\n                toast.error('获取数据失败');\n            });\n        }\n        self.option = option;\n    };\n    const setEditorInstance = (instance) => {\n        if (!instance) {\n            self.editorInstance = initState.editorInstance;\n            return;\n        }\n        const ins = {};\n        ['canUndo', 'canRedo', 'undo', 'redo'].forEach((item) => {\n            ins[item] = instance[item].bind(instance);\n        });\n        self.editorInstance = ins;\n    };\n    return {\n        setOption,\n        // setHistoryStatus,\n        toggleViewMode,\n        togglePreview,\n        setLastSavedSchema,\n        setEditorInstance,\n    };\n});\nexport const rootStore = RootStore.create(initState);\n"]}]}