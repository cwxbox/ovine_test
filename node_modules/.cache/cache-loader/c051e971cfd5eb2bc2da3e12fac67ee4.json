{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\message.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\utils\\message.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCi8qKgogKiDlrp7njrDmtojmga/pgJrnn6XpgLvovpEKICog6Kej6ICm57uE5Lu254q25oCB5L6d6LWWCiAqLwppbXBvcnQgaXNBcnJheSBmcm9tICdsb2Rhc2gvaXNBcnJheSc7CmltcG9ydCBpc05vbmUgZnJvbSAnbG9kYXNoL2lzVW5kZWZpbmVkJzsKaW1wb3J0IHsgbWVzc2FnZSB9IGZyb20gIi4uL2NvbnN0YW50cyI7CnZhciB7CiAgc3RvcmVSb290Cn0gPSBtZXNzYWdlOwp2YXIgb2JzZXJ2ZXIgPSB7fTsKdmFyIHNvdXJjZSA9IHt9OyAvLyDmoLzlvI/ljJblrZjlgqgga2V5IOagvOW8jwoKdmFyIHN0b3JlS2V5Q3RybCA9IGZ1bmN0aW9uIHN0b3JlS2V5Q3RybCh0eXBlKSB7CiAgdmFyIHZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnJzsKICB2YXIgaXNTdG9yZUtleSA9IHZhbHVlLmluZGV4T2Yoc3RvcmVSb290KSA9PT0gMDsKCiAgaWYgKHR5cGUgPT09ICdzZXQnKSB7CiAgICByZXR1cm4gaXNTdG9yZUtleSA/IHZhbHVlIDogIiIuY29uY2F0KHN0b3JlUm9vdCkuY29uY2F0KHZhbHVlKTsKICB9CgogIHJldHVybiAhaXNTdG9yZUtleSA/IHVuZGVmaW5lZCA6IHZhbHVlLnNwbGl0KHN0b3JlUm9vdClbMV07Cn07IC8vIOabtOaUuSBzdG9yZSDlgLws5bCx5Lya6Ieq5YqoIHB1Ymxpc2gg5raI5oGvCgoKZXhwb3J0IHZhciBvYnNlcnZlU3RvcmUgPSBuZXcgUHJveHkoe30sIHsKICBnZXQoXywga2V5KSB7CiAgICByZXR1cm4gc291cmNlW2tleV07CiAgfSwKCiAgLy8g5pW05Liq5qih5Z2X55qE5qC45b+D6YC76L6RCiAgLy8g5Luj55CGb2JqZWN06LWL5YC85pON5L2c77yM6K6+572u5YC855qE5pe25YCZ77yM6Kem5Y+R6K6i6ZiF5pe255qE5Zue6LCD5Ye95pWwCiAgc2V0KG9iaiwga2V5LCB2YWx1ZSkgewogICAgLy8g5Y+q5pyJ5YC85Y+Y5YyWIOaJjeinpuWPkeWbnuiwg+OAggogICAgaWYgKCEoc291cmNlW2tleV0gJiYgc291cmNlW2tleV0gPT09IHZhbHVlKSkgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgICAgdmFyIHN0b3JlS2V5ID0gc3RvcmVLZXlDdHJsKCdzZXQnLCBrZXkpOwoKICAgICAgaWYgKHN0b3JlS2V5ICYmICFpc05vbmUob2JzZXJ2ZXJbc3RvcmVLZXldKSkgewogICAgICAgIG9ic2VydmVyW3N0b3JlS2V5XS5mb3JFYWNoKGhhbmRsZXIgPT4gewogICAgICAgICAgaGFuZGxlcih2YWx1ZSwgc3RvcmVLZXkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKfSk7IC8vIOWPkemAgea2iOaBrwoKZXhwb3J0IGZ1bmN0aW9uIHB1Ymxpc2goa2V5LCB2YWx1ZSkgewogIHZhciBtc2dWYWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyB7fSA6IHZhbHVlOwoKICB2YXIga2V5VG9PYnNlcnZlciA9IG9ic0tleSA9PiB7CiAgICB2YXIgc291cmNlS2V5ID0gc3RvcmVLZXlDdHJsKCdnZXQnLCBvYnNLZXkpOwoKICAgIGlmIChzb3VyY2VLZXkgJiYgIWlzTm9uZShzb3VyY2Vbc291cmNlS2V5XSkpIHsKICAgICAgc291cmNlW3NvdXJjZUtleV0gPSBtc2dWYWx1ZTsKICAgIH0KCiAgICBpZiAoIWlzTm9uZShvYnNlcnZlcltvYnNLZXldKSkgewogICAgICBvYnNlcnZlcltvYnNLZXldLmZvckVhY2goaGFuZGxlciA9PiB7CiAgICAgICAgaGFuZGxlcihtc2dWYWx1ZSwgb2JzS2V5KTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgaWYgKGlzQXJyYXkoa2V5KSkgewogICAga2V5LmZvckVhY2goa2V5VG9PYnNlcnZlcik7CiAgfSBlbHNlIHsKICAgIGtleVRvT2JzZXJ2ZXIoa2V5KTsKICB9Cn0gLy8g5Y+W5raI6K6i6ZiFCgpleHBvcnQgZnVuY3Rpb24gdW5zdWJzY3JpYmUoa2V5LCBoYW5kbGVyKSB7CiAgdmFyIG9mZk9ic2VydmVyID0gb2ZmS2V5ID0+IHsKICAgIGlmICghaXNOb25lKG9ic2VydmVyW29mZktleV0pKSB7CiAgICAgIGlmICghaGFuZGxlcikgewogICAgICAgIG9ic2VydmVyW29mZktleV0gPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvYnNlcnZlcltvZmZLZXldLmZvckVhY2goKG9ic0hhbmRsZXIsIGluZGV4KSA9PiB7CiAgICAgICAgICBpZiAob2JzSGFuZGxlciA9PT0gaGFuZGxlcikgewogICAgICAgICAgICBvYnNlcnZlcltvZmZLZXldLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9OwoKICBpZiAoaXNBcnJheShrZXkpKSB7CiAgICBrZXkuZm9yRWFjaChvZmZPYnNlcnZlcik7CiAgfSBlbHNlIHsKICAgIG9mZk9ic2VydmVyKGtleSk7CiAgfQp9CmV4cG9ydCBmdW5jdGlvbiB1bnN1YnNjcmliZUFsbCgpIHsKICBvYnNlcnZlciA9IHt9Owp9IC8vIOa2iOaBr+iuoumYhQoKZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZShrZXksIGhhbmRsZXIpIHsKICB2YXIgY2FjaGVPYnNlcnZlckhhbmRsZXJzID0gbWFwS2V5ID0+IHsKICAgIGlmIChpc05vbmUob2JzZXJ2ZXJbbWFwS2V5XSkpIHsKICAgICAgb2JzZXJ2ZXJbbWFwS2V5XSA9IFtdOwogICAgfQoKICAgIG9ic2VydmVyW21hcEtleV0ucHVzaChoYW5kbGVyKTsKICAgIHZhciBoYW5kbGVyS2V5ID0gc3RvcmVLZXlDdHJsKCdnZXQnLCBtYXBLZXkpOwoKICAgIGlmIChoYW5kbGVyS2V5ICYmICFpc05vbmUoc291cmNlW2hhbmRsZXJLZXldKSkgewogICAgICBoYW5kbGVyKHNvdXJjZVtoYW5kbGVyS2V5XSwgaGFuZGxlcktleSk7CiAgICB9CiAgfTsKCiAgdmFyIGxpc3RlbmVyID0gewogICAga2V5LAogICAgdW5zdWJzY3JpYmU6ICgpID0+IHsvLwogICAgfQogIH07CgogIGlmIChpc0FycmF5KGtleSkpIHsKICAgIGtleS5mb3JFYWNoKGNhY2hlT2JzZXJ2ZXJIYW5kbGVycyk7CgogICAgbGlzdGVuZXIudW5zdWJzY3JpYmUgPSAoKSA9PiBrZXkuZm9yRWFjaChrID0+IHVuc3Vic2NyaWJlKGssIGhhbmRsZXIpKTsgLy8KCiAgfSBlbHNlIHsKICAgIGNhY2hlT2JzZXJ2ZXJIYW5kbGVycyhrZXkpOwoKICAgIGxpc3RlbmVyLnVuc3Vic2NyaWJlID0gKCkgPT4gdW5zdWJzY3JpYmUoa2V5LCBoYW5kbGVyKTsKICB9CgogIHJldHVybiBsaXN0ZW5lcjsKfSAvLyDorqLpmIXkuIDmrKHvvIzlsLHplIDmr4EKCmV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpYmVPbmNlKGtleSwgaGFuZGxlcikgewogIHZhciBsaXN0ZW5lciA9IHN1YnNjcmliZShrZXksIGRhdGEgPT4gewogICAgaGFuZGxlcihkYXRhLCBrZXkpOwogICAgbGlzdGVuZXIudW5zdWJzY3JpYmUoKTsKICB9KTsKfQo7CgooZnVuY3Rpb24gKCkgewogIHZhciByZWFjdEhvdExvYWRlciA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5kZWZhdWx0IDogdW5kZWZpbmVkOwoKICBpZiAoIXJlYWN0SG90TG9hZGVyKSB7CiAgICByZXR1cm47CiAgfQoKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihzdG9yZVJvb3QsICJzdG9yZVJvb3QiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xcbWVzc2FnZS5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKG9ic2VydmVyLCAib2JzZXJ2ZXIiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xcbWVzc2FnZS5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNvdXJjZSwgInNvdXJjZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHV0aWxzXFxtZXNzYWdlLmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoc3RvcmVLZXlDdHJsLCAic3RvcmVLZXlDdHJsIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXG1lc3NhZ2UuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihvYnNlcnZlU3RvcmUsICJvYnNlcnZlU3RvcmUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xcbWVzc2FnZS5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHB1Ymxpc2gsICJwdWJsaXNoIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXG1lc3NhZ2UuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcih1bnN1YnNjcmliZSwgInVuc3Vic2NyaWJlIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXG1lc3NhZ2UuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcih1bnN1YnNjcmliZUFsbCwgInVuc3Vic2NyaWJlQWxsIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXG1lc3NhZ2UuanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihzdWJzY3JpYmUsICJzdWJzY3JpYmUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFx1dGlsc1xcbWVzc2FnZS5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHN1YnNjcmliZU9uY2UsICJzdWJzY3JpYmVPbmNlIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxcdXRpbHNcXG1lc3NhZ2UuanMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmxlYXZlTW9kdWxlIDogdW5kZWZpbmVkOwogIGxlYXZlTW9kdWxlICYmIGxlYXZlTW9kdWxlKG1vZHVsZSk7Cn0pKCk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/utils/message.js"],"names":["isArray","isNone","message","storeRoot","observer","source","storeKeyCtrl","type","value","isStoreKey","indexOf","undefined","split","observeStore","Proxy","get","_","key","set","obj","storeKey","forEach","handler","publish","msgValue","keyToObserver","obsKey","sourceKey","unsubscribe","offObserver","offKey","obsHandler","index","splice","unsubscribeAll","subscribe","cacheObserverHandlers","mapKey","push","handlerKey","listener","k","subscribeOnce","data"],"mappings":"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","sourcesContent":["/**\n * 实现消息通知逻辑\n * 解耦组件状态依赖\n */\nimport isArray from 'lodash/isArray';\nimport isNone from 'lodash/isUndefined';\nimport { message } from \"../constants\";\nconst { storeRoot } = message;\nlet observer = {};\nconst source = {};\n// 格式化存储 key 格式\nconst storeKeyCtrl = (type, value = '') => {\n    const isStoreKey = value.indexOf(storeRoot) === 0;\n    if (type === 'set') {\n        return isStoreKey ? value : `${storeRoot}${value}`;\n    }\n    return !isStoreKey ? undefined : value.split(storeRoot)[1];\n};\n// 更改 store 值,就会自动 publish 消息\nexport const observeStore = new Proxy({}, {\n    get(_, key) {\n        return source[key];\n    },\n    // 整个模块的核心逻辑\n    // 代理object赋值操作，设置值的时候，触发订阅时的回调函数\n    set(obj, key, value) {\n        // 只有值变化 才触发回调。\n        if (!(source[key] && source[key] === value)) {\n            // eslint-disable-next-line\n            obj[key] = value;\n            const storeKey = storeKeyCtrl('set', key);\n            if (storeKey && !isNone(observer[storeKey])) {\n                observer[storeKey].forEach((handler) => {\n                    handler(value, storeKey);\n                });\n            }\n        }\n        return true;\n    },\n});\n// 发送消息\nexport function publish(key, value) {\n    const msgValue = typeof value === 'undefined' ? {} : value;\n    const keyToObserver = (obsKey) => {\n        const sourceKey = storeKeyCtrl('get', obsKey);\n        if (sourceKey && !isNone(source[sourceKey])) {\n            source[sourceKey] = msgValue;\n        }\n        if (!isNone(observer[obsKey])) {\n            observer[obsKey].forEach((handler) => {\n                handler(msgValue, obsKey);\n            });\n        }\n    };\n    if (isArray(key)) {\n        key.forEach(keyToObserver);\n    }\n    else {\n        keyToObserver(key);\n    }\n}\n// 取消订阅\nexport function unsubscribe(key, handler) {\n    const offObserver = (offKey) => {\n        if (!isNone(observer[offKey])) {\n            if (!handler) {\n                observer[offKey] = [];\n            }\n            else {\n                observer[offKey].forEach((obsHandler, index) => {\n                    if (obsHandler === handler) {\n                        observer[offKey].splice(index, 1);\n                    }\n                });\n            }\n        }\n    };\n    if (isArray(key)) {\n        key.forEach(offObserver);\n    }\n    else {\n        offObserver(key);\n    }\n}\nexport function unsubscribeAll() {\n    observer = {};\n}\n// 消息订阅\nexport function subscribe(key, handler) {\n    const cacheObserverHandlers = (mapKey) => {\n        if (isNone(observer[mapKey])) {\n            observer[mapKey] = [];\n        }\n        observer[mapKey].push(handler);\n        const handlerKey = storeKeyCtrl('get', mapKey);\n        if (handlerKey && !isNone(source[handlerKey])) {\n            handler(source[handlerKey], handlerKey);\n        }\n    };\n    const listener = {\n        key,\n        unsubscribe: () => {\n            //\n        },\n    };\n    if (isArray(key)) {\n        key.forEach(cacheObserverHandlers);\n        listener.unsubscribe = () => key.forEach((k) => unsubscribe(k, handler));\n        //\n    }\n    else {\n        cacheObserverHandlers(key);\n        listener.unsubscribe = () => unsubscribe(key, handler);\n    }\n    return listener;\n}\n// 订阅一次，就销毁\nexport function subscribeOnce(key, handler) {\n    const listener = subscribe(key, (data) => {\n        handler(data, key);\n        listener.unsubscribe();\n    });\n}\n"]}]}