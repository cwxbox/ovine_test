{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--5-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\config.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\config.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEFwcCByb3V0ZSDphY3nva4KICogVE9ETzog5re75YqgIHVuaXQgdGVzdAogKi8KaW1wb3J0IHsgbWFwVHJlZSwgZWFjaFRyZWUgfSBmcm9tICdhbWlzL2xpYi91dGlscy9oZWxwZXInOwppbXBvcnQgeyBjbG9uZURlZXAsIGxhc3QsIHBpY2ssIG1hcCwgZ2V0IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgc3RyRGVsaW1pdGVyLCBwYXJlbnRLZXkgfSBmcm9tICIuLi9jb25zdGFudHMiOwppbXBvcnQgeyBnZXRQYWdlUHJlc2V0IH0gZnJvbSAiLi9leHBvcnRzIjsKaW1wb3J0IHsgY2hlY2tMaW1pdEJ5S2V5cywgY2hlY2tMaW1pdEJ5Tm9kZVBhdGggfSBmcm9tICIuL2xpbWl0L2V4cG9ydHMiOwp2YXIgc3RvcmUgPSB7CiAgcm91dGVzQ29uZmlnOiBbXSwKICBhY3Rpb25BZGRyTWFwOiB7fQp9OyAvLyDop6PmnpDphY3nva7nmoTot6/nlLHmlbDmja4KLy8gMS4g5qC55o2uIG5vZGVQYXRoIOeUn+aIkOm7mOiupCBwYXRoIOi3r+W+hOWAvAoKdmFyIHJlc29sdmVDb25maWcgPSBub2RlcyA9PiB7CiAgcmV0dXJuIG1hcFRyZWUobm9kZXMsIChpdGVtLCBfLCBfXywgaXRlbU5vZGVzKSA9PiB7CiAgICB2YXIgewogICAgICBwYXRoLAogICAgICBsaW1pdExhYmVsLAogICAgICBsYWJlbCwKICAgICAgbm9kZVBhdGgsCiAgICAgIGV4YWN0LAogICAgICBjaGlsZHJlbiwKICAgICAgcGF0aFRvQ29tcG9uZW50CiAgICB9ID0gaXRlbTsKICAgIHZhciBsYXN0SXRlbSA9IGxhc3QoaXRlbU5vZGVzKTsKICAgIGl0ZW0ubm9kZVBhdGggPSAiIi5jb25jYXQoKGxhc3RJdGVtID09PSBudWxsIHx8IGxhc3RJdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXN0SXRlbS5ub2RlUGF0aCkgfHwgJycsICIvIikuY29uY2F0KG5vZGVQYXRoKS5yZXBsYWNlKC8oXC9cLykvZywgJy8nKTsKICAgIGl0ZW0ubm9kZUxhYmVsID0gIiIuY29uY2F0KChsYXN0SXRlbSA9PT0gbnVsbCB8fCBsYXN0SXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGFzdEl0ZW0ubGFiZWwpIHx8IChsYXN0SXRlbSA9PT0gbnVsbCB8fCBsYXN0SXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGFzdEl0ZW0ubGltaXRMYWJlbCkgfHwgJycsICIvIikuY29uY2F0KGxhYmVsIHx8IGxpbWl0TGFiZWwgfHwgJycpOwoKICAgIGlmIChleGFjdCAmJiBjaGlsZHJlbikgewogICAgICAvLyDlvZPniLbpobXpnaLlhYHorrjorr/pl67ml7bvvIzpu5jorqTmt7vliqAgL3BhcmVudCDlkI7nvIAKICAgICAgdmFyIGxpbWl0S2V5ID0gIiIuY29uY2F0KGl0ZW0ubm9kZVBhdGgsICIvIikuY29uY2F0KHBhcmVudEtleSk7IC8vIOadg+mZkOmAmui/h++8jOaJjeiuvue9ruWvueW6lOeahCBwYXRoCgogICAgICBpZiAoY2hlY2tMaW1pdEJ5Tm9kZVBhdGgobGltaXRLZXkpKSB7CiAgICAgICAgaXRlbS5wYXRoID0gcGF0aCB8fCBpdGVtLm5vZGVQYXRoOwogICAgICAgIGl0ZW0ucGF0aFRvQ29tcG9uZW50ID0gcGF0aFRvQ29tcG9uZW50IHx8IGl0ZW0ubm9kZVBhdGggfHwgcGF0aCB8fCAnJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWxldGUgaXRlbS5wYXRoOwogICAgICB9CiAgICB9CgogICAgaWYgKCFwYXRoICYmIChwYXRoVG9Db21wb25lbnQgfHwgIWNoaWxkcmVuICYmICFwYXRoVG9Db21wb25lbnQpKSB7CiAgICAgIGl0ZW0ucGF0aCA9IGl0ZW0ubm9kZVBhdGg7CiAgICB9CgogICAgcmV0dXJuIGl0ZW07CiAgfSk7Cn07IC8vIOW9k+acquiuvue9riBsaW1pdHMg5a2X5q615pe277yM5Lya5pyJIHVuZGVmaW5lZCDmmL7npLrmg4XlhrUKCgp2YXIgcmVzb2xlUHJlc2V0ID0gY29uZmlnID0+IHsKICBlYWNoVHJlZShjb25maWcsIGl0ZW0gPT4gewogICAgdmFyIHsKICAgICAgbm9kZVBhdGgsCiAgICAgIG5vZGVMYWJlbAogICAgfSA9IGl0ZW07CiAgICB2YXIgcHJlc2V0ID0gZ2V0UGFnZVByZXNldChpdGVtKSB8fCBwaWNrKGl0ZW0sIFsnYXBpcycsICdsaW1pdHMnXSk7CiAgICB2YXIgewogICAgICBsaW1pdHMsCiAgICAgIGFwaXMKICAgIH0gPSBwcmVzZXQ7IC8vIOWwhiBwcmVzZXQg6YWN572u55qEIGFwaXPvvIwg5re75Yqg5Yiw5p2D6ZmQ6YWN572u6KGo5LitCgogICAgaWYgKCFhcGlzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBtYXAoYXBpcywgYXBpSXRlbSA9PiB7CiAgICAgIHZhciB7CiAgICAgICAgbGltaXRzOiBhcGlOZWVkcywKICAgICAgICBhY3Rpb25EZXNjLAogICAgICAgIGFjdGlvbkFkZHIKICAgICAgfSA9IGFwaUl0ZW07CiAgICAgIHZhciBwcmVzZXRBcGlOZWVkcyA9IHR5cGVvZiBhcGlOZWVkcyA9PT0gJ3N0cmluZycgPyBbYXBpTmVlZHNdIDogYXBpTmVlZHM7IC8vIOiuvue9rkFQSem7mOiupOmAiemhuQoKICAgICAgYXBpSXRlbS5hY3Rpb25BZGRyID0gYWN0aW9uQWRkciB8fCAiIi5jb25jYXQobm9kZVBhdGgpLmNvbmNhdChzdHJEZWxpbWl0ZXIpLmNvbmNhdChwcmVzZXRBcGlOZWVkcyA9PT0gbnVsbCB8fCBwcmVzZXRBcGlOZWVkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJlc2V0QXBpTmVlZHMuam9pbignLCcpKTsKICAgICAgYXBpSXRlbS5hcGkgPSBhcGlJdGVtLnVybCB8fCAnJzsKICAgICAgc3RvcmUuYWN0aW9uQWRkck1hcFthcGlJdGVtLmFjdGlvbkFkZHJdID0gewogICAgICAgIGFjdGlvbkRlc2MsCiAgICAgICAgYXBpOiBhcGlJdGVtLmFwaSwKICAgICAgICBsYWJlbDogIiIuY29uY2F0KG5vZGVMYWJlbCkuY29uY2F0KHN0ckRlbGltaXRlcikuY29uY2F0KHByZXNldEFwaU5lZWRzID09PSBudWxsIHx8IHByZXNldEFwaU5lZWRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcmVzZXRBcGlOZWVkcy5tYXAoaSA9PiBnZXQobGltaXRzLCAiIi5jb25jYXQoaSwgIi5sYWJlbCIpKSB8fCAnLS0nKS5qb2luKCcsJykpCiAgICAgIH07CiAgICB9KTsKICB9KTsKICByZXR1cm4gY29uZmlnOwp9OwoKZXhwb3J0IGZ1bmN0aW9uIHNldFJvdXRlc0NvbmZpZyhyb3V0ZXMpIHsKICBzdG9yZS5yb3V0ZXNDb25maWcgPSByZXNvbGVQcmVzZXQocmVzb2x2ZUNvbmZpZyhjbG9uZURlZXAocm91dGVzKSkpOwp9CmV4cG9ydCBmdW5jdGlvbiBnZXRSb3V0ZUNvbmZpZyhyZWZyZXNoKSB7CiAgaWYgKHJlZnJlc2gpIHsKICAgIC8vIOmYsuatouS/ruaUueWOn+Wni+aVsOaNrgogICAgcmV0dXJuIGNsb25lRGVlcChzdG9yZS5yb3V0ZXNDb25maWcpOwogIH0KCiAgcmV0dXJuIHN0b3JlLnJvdXRlc0NvbmZpZzsKfQpleHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uQWRkck1hcCgpIHsKICBtYXAoc3RvcmUuYWN0aW9uQWRkck1hcCwgKGl0ZW0sIGtleSkgPT4gewogICAgdmFyIFtub2RlUGF0aCA9ICcnLCBsaW1pdFN0ciA9ICcnXSA9IGtleS5zcGxpdChzdHJEZWxpbWl0ZXIpOwogICAgdmFyIGxpbWl0cyA9IGxpbWl0U3RyLnNwbGl0KCcsJykgfHwgW107CiAgICB2YXIgYXV0aCA9ICEhbGltaXRzLnNvbWUobGltaXQgPT4gY2hlY2tMaW1pdEJ5S2V5cyhsaW1pdCwgewogICAgICBub2RlUGF0aAogICAgfSkpOwogICAgaXRlbS5hdXRoID0gYXV0aDsKICB9KTsKICByZXR1cm4gc3RvcmUuYWN0aW9uQWRkck1hcDsKfQ=="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/routes/config.js"],"names":["mapTree","eachTree","cloneDeep","last","pick","map","get","strDelimiter","parentKey","getPagePreset","checkLimitByKeys","checkLimitByNodePath","store","routesConfig","actionAddrMap","resolveConfig","nodes","item","_","__","itemNodes","path","limitLabel","label","nodePath","exact","children","pathToComponent","lastItem","replace","nodeLabel","limitKey","resolePreset","config","preset","limits","apis","apiItem","apiNeeds","actionDesc","actionAddr","presetApiNeeds","join","api","url","i","setRoutesConfig","routes","getRouteConfig","refresh","getActionAddrMap","key","limitStr","split","auth","some","limit"],"mappings":"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","sourcesContent":["/**\n * App route 配置\n * TODO: 添加 unit test\n */\nimport { mapTree, eachTree } from 'amis/lib/utils/helper';\nimport { cloneDeep, last, pick, map, get } from 'lodash';\nimport { strDelimiter, parentKey } from \"../constants\";\nimport { getPagePreset } from \"./exports\";\nimport { checkLimitByKeys, checkLimitByNodePath } from \"./limit/exports\";\nconst store = {\n    routesConfig: [],\n    actionAddrMap: {},\n};\n// 解析配置的路由数据\n// 1. 根据 nodePath 生成默认 path 路径值\nconst resolveConfig = (nodes) => {\n    return mapTree(nodes, (item, _, __, itemNodes) => {\n        const { path, limitLabel, label, nodePath, exact, children, pathToComponent } = item;\n        const lastItem = last(itemNodes);\n        item.nodePath = `${(lastItem === null || lastItem === void 0 ? void 0 : lastItem.nodePath) || ''}/${nodePath}`.replace(/(\\/\\/)/g, '/');\n        item.nodeLabel = `${(lastItem === null || lastItem === void 0 ? void 0 : lastItem.label) || (lastItem === null || lastItem === void 0 ? void 0 : lastItem.limitLabel) || ''}/${label || limitLabel || ''}`;\n        if (exact && children) {\n            // 当父页面允许访问时，默认添加 /parent 后缀\n            const limitKey = `${item.nodePath}/${parentKey}`;\n            // 权限通过，才设置对应的 path\n            if (checkLimitByNodePath(limitKey)) {\n                item.path = path || item.nodePath;\n                item.pathToComponent = pathToComponent || item.nodePath || path || '';\n            }\n            else {\n                delete item.path;\n            }\n        }\n        if (!path && (pathToComponent || (!children && !pathToComponent))) {\n            item.path = item.nodePath;\n        }\n        return item;\n    });\n};\n// 当未设置 limits 字段时，会有 undefined 显示情况\nconst resolePreset = (config) => {\n    eachTree(config, (item) => {\n        const { nodePath, nodeLabel } = item;\n        const preset = getPagePreset(item) || pick(item, ['apis', 'limits']);\n        const { limits, apis } = preset;\n        // 将 preset 配置的 apis， 添加到权限配置表中\n        if (!apis) {\n            return;\n        }\n        map(apis, (apiItem) => {\n            const { limits: apiNeeds, actionDesc, actionAddr } = apiItem;\n            const presetApiNeeds = typeof apiNeeds === 'string' ? [apiNeeds] : apiNeeds;\n            // 设置API默认选项\n            apiItem.actionAddr = actionAddr || `${nodePath}${strDelimiter}${presetApiNeeds === null || presetApiNeeds === void 0 ? void 0 : presetApiNeeds.join(',')}`;\n            apiItem.api = apiItem.url || '';\n            store.actionAddrMap[apiItem.actionAddr] = {\n                actionDesc,\n                api: apiItem.api,\n                label: `${nodeLabel}${strDelimiter}${presetApiNeeds === null || presetApiNeeds === void 0 ? void 0 : presetApiNeeds.map((i) => get(limits, `${i}.label`) || '--').join(',')}`,\n            };\n        });\n    });\n    return config;\n};\nexport function setRoutesConfig(routes) {\n    store.routesConfig = resolePreset(resolveConfig(cloneDeep(routes)));\n}\nexport function getRouteConfig(refresh) {\n    if (refresh) {\n        // 防止修改原始数据\n        return cloneDeep(store.routesConfig);\n    }\n    return store.routesConfig;\n}\nexport function getActionAddrMap() {\n    map(store.actionAddrMap, (item, key) => {\n        const [nodePath = '', limitStr = ''] = key.split(strDelimiter);\n        const limits = limitStr.split(',') || [];\n        const auth = !!limits.some((limit) => checkLimitByKeys(limit, { nodePath }));\n        item.auth = auth;\n    });\n    return store.actionAddrMap;\n}\n"]}]}