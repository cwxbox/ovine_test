{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\index.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\index.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:KGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWwuZW50ZXJNb2R1bGUgOiB1bmRlZmluZWQ7CiAgZW50ZXJNb2R1bGUgJiYgZW50ZXJNb2R1bGUobW9kdWxlKTsKfSkoKTsKCnZhciBfX3NpZ25hdHVyZV9fID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQuc2lnbmF0dXJlIDogZnVuY3Rpb24gKGEpIHsKICByZXR1cm4gYTsKfTsKCi8qKgogKiBBUFAg5p2D6ZmQ6YWN572u6KGo5aSE55CGCiAqIFRPRE86IOa3u+WKoCB1bml0IHRlc3QKICovCmltcG9ydCB7IGZpbHRlclRyZWUsIG1hcFRyZWUgfSBmcm9tICdhbWlzL2xpYi91dGlscy9oZWxwZXInOwppbXBvcnQgeyBtYXAsIGlzRW1wdHksIHBpY2ssIGNsb25lRGVlcCwgZ2V0IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgYXBwIH0gZnJvbSAiLi4vLi4vYXBwIjsKaW1wb3J0IHsgcm91dGVMaW1pdEtleSwgcGFyZW50S2V5LCBzdG9yYWdlIH0gZnJvbSAiLi4vLi4vY29uc3RhbnRzIjsKaW1wb3J0IHsgZ2V0UGFnZVByZXNldCB9IGZyb20gIi4uL2V4cG9ydHMiOwppbXBvcnQgeyBnZXRHbG9iYWwsIHNldEdsb2JhbCB9IGZyb20gIi4uLy4uL3V0aWxzL3N0b3JlIjsKaW1wb3J0IHsgZ2V0Um91dGVDb25maWcgfSBmcm9tICIuLi9jb25maWciOwppbXBvcnQgeyBjaGVja0xpbWl0QnlOb2RlUGF0aCwgZ2V0QXBwTGltaXRzIH0gZnJvbSAiLi9leHBvcnRzIjsgLy8g5aSE55CGIHByZXNldC5saW1pdHMubmVlZHMg6YWN572u55qE5pWw5o2uCgp2YXIgcmVzb2x2ZUxpbWl0TmVlZHMgPSAoa2V5LCBsaW1pdHMpID0+IHsKICB2YXIgY2hlY2tlZCA9IHt9OwogIHZhciB7CiAgICBuZWVkcyA9IFtdCiAgfSA9IGxpbWl0c1trZXldOyAvLyDkvr/liKnmiYDmnInoioLngrkKCiAgdmFyIGdldE5lZWRzID0gZnVuY3Rpb24gZ2V0TmVlZHMoKSB7CiAgICB2YXIgbm9kZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICAvLyDpmLLmraLlvqrnjq/kvp3otZYKICAgIG5vZGUuZm9yRWFjaChrID0+IHsKICAgICAgdmFyIF9hOwoKICAgICAgaWYgKCFjaGVja2VkW2tdKSB7CiAgICAgICAgY2hlY2tlZFtrXSA9IHRydWU7CiAgICAgICAgZ2V0TmVlZHMoKF9hID0gbGltaXRzW2tdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmVlZHMpOwogICAgICB9CiAgICB9KTsKICB9OyAvLyDmt7vliqDpu5jorqQgJHBhZ2Ug6aG16Z2i5p2D6ZmQCgoKICBpZiAobGltaXRzW3JvdXRlTGltaXRLZXldICYmICFjaGVja2VkW3JvdXRlTGltaXRLZXldKSB7CiAgICBjaGVja2VkW3JvdXRlTGltaXRLZXldID0gdHJ1ZTsKICAgIG5lZWRzLnB1c2gocm91dGVMaW1pdEtleSk7CiAgfQoKICBnZXROZWVkcyhuZWVkcyk7CiAgcmV0dXJuIE9iamVjdC5rZXlzKGNoZWNrZWQpOwp9OwoKdmFyIGdldFN0b3JlID0gdHlwZSA9PiB7CiAgdmFyIHN0b3JlID0gZ2V0R2xvYmFsKHN0b3JhZ2Uucm91dGVEYXRhKSB8fCB7fTsKICByZXR1cm4gc3RvcmVbdHlwZV0gfHwgW107Cn07Cgp2YXIgc2V0U3RvcmUgPSAodHlwZSwgZGF0YSkgPT4gewogIHZhciBzdG9yZSA9IGdldEdsb2JhbChzdG9yYWdlLnJvdXRlRGF0YSk7CiAgc3RvcmVbdHlwZV0gPSBkYXRhOwogIHNldEdsb2JhbChzdG9yYWdlLnJvdXRlRGF0YSwgc3RvcmUpOwp9OwoKZXhwb3J0IHZhciBjbGVhclJvdXRlU3RvcmUgPSAoKSA9PiB7CiAgc2V0R2xvYmFsKHN0b3JhZ2Uucm91dGVEYXRhLCB7fSk7Cn07IC8vIOi/h+a7pOaOiSDphY3nva7ot6/nlLHkv6Hmga8KLy8gMS4g5Y676Zmk5peg5p2D6ZmQ6Lev55SxCi8vIDIuIOWOu+mZpOS+p+i+ueagj+makOiXjyDoj5zljZXpobkKCnZhciBmaWx0ZXJSb3V0ZXNDb25maWcgPSB0eXBlID0+IHsKICB2YXIgbGltaXRzID0gZ2V0QXBwTGltaXRzKCk7IC8vIOS4jeagoemqjOadg+mZkCDlubbkuJQgbGltaXRzIOaVsOaNruS4uuepuuaXtgoKICBpZiAoIWFwcC5lbnYuZGlzYWJsZUxpbWl0ICYmIGlzRW1wdHkobGltaXRzKSkgewogICAgLy8g6aG16Z2i6Lev55Sx5LuA5LmI6YO95rKh5pyJCiAgICByZXR1cm4gW107CiAgfQoKICB2YXIgbm9kZXMgPSBmaWx0ZXJUcmVlKGdldFJvdXRlQ29uZmlnKHRydWUpLCBpdGVtID0+IHsKICAgIHZhciB7CiAgICAgIG5vZGVQYXRoLAogICAgICBpZ25vcmVMaW1pdCwKICAgICAgbGltaXRPbmx5CiAgICB9ID0gaXRlbTsKICAgIHZhciBhdXRoID0gaWdub3JlTGltaXQgPT09IHRydWUgPyB0cnVlIDogY2hlY2tMaW1pdEJ5Tm9kZVBhdGgobm9kZVBhdGgsIGxpbWl0cyk7CgogICAgaWYgKG5vZGVQYXRoID09PSAnLycgJiYgIWxpbWl0T25seSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnYXNpZGUnOgogICAgICAgIHJldHVybiBhdXRoICYmIGxpbWl0T25seSAhPT0gdHJ1ZTsKCiAgICAgIGNhc2UgJ2xpbWl0JzoKICAgICAgICByZXR1cm4gIWlnbm9yZUxpbWl0ICYmIGF1dGg7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBhdXRoOwogICAgfQogIH0pOwogIHJldHVybiBub2RlczsKfTsgLy8g5Y+v55So6Lev55Sx5p2D6ZmQLS0t5rOo5oSP6aG16Z2i5YaF5pON5L2c5p2D6ZmQ5rKh5pyJ5qCh6aqMCgoKZXhwb3J0IHZhciBnZXRBdXRoUm91dGVzID0gKCkgPT4gewogIGlmIChnZXRTdG9yZSgnYXV0aFJvdXRlcycpLmxlbmd0aCkgewogICAgcmV0dXJuIGdldFN0b3JlKCdhdXRoUm91dGVzJyk7CiAgfQoKICB2YXIgYXV0aFJvdXRlcyA9IGZpbHRlclJvdXRlc0NvbmZpZygncm91dGUnKTsKICBzZXRTdG9yZSgnYXV0aFJvdXRlcycsIGF1dGhSb3V0ZXMpOwogIHJldHVybiBhdXRoUm91dGVzOwp9OyAvLyDkvqfovrnmoI8g5bGV56S66I+c5Y2V6YWN572uCgpleHBvcnQgdmFyIGdldEFzaWRlTWVudXMgPSAoKSA9PiB7CiAgaWYgKGdldFN0b3JlKCdhc2lkZU1lbnVzJykubGVuZ3RoKSB7CiAgICByZXR1cm4gZ2V0U3RvcmUoJ2FzaWRlTWVudXMnKTsKICB9CgogIHZhciBhc2lkZU1lbnVzID0gZmlsdGVyUm91dGVzQ29uZmlnKCdhc2lkZScpOwogIHNldFN0b3JlKCdhc2lkZU1lbnVzJywgYXNpZGVNZW51cyk7CiAgcmV0dXJuIGFzaWRlTWVudXM7Cn07IC8vIOadg+mZkOmFjee9ruihqAoKZXhwb3J0IHZhciBnZXRMaW1pdE1lbnVzID0gb3B0aW9uID0+IHsKICB2YXIgewogICAgcmVmcmVzaCA9IGZhbHNlLAogICAgdXNlQWxsTGltaXQgPSBmYWxzZQogIH0gPSBvcHRpb24gfHwge307CgogIGlmICghcmVmcmVzaCAmJiBnZXRTdG9yZSgnbGltaXRNZW51cycpLmxlbmd0aCkgewogICAgcmV0dXJuIGdldFN0b3JlKCdsaW1pdE1lbnVzJyk7CiAgfQoKICB2YXIgdXNlclJvdXRlcyA9IHVzZUFsbExpbWl0ID8gZ2V0Um91dGVDb25maWcodHJ1ZSkgOiBjbG9uZURlZXAoZmlsdGVyUm91dGVzQ29uZmlnKCdsaW1pdCcpKTsgLy8g5p6E5bu65p2D6ZmQ6YWN572u6Z2i5p2/6I+c5Y2V57uT5p6ECgogIHZhciBsaW1pdE1lbnVzID0gbWFwVHJlZSh1c2VyUm91dGVzLCBpdGVtID0+IHsKICAgIHZhciB7CiAgICAgIG5vZGVQYXRoLAogICAgICBjaGlsZHJlbgogICAgfSA9IGl0ZW07CiAgICB2YXIgcHJlc2V0ID0gZ2V0UGFnZVByZXNldChpdGVtKSB8fCBwaWNrKGl0ZW0sIFsnYXBpcycsICdsaW1pdHMnXSk7CiAgICB2YXIgewogICAgICBsaW1pdHMsCiAgICAgIGFwaXMKICAgIH0gPSBwcmVzZXQ7IC8vIGxpbWl0cyDooajnpLog5b2T5YmN6IqC54K5IOacieWtkOadg+mZkAoKICAgIGlmIChsaW1pdHMpIHsKICAgICAgdmFyIGxpbWl0Tm9kZVBhdGggPSBjaGlsZHJlbiA/ICIiLmNvbmNhdChub2RlUGF0aCwgIi8iKS5jb25jYXQocGFyZW50S2V5KSA6IG5vZGVQYXRoOwogICAgICB2YXIgbGltaXRJdGVtcyA9IG1hcChsaW1pdHMsIChfcmVmLCBrZXkpID0+IHsKICAgICAgICB2YXIgewogICAgICAgICAgaWNvbiwKICAgICAgICAgIGxhYmVsCiAgICAgICAgfSA9IF9yZWY7CiAgICAgICAgdmFyIG5lZWRzID0ga2V5ID09PSByb3V0ZUxpbWl0S2V5ID8gdW5kZWZpbmVkIDogcmVzb2x2ZUxpbWl0TmVlZHMoa2V5LCBsaW1pdHMpLm1hcChuZWVkSyA9PiAiIi5jb25jYXQobGltaXROb2RlUGF0aCwgIi8iKS5jb25jYXQobmVlZEspKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGFiZWwsCiAgICAgICAgICBuZWVkcywKICAgICAgICAgIGljb246IGljb24gfHwgJ2ZhIGZhLWNvZGUnLAogICAgICAgICAgbm9kZVBhdGg6ICIiLmNvbmNhdChsaW1pdE5vZGVQYXRoLCAiLyIpLmNvbmNhdChrZXkpCiAgICAgICAgfTsKICAgICAgfSk7CgogICAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgICBjaGlsZHJlbi51bnNoaWZ0KHsKICAgICAgICAgIGljb246ICdmYSBmYS1jb2RlLWZvcmsnLAogICAgICAgICAgbm9kZVBhdGg6IGxpbWl0Tm9kZVBhdGgsCiAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KGl0ZW0ubGFiZWwsICItXHU2NzQzXHU5NjUwIiksCiAgICAgICAgICBjaGlsZHJlbjogbGltaXRJdGVtcwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0uY2hpbGRyZW4gPSBsaW1pdEl0ZW1zOwogICAgICB9CiAgICB9IC8vIOWwhiBwcmVzZXQg6YWN572u55qEIGFwaXPvvIwg5re75Yqg5Yiw5p2D6ZmQ6YWN572u6KGo5LitCgoKICAgIGlmIChhcGlzKSB7CiAgICAgIHZhciBhbGxBcGlzID0ge307CiAgICAgIG1hcChhcGlzLCAoYXBpSXRlbSwgYXBpS2V5KSA9PiB7CiAgICAgICAgdmFyIHsKICAgICAgICAgIGtleTogYXBpQXV0aEtleSwKICAgICAgICAgIHVybCwKICAgICAgICAgIGxpbWl0czogYXBpTGltaXRzCiAgICAgICAgfSA9IGFwaUl0ZW07CiAgICAgICAgdmFyIHByZXNldEFwaUxpbWl0cyA9ICFhcGlMaW1pdHMgfHwgdHlwZW9mIGFwaUxpbWl0cyA9PT0gJ3N0cmluZycgPyBbYXBpTGltaXRzXSA6IGFwaUxpbWl0czsKICAgICAgICBhbGxBcGlzW2FwaUtleV0gPSB7CiAgICAgICAgICB1cmwsCiAgICAgICAgICBrZXk6IGFwaUF1dGhLZXksCiAgICAgICAgICBsaW1pdHM6ICFnZXQobGltaXRzLCByb3V0ZUxpbWl0S2V5KSA/IHByZXNldEFwaUxpbWl0cyA6IHByZXNldEFwaUxpbWl0cyA9PT0gbnVsbCB8fCBwcmVzZXRBcGlMaW1pdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZXNldEFwaUxpbWl0cy5jb25jYXQocm91dGVMaW1pdEtleSkKICAgICAgICB9OwogICAgICB9KTsKICAgICAgaXRlbS5hcGlzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpdGVtLmFwaXMpLCBhbGxBcGlzKTsKICAgIH0gLy8g5re75Yqg6buY6K6kIGljb24KCgogICAgaXRlbS5pY29uID0gaXRlbS5pY29uID8gaXRlbS5pY29uIDogJ2ZhIGZhLWNvZGUtZm9yayc7CiAgICByZXR1cm4gaXRlbTsKICB9KTsKCiAgaWYgKHVzZUFsbExpbWl0KSB7CiAgICBzZXRTdG9yZSgnbGltaXRNZW51cycsIGxpbWl0TWVudXMpOwogICAgcmV0dXJuIGxpbWl0TWVudXM7CiAgfQoKICB2YXIgYXBwTGltaXRzID0gZ2V0QXBwTGltaXRzKCk7CiAgdmFyIGZpbHRlcmVkTGltaXRNZW51cyA9IGZpbHRlclRyZWUobGltaXRNZW51cywgKF9yZWYyKSA9PiB7CiAgICB2YXIgewogICAgICBub2RlUGF0aAogICAgfSA9IF9yZWYyOwogICAgcmV0dXJuIG5vZGVQYXRoID09PSAnLycgPyB0cnVlIDogY2hlY2tMaW1pdEJ5Tm9kZVBhdGgobm9kZVBhdGgsIGFwcExpbWl0cyk7CiAgfSk7CiAgc2V0U3RvcmUoJ2xpbWl0TWVudXMnLCBmaWx0ZXJlZExpbWl0TWVudXMpOwogIHJldHVybiBmaWx0ZXJlZExpbWl0TWVudXM7Cn07CjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIHJlYWN0SG90TG9hZGVyID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmRlZmF1bHQgOiB1bmRlZmluZWQ7CgogIGlmICghcmVhY3RIb3RMb2FkZXIpIHsKICAgIHJldHVybjsKICB9CgogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHJlc29sdmVMaW1pdE5lZWRzLCAicmVzb2x2ZUxpbWl0TmVlZHMiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGdldFN0b3JlLCAiZ2V0U3RvcmUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNldFN0b3JlLCAic2V0U3RvcmUiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGNsZWFyUm91dGVTdG9yZSwgImNsZWFyUm91dGVTdG9yZSIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcbGltaXRcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoZmlsdGVyUm91dGVzQ29uZmlnLCAiZmlsdGVyUm91dGVzQ29uZmlnIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxsaW1pdFxcaW5kZXguanMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihnZXRBdXRoUm91dGVzLCAiZ2V0QXV0aFJvdXRlcyIsICJDOlxcVXNlcnNcXGN3eFxcRGVza3RvcFxcZWRpdG9yLWRlbW9cXG5vZGVfbW9kdWxlc1xcQG92aW5lXFxjb3JlXFxsaWJcXHJvdXRlc1xcbGltaXRcXGluZGV4LmpzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoZ2V0QXNpZGVNZW51cywgImdldEFzaWRlTWVudXMiLCAiQzpcXFVzZXJzXFxjd3hcXERlc2t0b3BcXGVkaXRvci1kZW1vXFxub2RlX21vZHVsZXNcXEBvdmluZVxcY29yZVxcbGliXFxyb3V0ZXNcXGxpbWl0XFxpbmRleC5qcyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGdldExpbWl0TWVudXMsICJnZXRMaW1pdE1lbnVzIiwgIkM6XFxVc2Vyc1xcY3d4XFxEZXNrdG9wXFxlZGl0b3ItZGVtb1xcbm9kZV9tb2R1bGVzXFxAb3ZpbmVcXGNvcmVcXGxpYlxccm91dGVzXFxsaW1pdFxcaW5kZXguanMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmxlYXZlTW9kdWxlIDogdW5kZWZpbmVkOwogIGxlYXZlTW9kdWxlICYmIGxlYXZlTW9kdWxlKG1vZHVsZSk7Cn0pKCk7"},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/routes/limit/index.js"],"names":["filterTree","mapTree","map","isEmpty","pick","cloneDeep","get","app","routeLimitKey","parentKey","storage","getPagePreset","getGlobal","setGlobal","getRouteConfig","checkLimitByNodePath","getAppLimits","resolveLimitNeeds","key","limits","checked","needs","getNeeds","node","forEach","k","_a","push","Object","keys","getStore","type","store","routeData","setStore","data","clearRouteStore","filterRoutesConfig","env","disableLimit","nodes","item","nodePath","ignoreLimit","limitOnly","auth","getAuthRoutes","length","authRoutes","getAsideMenus","asideMenus","getLimitMenus","option","refresh","useAllLimit","userRoutes","limitMenus","children","preset","apis","limitNodePath","limitItems","icon","label","undefined","needK","unshift","allApis","apiItem","apiKey","apiAuthKey","url","apiLimits","presetApiLimits","concat","assign","appLimits","filteredLimitMenus"],"mappings":"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","sourcesContent":["/**\n * APP 权限配置表处理\n * TODO: 添加 unit test\n */\nimport { filterTree, mapTree } from 'amis/lib/utils/helper';\nimport { map, isEmpty, pick, cloneDeep, get } from 'lodash';\nimport { app } from \"../../app\";\nimport { routeLimitKey, parentKey, storage } from \"../../constants\";\nimport { getPagePreset } from \"../exports\";\nimport { getGlobal, setGlobal } from \"../../utils/store\";\nimport { getRouteConfig } from \"../config\";\nimport { checkLimitByNodePath, getAppLimits } from \"./exports\";\n// 处理 preset.limits.needs 配置的数据\nconst resolveLimitNeeds = (key, limits) => {\n    const checked = {};\n    const { needs = [] } = limits[key];\n    // 便利所有节点\n    const getNeeds = (node = []) => {\n        // 防止循环依赖\n        node.forEach((k) => {\n            var _a;\n            if (!checked[k]) {\n                checked[k] = true;\n                getNeeds((_a = limits[k]) === null || _a === void 0 ? void 0 : _a.needs);\n            }\n        });\n    };\n    // 添加默认 $page 页面权限\n    if (limits[routeLimitKey] && !checked[routeLimitKey]) {\n        checked[routeLimitKey] = true;\n        needs.push(routeLimitKey);\n    }\n    getNeeds(needs);\n    return Object.keys(checked);\n};\nconst getStore = (type) => {\n    const store = getGlobal(storage.routeData) || {};\n    return store[type] || [];\n};\nconst setStore = (type, data) => {\n    const store = getGlobal(storage.routeData);\n    store[type] = data;\n    setGlobal(storage.routeData, store);\n};\nexport const clearRouteStore = () => {\n    setGlobal(storage.routeData, {});\n};\n// 过滤掉 配置路由信息\n// 1. 去除无权限路由\n// 2. 去除侧边栏隐藏 菜单项\nconst filterRoutesConfig = (type) => {\n    const limits = getAppLimits();\n    // 不校验权限 并且 limits 数据为空时\n    if (!app.env.disableLimit && isEmpty(limits)) {\n        // 页面路由什么都没有\n        return [];\n    }\n    const nodes = filterTree(getRouteConfig(true), (item) => {\n        const { nodePath, ignoreLimit, limitOnly } = item;\n        const auth = ignoreLimit === true ? true : checkLimitByNodePath(nodePath, limits);\n        if (nodePath === '/' && !limitOnly) {\n            return true;\n        }\n        switch (type) {\n            case 'aside':\n                return auth && limitOnly !== true;\n            case 'limit':\n                return !ignoreLimit && auth;\n            default:\n                return auth;\n        }\n    });\n    return nodes;\n};\n// 可用路由权限---注意页面内操作权限没有校验\nexport const getAuthRoutes = () => {\n    if (getStore('authRoutes').length) {\n        return getStore('authRoutes');\n    }\n    const authRoutes = filterRoutesConfig('route');\n    setStore('authRoutes', authRoutes);\n    return authRoutes;\n};\n// 侧边栏 展示菜单配置\nexport const getAsideMenus = () => {\n    if (getStore('asideMenus').length) {\n        return getStore('asideMenus');\n    }\n    const asideMenus = filterRoutesConfig('aside');\n    setStore('asideMenus', asideMenus);\n    return asideMenus;\n};\n// 权限配置表\nexport const getLimitMenus = (option) => {\n    const { refresh = false, useAllLimit = false } = option || {};\n    if (!refresh && getStore('limitMenus').length) {\n        return getStore('limitMenus');\n    }\n    const userRoutes = useAllLimit ? getRouteConfig(true) : cloneDeep(filterRoutesConfig('limit'));\n    // 构建权限配置面板菜单结构\n    const limitMenus = mapTree(userRoutes, (item) => {\n        const { nodePath, children } = item;\n        const preset = getPagePreset(item) || pick(item, ['apis', 'limits']);\n        const { limits, apis } = preset;\n        // limits 表示 当前节点 有子权限\n        if (limits) {\n            const limitNodePath = children ? `${nodePath}/${parentKey}` : nodePath;\n            const limitItems = map(limits, ({ icon, label }, key) => {\n                const needs = key === routeLimitKey\n                    ? undefined\n                    : resolveLimitNeeds(key, limits).map((needK) => `${limitNodePath}/${needK}`);\n                return {\n                    label,\n                    needs,\n                    icon: icon || 'fa fa-code',\n                    nodePath: `${limitNodePath}/${key}`,\n                };\n            });\n            if (children) {\n                children.unshift({\n                    icon: 'fa fa-code-fork',\n                    nodePath: limitNodePath,\n                    label: `${item.label}-权限`,\n                    children: limitItems,\n                });\n            }\n            else {\n                item.children = limitItems;\n            }\n        }\n        // 将 preset 配置的 apis， 添加到权限配置表中\n        if (apis) {\n            const allApis = {};\n            map(apis, (apiItem, apiKey) => {\n                const { key: apiAuthKey, url, limits: apiLimits } = apiItem;\n                const presetApiLimits = !apiLimits || typeof apiLimits === 'string' ? [apiLimits] : apiLimits;\n                allApis[apiKey] = {\n                    url,\n                    key: apiAuthKey,\n                    limits: !get(limits, routeLimitKey)\n                        ? presetApiLimits\n                        : presetApiLimits === null || presetApiLimits === void 0 ? void 0 : presetApiLimits.concat(routeLimitKey),\n                };\n            });\n            item.apis = Object.assign(Object.assign({}, item.apis), allApis);\n        }\n        // 添加默认 icon\n        item.icon = item.icon ? item.icon : 'fa fa-code-fork';\n        return item;\n    });\n    if (useAllLimit) {\n        setStore('limitMenus', limitMenus);\n        return limitMenus;\n    }\n    const appLimits = getAppLimits();\n    const filteredLimitMenus = filterTree(limitMenus, ({ nodePath }) => {\n        return nodePath === '/' ? true : checkLimitByNodePath(nodePath, appLimits);\n    });\n    setStore('limitMenus', filteredLimitMenus);\n    return filteredLimitMenus;\n};\n"]}]}