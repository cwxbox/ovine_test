{"remainingRequest":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js??ref--5-1!C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\index.js","dependencies":[{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\@ovine\\core\\lib\\routes\\limit\\index.js","mtime":1618319234665},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616400859944},{"path":"C:\\Users\\cwx\\Desktop\\editor-demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1617798315061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEFQUCDmnYPpmZDphY3nva7ooajlpITnkIYKICogVE9ETzog5re75YqgIHVuaXQgdGVzdAogKi8KaW1wb3J0IHsgZmlsdGVyVHJlZSwgbWFwVHJlZSB9IGZyb20gJ2FtaXMvbGliL3V0aWxzL2hlbHBlcic7CmltcG9ydCB7IG1hcCwgaXNFbXB0eSwgcGljaywgY2xvbmVEZWVwLCBnZXQgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBhcHAgfSBmcm9tICIuLi8uLi9hcHAiOwppbXBvcnQgeyByb3V0ZUxpbWl0S2V5LCBwYXJlbnRLZXksIHN0b3JhZ2UgfSBmcm9tICIuLi8uLi9jb25zdGFudHMiOwppbXBvcnQgeyBnZXRQYWdlUHJlc2V0IH0gZnJvbSAiLi4vZXhwb3J0cyI7CmltcG9ydCB7IGdldEdsb2JhbCwgc2V0R2xvYmFsIH0gZnJvbSAiLi4vLi4vdXRpbHMvc3RvcmUiOwppbXBvcnQgeyBnZXRSb3V0ZUNvbmZpZyB9IGZyb20gIi4uL2NvbmZpZyI7CmltcG9ydCB7IGNoZWNrTGltaXRCeU5vZGVQYXRoLCBnZXRBcHBMaW1pdHMgfSBmcm9tICIuL2V4cG9ydHMiOyAvLyDlpITnkIYgcHJlc2V0LmxpbWl0cy5uZWVkcyDphY3nva7nmoTmlbDmja4KCnZhciByZXNvbHZlTGltaXROZWVkcyA9IChrZXksIGxpbWl0cykgPT4gewogIHZhciBjaGVja2VkID0ge307CiAgdmFyIHsKICAgIG5lZWRzID0gW10KICB9ID0gbGltaXRzW2tleV07IC8vIOS+v+WIqeaJgOacieiKgueCuQoKICB2YXIgZ2V0TmVlZHMgPSBmdW5jdGlvbiBnZXROZWVkcygpIHsKICAgIHZhciBub2RlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKICAgIC8vIOmYsuatouW+queOr+S+nei1lgogICAgbm9kZS5mb3JFYWNoKGsgPT4gewogICAgICB2YXIgX2E7CgogICAgICBpZiAoIWNoZWNrZWRba10pIHsKICAgICAgICBjaGVja2VkW2tdID0gdHJ1ZTsKICAgICAgICBnZXROZWVkcygoX2EgPSBsaW1pdHNba10pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uZWVkcyk7CiAgICAgIH0KICAgIH0pOwogIH07IC8vIOa3u+WKoOm7mOiupCAkcGFnZSDpobXpnaLmnYPpmZAKCgogIGlmIChsaW1pdHNbcm91dGVMaW1pdEtleV0gJiYgIWNoZWNrZWRbcm91dGVMaW1pdEtleV0pIHsKICAgIGNoZWNrZWRbcm91dGVMaW1pdEtleV0gPSB0cnVlOwogICAgbmVlZHMucHVzaChyb3V0ZUxpbWl0S2V5KTsKICB9CgogIGdldE5lZWRzKG5lZWRzKTsKICByZXR1cm4gT2JqZWN0LmtleXMoY2hlY2tlZCk7Cn07Cgp2YXIgZ2V0U3RvcmUgPSB0eXBlID0+IHsKICB2YXIgc3RvcmUgPSBnZXRHbG9iYWwoc3RvcmFnZS5yb3V0ZURhdGEpIHx8IHt9OwogIHJldHVybiBzdG9yZVt0eXBlXSB8fCBbXTsKfTsKCnZhciBzZXRTdG9yZSA9ICh0eXBlLCBkYXRhKSA9PiB7CiAgdmFyIHN0b3JlID0gZ2V0R2xvYmFsKHN0b3JhZ2Uucm91dGVEYXRhKTsKICBzdG9yZVt0eXBlXSA9IGRhdGE7CiAgc2V0R2xvYmFsKHN0b3JhZ2Uucm91dGVEYXRhLCBzdG9yZSk7Cn07CgpleHBvcnQgdmFyIGNsZWFyUm91dGVTdG9yZSA9ICgpID0+IHsKICBzZXRHbG9iYWwoc3RvcmFnZS5yb3V0ZURhdGEsIHt9KTsKfTsgLy8g6L+H5ruk5o6JIOmFjee9rui3r+eUseS/oeaBrwovLyAxLiDljrvpmaTml6DmnYPpmZDot6/nlLEKLy8gMi4g5Y676Zmk5L6n6L655qCP6ZqQ6JePIOiPnOWNlemhuQoKdmFyIGZpbHRlclJvdXRlc0NvbmZpZyA9IHR5cGUgPT4gewogIHZhciBsaW1pdHMgPSBnZXRBcHBMaW1pdHMoKTsgLy8g5LiN5qCh6aqM5p2D6ZmQIOW5tuS4lCBsaW1pdHMg5pWw5o2u5Li656m65pe2CgogIGlmICghYXBwLmVudi5kaXNhYmxlTGltaXQgJiYgaXNFbXB0eShsaW1pdHMpKSB7CiAgICAvLyDpobXpnaLot6/nlLHku4DkuYjpg73msqHmnIkKICAgIHJldHVybiBbXTsKICB9CgogIHZhciBub2RlcyA9IGZpbHRlclRyZWUoZ2V0Um91dGVDb25maWcodHJ1ZSksIGl0ZW0gPT4gewogICAgdmFyIHsKICAgICAgbm9kZVBhdGgsCiAgICAgIGlnbm9yZUxpbWl0LAogICAgICBsaW1pdE9ubHkKICAgIH0gPSBpdGVtOwogICAgdmFyIGF1dGggPSBpZ25vcmVMaW1pdCA9PT0gdHJ1ZSA/IHRydWUgOiBjaGVja0xpbWl0QnlOb2RlUGF0aChub2RlUGF0aCwgbGltaXRzKTsKCiAgICBpZiAobm9kZVBhdGggPT09ICcvJyAmJiAhbGltaXRPbmx5KSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdhc2lkZSc6CiAgICAgICAgcmV0dXJuIGF1dGggJiYgbGltaXRPbmx5ICE9PSB0cnVlOwoKICAgICAgY2FzZSAnbGltaXQnOgogICAgICAgIHJldHVybiAhaWdub3JlTGltaXQgJiYgYXV0aDsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGF1dGg7CiAgICB9CiAgfSk7CiAgcmV0dXJuIG5vZGVzOwp9OyAvLyDlj6/nlKjot6/nlLHmnYPpmZAtLS3ms6jmhI/pobXpnaLlhoXmk43kvZzmnYPpmZDmsqHmnInmoKHpqowKCgpleHBvcnQgdmFyIGdldEF1dGhSb3V0ZXMgPSAoKSA9PiB7CiAgaWYgKGdldFN0b3JlKCdhdXRoUm91dGVzJykubGVuZ3RoKSB7CiAgICByZXR1cm4gZ2V0U3RvcmUoJ2F1dGhSb3V0ZXMnKTsKICB9CgogIHZhciBhdXRoUm91dGVzID0gZmlsdGVyUm91dGVzQ29uZmlnKCdyb3V0ZScpOwogIHNldFN0b3JlKCdhdXRoUm91dGVzJywgYXV0aFJvdXRlcyk7CiAgcmV0dXJuIGF1dGhSb3V0ZXM7Cn07IC8vIOS+p+i+ueagjyDlsZXnpLroj5zljZXphY3nva4KCmV4cG9ydCB2YXIgZ2V0QXNpZGVNZW51cyA9ICgpID0+IHsKICBpZiAoZ2V0U3RvcmUoJ2FzaWRlTWVudXMnKS5sZW5ndGgpIHsKICAgIHJldHVybiBnZXRTdG9yZSgnYXNpZGVNZW51cycpOwogIH0KCiAgdmFyIGFzaWRlTWVudXMgPSBmaWx0ZXJSb3V0ZXNDb25maWcoJ2FzaWRlJyk7CiAgc2V0U3RvcmUoJ2FzaWRlTWVudXMnLCBhc2lkZU1lbnVzKTsKICByZXR1cm4gYXNpZGVNZW51czsKfTsgLy8g5p2D6ZmQ6YWN572u6KGoCgpleHBvcnQgdmFyIGdldExpbWl0TWVudXMgPSBvcHRpb24gPT4gewogIHZhciB7CiAgICByZWZyZXNoID0gZmFsc2UsCiAgICB1c2VBbGxMaW1pdCA9IGZhbHNlCiAgfSA9IG9wdGlvbiB8fCB7fTsKCiAgaWYgKCFyZWZyZXNoICYmIGdldFN0b3JlKCdsaW1pdE1lbnVzJykubGVuZ3RoKSB7CiAgICByZXR1cm4gZ2V0U3RvcmUoJ2xpbWl0TWVudXMnKTsKICB9CgogIHZhciB1c2VyUm91dGVzID0gdXNlQWxsTGltaXQgPyBnZXRSb3V0ZUNvbmZpZyh0cnVlKSA6IGNsb25lRGVlcChmaWx0ZXJSb3V0ZXNDb25maWcoJ2xpbWl0JykpOyAvLyDmnoTlu7rmnYPpmZDphY3nva7pnaLmnb/oj5zljZXnu5PmnoQKCiAgdmFyIGxpbWl0TWVudXMgPSBtYXBUcmVlKHVzZXJSb3V0ZXMsIGl0ZW0gPT4gewogICAgdmFyIHsKICAgICAgbm9kZVBhdGgsCiAgICAgIGNoaWxkcmVuCiAgICB9ID0gaXRlbTsKICAgIHZhciBwcmVzZXQgPSBnZXRQYWdlUHJlc2V0KGl0ZW0pIHx8IHBpY2soaXRlbSwgWydhcGlzJywgJ2xpbWl0cyddKTsKICAgIHZhciB7CiAgICAgIGxpbWl0cywKICAgICAgYXBpcwogICAgfSA9IHByZXNldDsgLy8gbGltaXRzIOihqOekuiDlvZPliY3oioLngrkg5pyJ5a2Q5p2D6ZmQCgogICAgaWYgKGxpbWl0cykgewogICAgICB2YXIgbGltaXROb2RlUGF0aCA9IGNoaWxkcmVuID8gIiIuY29uY2F0KG5vZGVQYXRoLCAiLyIpLmNvbmNhdChwYXJlbnRLZXkpIDogbm9kZVBhdGg7CiAgICAgIHZhciBsaW1pdEl0ZW1zID0gbWFwKGxpbWl0cywgKF9yZWYsIGtleSkgPT4gewogICAgICAgIHZhciB7CiAgICAgICAgICBpY29uLAogICAgICAgICAgbGFiZWwKICAgICAgICB9ID0gX3JlZjsKICAgICAgICB2YXIgbmVlZHMgPSBrZXkgPT09IHJvdXRlTGltaXRLZXkgPyB1bmRlZmluZWQgOiByZXNvbHZlTGltaXROZWVkcyhrZXksIGxpbWl0cykubWFwKG5lZWRLID0+ICIiLmNvbmNhdChsaW1pdE5vZGVQYXRoLCAiLyIpLmNvbmNhdChuZWVkSykpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsYWJlbCwKICAgICAgICAgIG5lZWRzLAogICAgICAgICAgaWNvbjogaWNvbiB8fCAnZmEgZmEtY29kZScsCiAgICAgICAgICBub2RlUGF0aDogIiIuY29uY2F0KGxpbWl0Tm9kZVBhdGgsICIvIikuY29uY2F0KGtleSkKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIGlmIChjaGlsZHJlbikgewogICAgICAgIGNoaWxkcmVuLnVuc2hpZnQoewogICAgICAgICAgaWNvbjogJ2ZhIGZhLWNvZGUtZm9yaycsCiAgICAgICAgICBub2RlUGF0aDogbGltaXROb2RlUGF0aCwKICAgICAgICAgIGxhYmVsOiAiIi5jb25jYXQoaXRlbS5sYWJlbCwgIi1cdTY3NDNcdTk2NTAiKSwKICAgICAgICAgIGNoaWxkcmVuOiBsaW1pdEl0ZW1zCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXRlbS5jaGlsZHJlbiA9IGxpbWl0SXRlbXM7CiAgICAgIH0KICAgIH0gLy8g5bCGIHByZXNldCDphY3nva7nmoQgYXBpc++8jCDmt7vliqDliLDmnYPpmZDphY3nva7ooajkuK0KCgogICAgaWYgKGFwaXMpIHsKICAgICAgdmFyIGFsbEFwaXMgPSB7fTsKICAgICAgbWFwKGFwaXMsIChhcGlJdGVtLCBhcGlLZXkpID0+IHsKICAgICAgICB2YXIgewogICAgICAgICAga2V5OiBhcGlBdXRoS2V5LAogICAgICAgICAgdXJsLAogICAgICAgICAgbGltaXRzOiBhcGlMaW1pdHMKICAgICAgICB9ID0gYXBpSXRlbTsKICAgICAgICB2YXIgcHJlc2V0QXBpTGltaXRzID0gIWFwaUxpbWl0cyB8fCB0eXBlb2YgYXBpTGltaXRzID09PSAnc3RyaW5nJyA/IFthcGlMaW1pdHNdIDogYXBpTGltaXRzOwogICAgICAgIGFsbEFwaXNbYXBpS2V5XSA9IHsKICAgICAgICAgIHVybCwKICAgICAgICAgIGtleTogYXBpQXV0aEtleSwKICAgICAgICAgIGxpbWl0czogIWdldChsaW1pdHMsIHJvdXRlTGltaXRLZXkpID8gcHJlc2V0QXBpTGltaXRzIDogcHJlc2V0QXBpTGltaXRzID09PSBudWxsIHx8IHByZXNldEFwaUxpbWl0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJlc2V0QXBpTGltaXRzLmNvbmNhdChyb3V0ZUxpbWl0S2V5KQogICAgICAgIH07CiAgICAgIH0pOwogICAgICBpdGVtLmFwaXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGl0ZW0uYXBpcyksIGFsbEFwaXMpOwogICAgfSAvLyDmt7vliqDpu5jorqQgaWNvbgoKCiAgICBpdGVtLmljb24gPSBpdGVtLmljb24gPyBpdGVtLmljb24gOiAnZmEgZmEtY29kZS1mb3JrJzsKICAgIHJldHVybiBpdGVtOwogIH0pOwoKICBpZiAodXNlQWxsTGltaXQpIHsKICAgIHNldFN0b3JlKCdsaW1pdE1lbnVzJywgbGltaXRNZW51cyk7CiAgICByZXR1cm4gbGltaXRNZW51czsKICB9CgogIHZhciBhcHBMaW1pdHMgPSBnZXRBcHBMaW1pdHMoKTsKICB2YXIgZmlsdGVyZWRMaW1pdE1lbnVzID0gZmlsdGVyVHJlZShsaW1pdE1lbnVzLCAoX3JlZjIpID0+IHsKICAgIHZhciB7CiAgICAgIG5vZGVQYXRoCiAgICB9ID0gX3JlZjI7CiAgICByZXR1cm4gbm9kZVBhdGggPT09ICcvJyA/IHRydWUgOiBjaGVja0xpbWl0QnlOb2RlUGF0aChub2RlUGF0aCwgYXBwTGltaXRzKTsKICB9KTsKICBzZXRTdG9yZSgnbGltaXRNZW51cycsIGZpbHRlcmVkTGltaXRNZW51cyk7CiAgcmV0dXJuIGZpbHRlcmVkTGltaXRNZW51czsKfTs="},{"version":3,"sources":["C:/Users/cwx/Desktop/editor-demo/node_modules/@ovine/core/lib/routes/limit/index.js"],"names":["filterTree","mapTree","map","isEmpty","pick","cloneDeep","get","app","routeLimitKey","parentKey","storage","getPagePreset","getGlobal","setGlobal","getRouteConfig","checkLimitByNodePath","getAppLimits","resolveLimitNeeds","key","limits","checked","needs","getNeeds","node","forEach","k","_a","push","Object","keys","getStore","type","store","routeData","setStore","data","clearRouteStore","filterRoutesConfig","env","disableLimit","nodes","item","nodePath","ignoreLimit","limitOnly","auth","getAuthRoutes","length","authRoutes","getAsideMenus","asideMenus","getLimitMenus","option","refresh","useAllLimit","userRoutes","limitMenus","children","preset","apis","limitNodePath","limitItems","icon","label","undefined","needK","unshift","allApis","apiItem","apiKey","apiAuthKey","url","apiLimits","presetApiLimits","concat","assign","appLimits","filteredLimitMenus"],"mappings":"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","sourcesContent":["/**\n * APP 权限配置表处理\n * TODO: 添加 unit test\n */\nimport { filterTree, mapTree } from 'amis/lib/utils/helper';\nimport { map, isEmpty, pick, cloneDeep, get } from 'lodash';\nimport { app } from \"../../app\";\nimport { routeLimitKey, parentKey, storage } from \"../../constants\";\nimport { getPagePreset } from \"../exports\";\nimport { getGlobal, setGlobal } from \"../../utils/store\";\nimport { getRouteConfig } from \"../config\";\nimport { checkLimitByNodePath, getAppLimits } from \"./exports\";\n// 处理 preset.limits.needs 配置的数据\nconst resolveLimitNeeds = (key, limits) => {\n    const checked = {};\n    const { needs = [] } = limits[key];\n    // 便利所有节点\n    const getNeeds = (node = []) => {\n        // 防止循环依赖\n        node.forEach((k) => {\n            var _a;\n            if (!checked[k]) {\n                checked[k] = true;\n                getNeeds((_a = limits[k]) === null || _a === void 0 ? void 0 : _a.needs);\n            }\n        });\n    };\n    // 添加默认 $page 页面权限\n    if (limits[routeLimitKey] && !checked[routeLimitKey]) {\n        checked[routeLimitKey] = true;\n        needs.push(routeLimitKey);\n    }\n    getNeeds(needs);\n    return Object.keys(checked);\n};\nconst getStore = (type) => {\n    const store = getGlobal(storage.routeData) || {};\n    return store[type] || [];\n};\nconst setStore = (type, data) => {\n    const store = getGlobal(storage.routeData);\n    store[type] = data;\n    setGlobal(storage.routeData, store);\n};\nexport const clearRouteStore = () => {\n    setGlobal(storage.routeData, {});\n};\n// 过滤掉 配置路由信息\n// 1. 去除无权限路由\n// 2. 去除侧边栏隐藏 菜单项\nconst filterRoutesConfig = (type) => {\n    const limits = getAppLimits();\n    // 不校验权限 并且 limits 数据为空时\n    if (!app.env.disableLimit && isEmpty(limits)) {\n        // 页面路由什么都没有\n        return [];\n    }\n    const nodes = filterTree(getRouteConfig(true), (item) => {\n        const { nodePath, ignoreLimit, limitOnly } = item;\n        const auth = ignoreLimit === true ? true : checkLimitByNodePath(nodePath, limits);\n        if (nodePath === '/' && !limitOnly) {\n            return true;\n        }\n        switch (type) {\n            case 'aside':\n                return auth && limitOnly !== true;\n            case 'limit':\n                return !ignoreLimit && auth;\n            default:\n                return auth;\n        }\n    });\n    return nodes;\n};\n// 可用路由权限---注意页面内操作权限没有校验\nexport const getAuthRoutes = () => {\n    if (getStore('authRoutes').length) {\n        return getStore('authRoutes');\n    }\n    const authRoutes = filterRoutesConfig('route');\n    setStore('authRoutes', authRoutes);\n    return authRoutes;\n};\n// 侧边栏 展示菜单配置\nexport const getAsideMenus = () => {\n    if (getStore('asideMenus').length) {\n        return getStore('asideMenus');\n    }\n    const asideMenus = filterRoutesConfig('aside');\n    setStore('asideMenus', asideMenus);\n    return asideMenus;\n};\n// 权限配置表\nexport const getLimitMenus = (option) => {\n    const { refresh = false, useAllLimit = false } = option || {};\n    if (!refresh && getStore('limitMenus').length) {\n        return getStore('limitMenus');\n    }\n    const userRoutes = useAllLimit ? getRouteConfig(true) : cloneDeep(filterRoutesConfig('limit'));\n    // 构建权限配置面板菜单结构\n    const limitMenus = mapTree(userRoutes, (item) => {\n        const { nodePath, children } = item;\n        const preset = getPagePreset(item) || pick(item, ['apis', 'limits']);\n        const { limits, apis } = preset;\n        // limits 表示 当前节点 有子权限\n        if (limits) {\n            const limitNodePath = children ? `${nodePath}/${parentKey}` : nodePath;\n            const limitItems = map(limits, ({ icon, label }, key) => {\n                const needs = key === routeLimitKey\n                    ? undefined\n                    : resolveLimitNeeds(key, limits).map((needK) => `${limitNodePath}/${needK}`);\n                return {\n                    label,\n                    needs,\n                    icon: icon || 'fa fa-code',\n                    nodePath: `${limitNodePath}/${key}`,\n                };\n            });\n            if (children) {\n                children.unshift({\n                    icon: 'fa fa-code-fork',\n                    nodePath: limitNodePath,\n                    label: `${item.label}-权限`,\n                    children: limitItems,\n                });\n            }\n            else {\n                item.children = limitItems;\n            }\n        }\n        // 将 preset 配置的 apis， 添加到权限配置表中\n        if (apis) {\n            const allApis = {};\n            map(apis, (apiItem, apiKey) => {\n                const { key: apiAuthKey, url, limits: apiLimits } = apiItem;\n                const presetApiLimits = !apiLimits || typeof apiLimits === 'string' ? [apiLimits] : apiLimits;\n                allApis[apiKey] = {\n                    url,\n                    key: apiAuthKey,\n                    limits: !get(limits, routeLimitKey)\n                        ? presetApiLimits\n                        : presetApiLimits === null || presetApiLimits === void 0 ? void 0 : presetApiLimits.concat(routeLimitKey),\n                };\n            });\n            item.apis = Object.assign(Object.assign({}, item.apis), allApis);\n        }\n        // 添加默认 icon\n        item.icon = item.icon ? item.icon : 'fa fa-code-fork';\n        return item;\n    });\n    if (useAllLimit) {\n        setStore('limitMenus', limitMenus);\n        return limitMenus;\n    }\n    const appLimits = getAppLimits();\n    const filteredLimitMenus = filterTree(limitMenus, ({ nodePath }) => {\n        return nodePath === '/' ? true : checkLimitByNodePath(nodePath, appLimits);\n    });\n    setStore('limitMenus', filteredLimitMenus);\n    return filteredLimitMenus;\n};\n"]}]}